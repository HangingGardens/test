import{_ as ne,d as oe,A as fe,aw as ke,D as L,E as V,b as f,e as S,g as e,h as t,t as s,G as P,ao as $e,k as C,F as te,s as be,H as B,L as v,K as J,Z as Ae,ax as _e,M as Z,ay as Ie,az as Oe,z as Me,a4 as z,a6 as W,a8 as Be,aA as re,a2 as le,a5 as pe,a3 as he,m as ue,w as ve,a as R,C as ce,o as me,W as M,X,P as se,j as q,at as ye,u as Fe,p as Se,l as Ce,ac as Ue}from"./index-968154d2.js";const Le=""+new URL("../images/sell-28e94682.svg",import.meta.url).href,Te=""+new URL("../images/buy-0ac551f5.svg",import.meta.url).href;const De={class:"pt-5"},Pe={class:"flex items-center h-5 text-[#2E2008] text-base"},Ve=["src"],qe={class:"font-semibold ml-0.5"},Ne={class:"bg-[#FFF1D9]/[0.6] rounded-xl mt-2.5 py-4 pb-1.5"},Re={class:"w-full"},Ee={class:"flex px-4"},je={class:"my-th w-4/12"},ze={class:"my-th w-5/12"},We={class:"my-th w-3/12"},He={key:1,class:"max-h-36 w-full overflow-auto pt-1.5 px-4 list-box"},Ge={class:"w-4/12 text-overflow"},Xe={class:"text-base font-medium text-[#2E2008]"},Ke={class:"w-5/12 text-overflow"},Ye={class:"text-base font-medium text-[#2E2008]"},Ze={class:"w-3/12 text-overflow"},Je=oe({props:{type:{type:null,required:!0},list:{type:Array,required:!0},isOld:{type:Boolean,required:!1}},emits:["onClick","onCheckMyOrder"],setup(a,{emit:m}){const{type:c,list:U}=a,w=fe();ke();const I=L(()=>{const _={icon:Le,title:w.t("ecology.Sellorders"),subTitle:w.t("ecology.mysellorder"),btnText:w.t("ecology.buyin")};return c=="buy"&&(_.icon=Te,_.title=w.t("ecology.buyorder"),_.subTitle=w.t("ecology.mybill"),_.btnText=w.t("ecology.sellout")),_}),$=_=>{m("onClick",c,_)},O=()=>{m("onCheckMyOrder",c)};return(_,h)=>{const A=V("van-icon"),E=V("van-skeleton"),g=V("VanButton");return f(),S("div",De,[e("div",Pe,[e("img",{src:t(I).icon,class:"w-5",alt:""},null,8,Ve),e("span",qe,s(t(I).title),1),e("span",{class:"ml-auto font-medium opacity-80",onClick:O},s(t(I).subTitle),1),P(A,{class:"font-semibold text-sm mx-px",name:"arrow",onClick:O})]),e("div",Ne,[e("div",Re,[e("div",Ee,[e("span",je,s(_.$t("mall.price")),1),e("span",ze,s(_.$t("ecology.quantity")),1),e("span",We,s(_.$t("shop.operation")),1)]),t($e)?(f(),C(E,{key:0,class:"mt-3",row:3})):(f(),S("div",He,[(f(!0),S(te,null,be(a.list,y=>(f(),S("div",{class:"flex w-full py-2.5",key:y.price},[e("span",Ge,[e("span",Xe,s(y.price),1)]),e("span",Ke,[e("span",Ye,s(y.amount),1)]),e("span",Ze,[P(g,{class:J(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":a.type=="buy"}]),onClick:T=>$(y),disabled:a.isOld},{default:B(()=>[v(s(t(I).btnText),1)]),_:2},1032,["class","onClick","disabled"])])]))),128))]))])])])}}}),we=ne(Je,[["__scopeId","data-v-1cc2456f"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OtcOrder.vue"]]);const Qe={class:"w-[21rem] p-5 bg-[#FFFDF8] text-xs text-[#2E2008]"},et={class:"flex justify-between items-center pb-4 header font-semibold text-base"},tt=oe({props:{show:{type:Boolean,required:!0},title:{type:null,required:!0}},emits:["close"],setup(a,{emit:m}){const{show:c,title:U}=a,w=()=>{m("close")};return(I,$)=>{const O=V("van-icon"),_=V("van-popup");return f(),C(_,_e(I.$attrs,{show:a.show,"onUpdate:show":$[0]||($[0]=h=>Z(c)?c.value=h:null),round:"","overlay-class":"",onClose:w}),{default:B(()=>[e("div",Qe,[e("div",et,[e("span",null,s(a.title),1),P(O,{name:"cross",class:"font-semibold text-xl",onClick:w})]),e("div",null,[Ae(I.$slots,"default",{},void 0,!0)])])]),_:3},16,["show"])}}}),ge=ne(tt,[["__scopeId","data-v-41985eb3"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyDialog.vue"]]),de=a=>{const m=a?Ie():Oe(),c=Me().getCurrentAccount();return{pending:async(n,r,p)=>{try{const F=await(await m.pending(n,le(r),le(p))).wait();return z(F)}catch(F){return pe(F),W(F)}},usdtAddress:async()=>{try{const n=await m.USDT();return z(n)}catch(n){return W(n)}},MIN_AMOUNT:async()=>{try{const n=await m.MIN_AMOUNT();return Be(n)}catch{return 0}},MIN_REMAIN_AMOUNT:async()=>{try{const n=await m.MIN_REMAIN_AMOUNT();return z(n)}catch(n){return W(n)}},lastPrice:async()=>{try{const n=await m.lastPrice();return re(n.toString())}catch{return 0}},getMarketPrices:async n=>{try{const r=await m.getMarketPrices(n);return z(r)}catch(r){return W(r)}},getPriceTotals:async(n,r)=>{try{const p=await m.getPriceTotals(n,le(r));return z(p)}catch(p){return W(p)}},getMarketIds:async(n,r)=>{try{const p=await m.getMarketIds(n,r);return z(p)}catch(p){return W(p)}},getOrderInfo:async n=>{try{const r=await m.getOrderInfo(n);return z(r)}catch(r){return W(r)}},batchTrade:async n=>{try{const p=await(await await m.batchTrade(n)).wait();return z(p)}catch(r){return pe(r),W(r)}},trade:async(n,r)=>{try{const p=await m.estimateGas.trade(n,le(r)),N=await(await await m.trade(n,le(r),{gasLimit:he(p,3e3)})).wait();return z(N)}catch(p){return pe(p),W(p)}},getPendingIds:async()=>{try{const n=await m.getPendingIds(c);return z(n)}catch(n){return W(n)}},cancel:async n=>{try{const r=await m.estimateGas.cancel(n),F=await(await await m.cancel(n.toString(),{gasLimit:he(r,3e3)})).wait();return z(F)}catch(r){return pe(r),W(r)}},musdAddress:async()=>{try{const n=await m.MUSD();return z(n)}catch(n){return W(n)}},maiAddress:async()=>{try{const n=await m.MAI();return z(n)}catch(n){return W(n)}}}};const st={class:"mt-4 font-bold text-base"},nt={class:"flex-center-bw"},ot={class:"opacity-80"},at={class:"flex-center-bw mt-1"},lt={class:"opacity-80"},rt={class:"mt-4 text-[#2E2008]"},ct={class:"text-sm font-medium"},it={class:"bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},ut={class:"mt-5 text-sm font-medium"},dt={class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},pt={class:"text-base opacity-60"},mt={class:"flex flex-col items-center justify-center mt-5"},yt={key:0,class:"mt-5 text-center text-xs"},ft={lass:"mt-1"},bt={key:1,class:"mt-5 text-center text-xs"},gt={class:"mt-1"},ht=oe({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},lastPrice:{type:null,required:!0}},emits:["update:show","success"],setup(a,{emit:m}){const{show:c,type:U}=a,{t:w}=fe(),{musdAddress:I,MIN_AMOUNT:$,maiAddress:O,pending:_}=de(),h=ue({number:null,price:null}),A=L(()=>{const o={title:w("ecology.Pendingpurchase"),numberText:w("ecology.buyquantity"),priceText:w("ecology.buyprice")};return U=="sell"&&(o.title=w("ecology.Hangforsale"),o.numberText=w("ecology.sellquantity"),o.priceText=w("ecology.sellingprice")),o}),E=L(()=>x.value>0&&(U==="buy"?x.value>=g.value:x.value>=+h.number));ve(()=>h.price,(o,b)=>{y.value||(g.value=+o*+h.number)}),ve(()=>h.number,(o,b)=>{T.value||(g.value=+o*+h.price)});const g=R(null),y=R(!1),T=R(!1),u=()=>{y.value=!1,T.value=!0},D=()=>{y.value=!0,T.value=!1},[d,n]=ce(!1),r=()=>{m("update:show",!1)},p=R(""),F=async()=>{const o=U==="buy"?await I():await O();!o.success||(p.value=o.result)},N=async()=>{n(!0);const o=await await X(p.value).approve(se.otc);n(!1),o.success&&Y()},x=R(null),Y=async()=>{n(!0);const o=await(await X(p.value)).allowance(se.otc);x.value=o.result||0,n(!1)},j=R(0),ie=async()=>{const o=await $();j.value=+o},G=R(0),Q=async()=>{const o=await X(p.value).balanceOf();G.value=+o},[ee,ae]=ce(!1),l=async()=>{ae(!0);const o=await _(U==="buy"?1:2,h.price,h.number);ae(!1),o.success&&(r(),m("success"))},i=async()=>{Y(),ie(),Q()};return me(async()=>{await F(),i()}),(o,b)=>{const K=V("VanField"),k=V("VanButton");return f(),C(ge,{show:a.show,"onUpdate:show":b[2]||(b[2]=H=>Z(c)?c.value=H:null),title:t(A).title,onClose:r},{default:B(()=>[e("div",st,[e("div",nt,[e("span",null,"MAI"+s(o.$t("ecology.new price")),1),e("span",ot,s(a.lastPrice)+" MUSD",1)]),e("div",at,[e("span",null,s(a.type==="buy"?"MAI":"MUSD"),1),e("span",lt,s(t(M)(G.value))+" "+s(a.type==="buy"?"MAI":"MUSD"),1)])]),e("div",rt,[e("div",ct,s(t(A).numberText),1),e("div",it,[P(K,{class:"bg-[#fff9f0] text-3xl font-bold",onFocus:D,modelValue:t(h).number,"onUpdate:modelValue":b[0]||(b[0]=H=>t(h).number=H),type:"number",placeholder:"0"},null,8,["modelValue"])]),e("div",ut,s(t(A).priceText),1),e("div",dt,[P(K,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:t(h).price,"onUpdate:modelValue":b[1]||(b[1]=H=>t(h).price=H),onFocus:u,type:"number",placeholder:"0"},null,8,["modelValue"]),e("span",pt,s((a.type==="buy","MUSD")),1)]),e("div",mt,[t(E)?a.type==="buy"?(f(),C(k,{key:1,onClick:l,disabled:+t(h).price<=0||g.value<j.value||g.value>G.value,loading:t(ee),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:B(()=>[v(s(o.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(f(),C(k,{key:2,onClick:l,disabled:+t(h).price<=0||g.value<j.value||t(h).number>G.value,loading:t(ee),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:B(()=>[v(s(o.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(f(),C(k,{key:0,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",loading:t(d),onClick:N},{default:B(()=>[v(s(o.$t("assets.auth"))+" "+s(a.type==="buy"?"MUSD":"MAI"),1)]),_:1},8,["loading"]))]),a.type=="sell"?(f(),S("div",yt,[e("div",null,s(o.$t("ecology.hand num"))+" "+s(j.value)+"MUSD, "+s(o.$t("ecology.otcDeduct")),1),e("div",ft,"* "+s(o.$t("ecology.estimated get"))+s(t(M)(g.value*.7))+" MUSD, "+s(o.$t("ecology.estimated consume"))+" "+s(t(M)(t(h).number))+" MAI",1)])):(f(),S("div",bt,[e("div",null,s(o.$t("ecology.hand num"))+" "+s(j.value)+" MUSD",1),e("div",gt,"*"+s(o.$t("ecology.estimated get"))+s(t(M)(t(h).number))+" MAI, "+s(o.$t("ecology.estimated consume"))+s(g.value)+" MUSD ",1)]))])]),_:1},8,["show","title"])}}}),vt=ne(ht,[["__scopeId","data-v-6f90ea23"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/PostForm.vue"]]);const wt={class:"mt-5"},_t={class:"flex justify-between"},xt={class:"text-base font-semibold"},kt={class:"text-base font-medium opacity-80"},$t={class:"flex justify-between mt-2.5"},At={class:"text-base font-semibold"},It={class:"text-base font-medium opacity-80"},Ot={class:"flex justify-between mt-6"},Mt={class:"text-sm font-medium"},Bt={class:"text-sm opacity-80"},Ft={class:"flex justify-between items-center bg-[#fff9f0] rounded-lg py-2.5 pr-2.5 mt-2.5"},St={class:"flex flex-col items-center justify-center mt-5"},Ct={class:"mt-5"},Ut={key:0,class:"mt-2 text-left"},Lt={class:"text-[#FBA923]"},Tt={class:"text-[#FBA923]"},Dt=v(" MUSD"),Pt={key:1,class:"mt-2"},Vt={class:"text-[#FBA923]"},qt={class:"text-[#FBA923]"},Nt=oe({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0},orderInfo:{type:null,required:!0},isAuth:{type:Boolean,required:!0},musdBalance:{type:[Number,String],required:!0},tokenBalance:{type:[Number,String],required:!0},musdAllowance:{type:[Number,String],required:!0},tokenAllowance:{type:[Number,String],required:!0},otcAddress:{type:String,required:!0}},emits:["update:show","approve","success"],setup(a,{emit:m}){const c=a,{trade:U}=de(),w=L(()=>+c.tokenAllowance>=+y.number&&+c.tokenAllowance>0),I=L(()=>+c.musdAllowance>=+y.number*+c.orderInfo.price&&+c.musdAllowance>0),$=ue({isAuth:!1,btnLoading:!1}),O=L(()=>c.orderInfo.remain<y.number),_=L(()=>c.orderInfo.remain*c.orderInfo.price>10?`1-${M(c.orderInfo.remain-10/c.orderInfo.price)} || ${c.orderInfo.remain}`:c.orderInfo.remain),h=L(()=>{if(c.type=="buy")return 1;if(c.type=="sell")return 2}),A=()=>{m("update:show",!1)},E=async()=>{$.btnLoading=!0;let u;if(h.value===1?u=await X(c.token).approve(c.otcAddress):u=await X(c.musd).approve(c.otcAddress),!u.success)return $.btnLoading=!1;$.isAuth=!0,m("approve"),$.btnLoading=!1},g=async()=>{$.btnLoading=!0;try{(await U(c.orderInfo.id,+y.number)).success&&m("success")}finally{$.btnLoading=!1}},y=ue({number:""}),T=()=>{h.value===1?y.number=+c.tokenBalance<+c.orderInfo.remain?c.tokenBalance:c.orderInfo.remain:y.number=+c.musdBalance/c.orderInfo.price<+c.orderInfo.remain?+c.musdBalance/c.orderInfo.price:c.orderInfo.remain};return(u,D)=>{const d=V("VanField"),n=V("VanButton");return f(),C(ge,{show:a.show,"onUpdate:show":D[1]||(D[1]=r=>Z(show)?show.value=r:null),title:a.type=="sell"?u.$t("otc.buyIn"):u.$t("otc.sellOut"),onClose:A,overlay:!1},{default:B(()=>[e("div",wt,[e("div",_t,[e("span",xt,s(u.$t("mall.price")),1),e("span",kt,s(t(M)(a.orderInfo.price||0,4))+" MUSD",1)]),e("div",$t,[e("span",At,s(u.$t("ecology.total")),1),e("span",It,s(t(M)(a.orderInfo.remain||0,4))+" MAI",1)]),e("div",Ot,[e("span",Mt,s(a.type=="sell"?u.$t("ecology.buyquantity"):u.$t("ecology.sellquantity")),1),e("span",Bt,s(a.type=="sell"?"MUSD":"MAI")+s(u.$t("assets.balance"))+s(a.type=="sell"?a.musdBalance:a.tokenBalance),1)]),e("div",Ft,[P(d,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:t(y).number,"onUpdate:modelValue":D[0]||(D[0]=r=>t(y).number=r),type:"number",placeholder:"0"},null,8,["modelValue"]),e("div",{class:"px-1.5 py-1 border-[1px] rounded border-[#FBA923] border-solid text-xs text-[#FBA923] font-medium",onClick:T},"MAX ")]),e("div",St,[(a.type==="sell"?t(I):t(w))?(f(),C(n,{key:0,loading:t($).btnLoading,disabled:!t(y).number||+t(y).number<=0||t(O),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",onClick:g},{default:B(()=>[v(s(u.$t("common.submit")),1)]),_:1},8,["loading","disabled"])):(f(),C(n,{key:1,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",disabled:!t(y).number||+t(y).number<=0||t(O),loading:t($).btnLoading,onClick:E},{default:B(()=>[v(s(u.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading"]))]),e("div",Ct,s(u.$t("ecology.tips",{Currency:a.type=="sell"?"MAI":"MUSD",num:t(_)})),1),q(" \u83B7\u5F97 "),a.type==="sell"?(f(),S("div",Ut,[v(" *"+s(u.$t("ecology.estimated get"))+" ",1),e("span",Lt,s(t(y).number||0),1),v(" MAI, "+s(u.$t("ecology.estimated consume"))+" ",1),e("span",Tt,s(t(M)(+a.orderInfo.price*+t(y).number)),1),Dt])):(f(),S("div",Pt,[v("*"+s(u.$t("ecology.estimated get"))+" ",1),e("span",Vt,s(t(M)(+t(y).number*+a.orderInfo.price*.7)),1),v(" MUSD, "+s(u.$t("ecology.estimated consume"))+" ",1),e("span",qt,s(+t(y).number||0),1),v(" MAI, "+s(u.$t("ecology.otcDeduct")),1)]))])]),_:1},8,["show","title"])}}}),Rt=ne(Nt,[["__scopeId","data-v-67dbb134"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperateDetail.vue"]]);const Et={class:"mt-4 font-bold text-base"},jt={class:"mt-4"},zt={class:"text-sm text-[#2E2008] font-medium"},Wt={class:"text-white flex flex-col justify-center items-center mt-5 font-semibold text-sm"},Ht={key:0,class:"mt-4 text-center text-xs"},Gt={class:"mt-1"},Xt={class:"mt-1"},Kt={class:"text-[#FBA923]"},Yt={class:"text-[#FBA923]"},Zt=v(" MAI"),Jt={key:1,class:"mt-4 text-center text-xs"},Qt={class:"mt-1"},es={class:"text-[#FBA923]"},ts={class:"text-[#FBA923]"},ss=v(" MUSD "),ns=oe({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},price:{type:Number,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0}},emits:["update:show","success"],setup(a,{emit:m}){const{show:c,type:U,price:w,token:I,musd:$}=a,O=fe(),{getMarketIds:_,getOrderInfo:h,batchTrade:A,MIN_AMOUNT:E}=de(),g=se.otc,[y,T]=ce(!1),u=R([]),D=l=>{u.value=l},d=ue({orderInfo:{},amountShow:!1,list:[],btnLoading:!1,tokenAllowance:"",tokenBalance:"",musdAllowance:"",musdBalance:""}),n=L(()=>d.list.reduce((i,o)=>u.value.find(b=>b==o.id)?i+o.remain:i,0)),r=L(()=>d.list.reduce((i,o)=>u.value.find(b=>b==o.id)?i+o.remain*o.price:i,0)),p=L(()=>+d.tokenAllowance>=+n.value&&+d.tokenAllowance>0),F=L(()=>+d.musdAllowance>=+r.value),N=L(()=>{const l={title:O.t("ecology.buy"),btnText:O.t("ecology.buyin"),batchBtnText:O.t("ecology.Bulkbuy"),btnClass:"btn-green"};return U=="buy"&&(l.title=O.t("ecology.Sell"),l.btnText=O.t("ecology.sellout"),l.batchBtnText=O.t("ecology.sellinbulk"),l.btnClass="btn-pink"),l}),x=L(()=>{if(U=="buy")return 1;if(U=="sell")return 2}),Y=()=>{m("update:show",!1)},j=async()=>{const l=await X($).allowance(se.otc);d.musdAllowance=l.result,d.musdBalance=String(M(await X($).balanceOf()));const i=await X(I).allowance(se.otc);d.tokenAllowance=i.result,d.tokenBalance=String(M(await X(I).balanceOf()))},ie=async()=>{const l=await _(x.value,le(w)),i=[];for(let o=0;o<l.result.length;o++){const b=await h(l.result[o]);i.push({id:l.result[o],price:w,remain:re(b.result.remain.toString())})}d.list=i},G=async()=>{d.btnLoading=!0;let l;if(x.value===1?l=await X(I).approve(se.otc):l=await X($).approve(se.otc),!l.success)return d.btnLoading=!1;await j(),Q()},Q=async()=>{const l=d.list.reduce((i,o)=>u.value.find(b=>b==o.id)?i+o.remain:i,0);if(x.value===1){if(l>d.tokenAllowance&&l<=d.tokenBalance)return G()}else if(l>d.musdAllowance&&l<=d.musdBalance)return G();d.btnLoading=!0;try{(await A(u.value)).success&&m("success")}finally{d.btnLoading=!1}},ee=l=>{d.orderInfo=l,T(!0)},ae=()=>{T(!1),m("success")};return me(async()=>{d.btnLoading=!0,await j(),await ie(),d.btnLoading=!1}),(l,i)=>{const o=V("van-checkbox"),b=V("VanButton"),K=V("van-checkbox-group");return f(),S(te,null,[P(ge,{show:a.show,"onUpdate:show":i[1]||(i[1]=k=>Z(c)?c.value=k:null),title:`${a.price}${t(N).title}`,onClose:Y,"close-on-click-overlay":!t(y)},{default:B(()=>[e("div",Et,[a.type=="buy"?(f(),S(te,{key:0},[v(" MAI"+s(l.$t("assets.balance"))+s(t(d).tokenBalance||0),1)],2112)):(f(),S(te,{key:1},[v(" MUSD"+s(l.$t("assets.balance"))+s(t(d).musdBalance||0),1)],2112))]),e("div",jt,[P(K,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=k=>u.value=k),onChange:D},{default:B(()=>[(f(!0),S(te,null,be(t(d).list,k=>(f(),S("div",{class:"flex justify-between items-center bg-[#fff9f0] rounded-lg p-2.5 mt-2.5",key:k.id},[P(o,{name:k.id,"icon-size":"1rem","checked-color":"#14D8A9"},{default:B(()=>[e("span",zt,s(t(M)(k.remain||0,4))+" MAI",1)]),_:2},1032,["name"]),P(b,{class:J(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":a.type=="buy"}]),onClick:H=>ee(k)},{default:B(()=>[v(s(t(N).btnText),1)]),_:2},1032,["class","onClick"])]))),128))]),_:1},8,["modelValue"]),e("div",Wt,[q(" \u6388\u6743 "),(a.type==="sell"?!t(F):!t(p))?(f(),C(b,{key:0,disabled:!u.value.length,loading:t(d).btnLoading,class:J(["py-3 flex-1 w-40",t(N).btnClass]),onClick:G},{default:B(()=>[v(s(l.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading","class"])):(f(),S(te,{key:1},[q(" \u6279\u91CF\u8D2D\u4E70 "),P(b,{disabled:!u.value.length,loading:t(d).btnLoading,class:J(["py-3 flex-1 w-40",t(N).btnClass]),onClick:Q},{default:B(()=>[v(s(t(N).batchBtnText),1)]),_:1},8,["disabled","loading","class"])],2112))]),a.type=="buy"?(f(),S("div",Ht,[e("div",Gt,s(l.$t("ecology.otcDeduct")),1),e("div",Xt,[v("*"+s(l.$t("ecology.estimated get"))+" ",1),e("span",Kt,s(t(M)(t(r)*.7)),1),v(" MUSD\uFF0C"+s(l.$t("ecology.estimated consume"))+" ",1),e("span",Yt,s(t(M)(t(n))),1),Zt])])):(f(),S("div",Jt,[e("div",Qt,[v("*"+s(l.$t("ecology.estimated get"))+" ",1),e("span",es,s(t(M)(t(n))),1),v(" MAI\uFF0C"+s(l.$t("ecology.estimated consume"))+" ",1),e("span",ts,s(t(M)(t(r))),1),ss])]))])]),_:1},8,["show","title","close-on-click-overlay"]),t(y)?(f(),C(Rt,{key:0,type:a.type,show:t(y),"onUpdate:show":i[2]||(i[2]=k=>Z(y)?y.value=k:null),token:a.token,musd:a.musd,isAuth:a.type=="sell"?t(F):t(p),isMusdtAuth:t(F),orderInfo:t(d).orderInfo,musdBalance:t(d).musdBalance,tokenBalance:t(d).tokenBalance,otcAddress:t(g),tokenAllowance:t(d).tokenAllowance,musdAllowance:t(d).musdAllowance,onApprove:j,onSuccess:ae},null,8,["type","show","token","musd","isAuth","isMusdtAuth","orderInfo","musdBalance","tokenBalance","otcAddress","tokenAllowance","musdAllowance"])):q("v-if",!0)],64)}}}),os=ne(ns,[["__scopeId","data-v-176626b2"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperatePopup.vue"]]),as=""+new URL("../images/Rectangle_L_O-1a09b3b3.svg",import.meta.url).href,ls=""+new URL("../images/Rectangle_L_W-bf92913e.svg",import.meta.url).href,rs=""+new URL("../images/Rectangle_R_O-b6604591.svg",import.meta.url).href,cs=""+new URL("../images/Rectangle_R_W-ed1e7ed6.svg",import.meta.url).href;const is={class:"w-[21rem] bg-[#FFFDF8] text-xs text-[#2E2008]"},us={class:"container"},ds={class:"flex justify-between items-center font-semibold text-base py-4 px-5"},ps={class:"h-10 flex relative"},ms=["src"],ys=["src"],fs={class:"h-10 z-10 flex items-center w-[21rem] text-base font-medium"},bs={class:"p-2.5 maxH overflow-auto"},gs={class:"flex justify-between header pb-2.5"},hs={class:"text-xl font-bold"},vs={class:"flex justify-between mt-2.5 text-sm"},ws={class:"opacity-80"},_s={class:"font-semibold"},xs={class:"flex justify-between mt-2.5 text-sm"},ks={class:"opacity-80"},$s={class:"font-semibold"},As={class:"flex justify-between mt-2.5 text-sm"},Is={class:"opacity-80"},Os={class:"font-semibold"},Ms=oe({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},isOld:{type:Boolean,required:!1}},emits:["update:show","success"],setup(a,{emit:m}){const{show:c,type:U,isOld:w}=a,{getPendingIds:I,cancel:$,getOrderInfo:O}=de(w),_=()=>{m("update:show",!1)},h=L(()=>A.value==="buy"?u.value.filter(n=>n.direct===1):u.value.filter(n=>n.direct===2)),A=R("buy"),E=n=>{A.value!=n&&(A.value=n)},g=L(()=>A.value=="buy"?ls:as),y=L(()=>A.value=="sell"?cs:rs),T=R([]),u=R([]),D=async()=>{const n=await I();!n.success||(T.value=n.result,T.value.forEach(async r=>{const p=await O(r);u.value.push({direct:+p.result.direct,price:M(ye(p.result.price)),total:M(ye(p.result.total)),remain:M(ye(p.result.remain)),token:p.result.token,sender:p.result.sender,status:+p.result.status,id:r,loading:!1})}))},d=async n=>{n.loading=!0;const r=await $(n.id);n.loading=!1,r.success&&(_(),m("success"))};return me(()=>{A.value=U,D()}),(n,r)=>{const p=V("van-icon"),F=V("VanButton"),N=V("van-popup");return f(),C(N,_e(n.$attrs,{show:a.show,"onUpdate:show":r[2]||(r[2]=x=>Z(c)?c.value=x:null),style:{height:"80vh"},round:"","overlay-class":"",onClose:_}),{default:B(()=>[e("div",is,[e("div",us,[e("div",ds,[e("span",null,s(n.$t("ecology.mypendingorder")),1),P(p,{name:"cross",class:"font-semibold text-xl",onClick:_})]),e("div",ps,[e("img",{class:J(["h-10 absolute left-0 bottom-[-1px]",{"z-10":A.value=="buy"}]),src:t(g),alt:""},null,10,ms),e("img",{class:J(["h-10 absolute right-0 bottom-[-1px]",{"z-10":A.value=="sell"}]),src:t(y),alt:""},null,10,ys),e("div",fs,[e("span",{class:J(["text-[#2E2008] flex-1 text-center",{"text-[#FEA021]":A.value=="buy"}]),onClick:r[0]||(r[0]=x=>E("buy"))},s(n.$t("ecology.mybill")),3),e("span",{class:J(["text-[#2E2008] opacity-60 flex-1 text-center",{"text-[#FEA021]":A.value=="sell"}]),onClick:r[1]||(r[1]=x=>E("sell"))},s(n.$t("ecology.mysellorder")),3)])])]),e("div",bs,[q(" \u8BA2\u5355\u9879 "),(f(!0),S(te,null,be(t(h),(x,Y)=>(f(),S("div",{class:"bg-[#FFF1D9]/[0.4] rounded p-2.5 mt-2.5 order-box",key:Y},[e("div",gs,[e("span",hs,s(x.price||0),1),q(" \u64A4\u9500 "),x.status==1?(f(),C(F,{key:0,class:"btn-border px-3.5 h-[28px] rounded-2xl text-xs text-[#FBA923] font-medium min-w-[65px] text-center"},{default:B(()=>[v(s(n.$t("ecology.completed")),1)]),_:1})):q("v-if",!0),x.status==0?(f(),C(F,{key:1,onClick:j=>d(x),loading:x.loading,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:B(()=>[v(s(n.$t("ecology.revoke")),1)]),_:2},1032,["onClick","loading"])):q("v-if",!0),x.status===2?(f(),C(F,{key:2,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:B(()=>[v(s(n.$t("ecology.canceled")),1)]),_:1})):q("v-if",!0)]),e("div",vs,[e("span",ws,s(n.$t("ecology.Totalendingorders")),1),e("span",_s,s(x.total||0)+" MAI",1)]),e("div",xs,[e("span",ks,s(n.$t("ecology.transactionquantity")),1),e("span",$s,s(x.total-x.remain||0)+" MAI",1)]),e("div",As,[e("span",Is,s(n.$t("ecology.remainingquantity")),1),e("span",Os,s(x.remain||0)+" MAI",1)])]))),128))])])]),_:1},16,["show"])}}}),Bs=ne(Ms,[["__scopeId","data-v-0ab69f7b"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyOtcOrder.vue"]]);const xe=a=>(Se("data-v-5b5e4784"),a=a(),Ce(),a),Fs={class:"bg-[#FFFDF8] rounded-xl p-2.5 pt-5 pb-3.5"},Ss={class:"flex-center flex-col text-[#F36B07] rounded-xl bg-[#FFF1D9]/[0.6] py-5 font-normal text-sm"},Cs={class:"text-3xl font-bold"},Us=xe(()=>e("span",{class:"ml-2"},"MUSD",-1)),Ls={class:"text-[#2E2008] font-medium opacity-60"},Ts={class:"pt-2.5 pb-1 flex justify-between text-white font-semibold text-sm"},Ds=xe(()=>e("div",{class:"w-5"},null,-1)),Ps=oe({props:{isOld:{type:Boolean,required:!1}},setup(a){const m=a,{loadingToggle:c}=Ue(),{lastPrice:U,getMarketPrices:w,getMarketIds:I,maiAddress:$,musdAddress:O,getOrderInfo:_}=de(m.isOld),{reloadStore:h}=Fe(),A=1,E=2,g=ue({token:"",musd:"",sellOrderList:[],buyOrderList:[],lastPrice:0,selectPrice:0,minAmount:0,maxAmount:0}),y=R(),T=R(""),u=R(""),[D,d]=ce(!1),[n,r]=ce(!1),[p,F]=ce(!1),N=l=>{T.value=l,d(!0)},x=(l,i)=>{y.value=i.price,u.value=l,r(!0)},Y=l=>{u.value=l,F(!0)},j=async()=>{const l=await U();g.lastPrice=l||0},ie=async()=>{const l=await $(),i=await O();g.token=l.result,g.musd=i.result},G=async()=>{const l=await w(E),i=[];for(let o=0;o<l.result.length;o++){const b=await I(E,l.result[o]);let K=0;for(let k=0;k<b.result.length;k++){const H=await _(b.result[k]);K+=re(H.result.remain.toString())}i.push({price:re(l.result[o].toString()),amount:M(K)}),g.sellOrderList=i.filter(k=>k.amount!==0),g.sellOrderList=g.sellOrderList.sort((k,H)=>k.price-H.price)}},Q=async()=>{const l=await w(A),i=[];for(let o=0;o<l.result.length;o++){const b=await I(A,l.result[o]);let K=0;for(let k=0;k<b.result.length;k++){const H=await _(b.result[k]);K+=re(H.result.remain.toString())}i.push({price:re(l.result[o].toString()),amount:M(K)})}g.buyOrderList=i.filter(o=>o.amount!==0),g.buyOrderList=g.buyOrderList.sort((o,b)=>b.price-o.price)},ee=async()=>{h.reload(),Q(),G(),j(),r(!1)},ae=async()=>{c(!0),await Promise.all([ie(),j(),G(),Q()]),c(!1)};return me(async()=>{await ae()}),(l,i)=>{const o=V("VanButton");return f(),S("div",Fs,[e("div",Ss,[e("div",null,[e("span",Cs,s(t(g).lastPrice),1),Us]),e("div",Ls,s(l.$t("ecology.Latesttransactionprice")),1)]),e("div",Ts,[P(o,{class:"flex-1 h-10 px-4 btn-green",onClick:i[0]||(i[0]=b=>N("buy")),disabled:a.isOld},{default:B(()=>[v(s(l.$t("ecology.Pendingpurchase")),1)]),_:1},8,["disabled"]),Ds,P(o,{class:"flex-1 h-10 px-4 btn-pink",onClick:i[1]||(i[1]=b=>N("sell")),disabled:a.isOld},{default:B(()=>[v(s(l.$t("ecology.Hangforsale")),1)]),_:1},8,["disabled"])]),P(we,{type:"sell",onOnClick:x,onOnCheckMyOrder:Y,list:t(g).sellOrderList,isOld:a.isOld},null,8,["list","isOld"]),P(we,{type:"buy",onOnClick:x,onOnCheckMyOrder:Y,list:t(g).buyOrderList,isOld:a.isOld},null,8,["list","isOld"]),q(" \u53D1\u5E03\u7684\u5F39\u7A97 "),t(D)?(f(),C(vt,{key:0,show:t(D),"onUpdate:show":i[2]||(i[2]=b=>Z(D)?D.value=b:null),onSuccess:ee,type:T.value,lastPrice:t(g).lastPrice},null,8,["show","type","lastPrice"])):q("v-if",!0),q(" \u4E70\u5165\u5356\u51FA\u64CD\u4F5C\u5F39\u7A97 "),t(n)?(f(),C(os,{key:1,show:t(n),"onUpdate:show":i[3]||(i[3]=b=>Z(n)?n.value=b:null),type:u.value,price:y.value,token:t(g).token,musd:t(g).musd,onSuccess:ee},null,8,["show","type","price","token","musd"])):q("v-if",!0),q(" \u6211\u7684\u8BA2\u5355\u5F39\u7A97 "),t(p)?(f(),C(Bs,{key:2,show:t(p),"onUpdate:show":i[4]||(i[4]=b=>Z(p)?p.value=b:null),type:u.value,isOld:a.isOld,success:"handleSuccess"},null,8,["show","type","isOld"])):q("v-if",!0)])}}}),qs=ne(Ps,[["__scopeId","data-v-5b5e4784"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/OtcIndex.vue"]]);export{qs as O};
