import{_ as M,b as i,e as r,g as t,t as l,p as z,l as J,a1 as ue,a2 as E,a3 as de,a4 as me,a5 as ge,a6 as pe,a7 as fe,a8 as he,d as V,A as ke,u as Ae,f as xe,C as H,m as we,D,q as F,P as w,w as W,W as b,o as be,E as v,G as p,h as s,L as C,k as L,a9 as j,F as T,s as O,H as R,K as _e,j as ve,M as Ie,aa as Ue,X as S,T as P,Y as X,a as Be}from"./index-7014d71a.js";import{_ as Ce}from"./exchange2-3cce7f16.js";import{T as Se}from"./TokenBalance-fe2a9ecf.js";const K=""+new URL("../images/exchange-arrow-1e34b25d.svg",import.meta.url).href,Me=""+new URL("../images/exchange-1-fc290789.svg",import.meta.url).href,ye=""+new URL("../images/exchange-c9e13db2.svg",import.meta.url).href;const Ne={},Ee=a=>(z("data-v-1b7c8bc9"),a=a(),J(),a),De={class:"flex-center"},Re={class:"skew absolute w-[104px] inline-flex justify-center items-center h-[34px]"},Le={class:"z-50 w-full h-full px-5 flex-center gap-2 rounded-full bg-[#ffd81f]"},Te=Ee(()=>t("img",{src:ye,class:"h-4",alt:""},null,-1)),Oe={class:"text-base font-semibold"};function Ve(a,d){return i(),r("div",De,[t("div",Re,[t("div",Le,[Te,t("span",Oe,l(a.$t("assets.exchange")),1)])])])}const Qe=M(Ne,[["render",Ve],["__scopeId","data-v-1b7c8bc9"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/userAssets/components/ExchangeHeader.vue"]]),Ye=()=>{const a=ue(),d={MAI:"mai",MCOIN:"mcoin",MUSD:"musd",USDT:"usdt"},f={MAI:"Mai",MCOIN:"Mcoin",MUSD:"Musd",USDT:"Usdt",BNB:"BNB"};return{swapToken:async(A,m,h)=>{try{const g=await a.estimateGas[`${d[A]}To${f[m]}`](E(h)),x=await(await a[`${d[A]}To${f[m]}`](E(h),{gasLimit:de(g,3e3)})).wait();return me(x)}catch(g){return ge(g),pe(g)}},getAmountsOut:async(A,m,h)=>{const g=await fe(await a.PANCAKE_ROUTER());try{var x=await g.getAmountsOut(E(A),[m,h]);return he(x[1])}catch{return 0}}}};const I=a=>(z("data-v-4237ee9c"),a=a(),J(),a),Ge={class:"mt-5 mx-4 bg-white rounded-xl bg"},Ze={class:"my-5 px-3 pb-5"},He={class:"flex justify-between"},Fe=["src"],We={class:"font-semibold"},je=I(()=>t("img",{src:K,class:"w-4",alt:""},null,-1)),Pe={class:"opacity-80 flex-center"},Xe={key:1},ze={class:"bg-[#fff9f0] mt-1 rounded-lg p-2"},Je={class:"flex justify-end items-center gap-2 mt-2"},Ke=["onClick"],qe=I(()=>t("img",{src:Me,class:"w-10",alt:""},null,-1)),$e=[qe],et={class:"px-3"},tt={class:"flex justify-between"},st=["src"],nt={class:"font-semibold"},ot=I(()=>t("img",{src:K,class:"w-4",alt:""},null,-1)),at={class:"opacity-80 flex-center"},lt={key:1},ct={class:"bg-[#fff9f0] mt-3 rounded-lg py-1 px-2"},it={class:"opacity-70 text-center mt-2"},rt={class:"flex-center gap-4 mt-5 text-white font-semibold"},ut={class:"flex-center gap-1"},dt=I(()=>t("img",{src:Ce,class:"w-4",alt:""},null,-1)),mt={key:0,class:"flex-center gap-2 mt-5"},gt=I(()=>t("div",{class:"w-[13px] h-[13px] rounded-full bg-[#ffd489] text-white text-xs flex-center"},"1",-1)),pt={class:"flex-center gap-1"},ft=V({setup(a){const{t:d}=ke(),{reloadStore:f}=Ae(),{mcoinRate:y}=xe(),{getAmountsOut:_,swapToken:A}=Ye(),[m,h]=H(!1),[g,x]=H(!1),e=we({percents:[{name:"25%",value:.25},{name:"50%",value:.5},{name:"75%",value:.75},{name:"MAX",value:1}],resouceAmount:null,toAmount:null,tokenIndex:0,token0:"MCOIN",token1:"MUSD",balance0:0,balance1:0,originTokens:["MCOIN","USDT","MUSD"],tokens0:["MCOIN","USDT","MUSD"],tokens1:["MUSD","USDT","BNB"],pairs:[{token0:"MCOIN",token1:"BNB"},{token0:"MCOIN",token1:"USDT"},{token0:"MCOIN",token1:"MUSD"},{token0:"MUSD",token1:"BNB"},{token0:"MUSD",token1:"MCOIN"},{token0:"MUSD",token1:"USDT"},{token0:"USDT",token1:"MCOIN"},{token0:"USDT",token1:"MUSD"}],authLoading:!0,exchangeLoading:!0,exchangeValue:null,resouceDisabled:!1,toDisabled:!1,pointRate:0,bnbRate:0,firstAuth:!1,isAuth:!1,allowanceAmount:0}),k=D(()=>({name:e.token0,icon:F(`images/tokens/${e.token0}.png`),token:w[`${e.token0}`]})),U=D(()=>({name:e.token1,icon:F(`images/tokens/${e.token1}.png`),token:w[`${e.token1}`]})),B=D(()=>({MUSDUSDT:1,USDTMUSD:1,MUSDMCOIN:e.pointRate,MCOINMUSD:1/e.pointRate,USDTMCOIN:e.pointRate,MCOINUSDT:1/e.pointRate,USDTBNB:e.bnbRate,MUSDBNB:e.bnbRate,MCOINBNB:e.bnbRate/e.pointRate})[e.token0+e.token1]),q=()=>{console.log(e.resouceAmount,"resouceAmount"),console.log(b(e.resouceAmount,18)),e.resouceDisabled=!1,e.toDisabled=!0},$=()=>{e.resouceDisabled=!0,e.toDisabled=!1};W(()=>e.resouceAmount,(n,o)=>{e.resouceDisabled||(e.toAmount=n*B.value,e.isAuth=+e.allowanceAmount>=parseFloat(n||0)&&e.allowanceAmount>0)},{immediate:!0,deep:!0}),W(()=>e.toAmount,(n,o)=>{e.toDisabled||(e.resouceAmount=b(n/B.value||0))});const ee=n=>{e.resouceDisabled=!1,e.resouceAmount=+Ue(e.balance0).times(n.value)},Q=n=>{e.tokenIndex=n,h(!0)},te=async n=>{e[`token${e.tokenIndex}`]=n;var o=(e.pairs||[]).filter(u=>u[`token${e.tokenIndex}`]===n);e.tokenIndex||(e[`tokens${1-e.tokenIndex}`]=(o||[]).map(u=>u[`token${1-e.tokenIndex}`]),o=e[`tokens${1-e.tokenIndex}`]||[],e[`token${1-e.tokenIndex}`]=o.length?o[0]:""),e.exchangeValue=null,h(!1),e.resouceAmount=null,e.toAmount=null,N()},se=()=>{if(e.token1==="BNB"||e.token0==="MAI")return;const n=e.token0;e.token0=e.token1,e.tokens0=e.originTokens;const o=(e.pairs||[]).filter(u=>u.token0===e.token0);e.tokens1=(o||[]).map(u=>u.token1),e.tokens1.indexOf(n)!==-1?e.token1=n:e.token1="",e.resouceAmount=null,e.toAmount=null,e.firstAuth=!1,e.isAuth=!1,N()},Y=async()=>{e.authLoading=!0;const{allowance:n}=S(k.value.token);e.authLoading=!1;const o=await n(w.swapPool);!o.success||(e.allowanceAmount=+o.result||0,e.isAuth=+o.result>0,e.firstAuth=e.firstAuth||+o.result<=0)},ne=async()=>{x(!0),e.balance0=k.value.name==="BNB"?+await X():+await S(k.value.token).balanceOf(),e.balance1=U.value.name==="BNB"?+await X():+await S(U.value.token).balanceOf(),x(!1)},oe=async()=>{e.pointRate=await y()},ae=async()=>{e.bnbRate=+await _(1,w.USDT,w.BNB),console.log(e.bnbRate)},le=async()=>{e.authLoading=!0;const n=await S(k.value.token).approve(w.swapPool);e.authLoading=!1,n.success&&Y()},ce=async()=>{if(!e.resouceAmount)return P(d("assets.pleaseInput"));if(+e.resouceAmount>+e.balance0)return P(d("errorMsg.insufficient allowance"));e.exchangeLoading=!0;const n=await A(e.token0,e.token1,b(e.resouceAmount,18));e.exchangeLoading=!1,n.success&&f.reload()},N=async()=>{await Y(),ne(),oe(),ae(),e.authLoading=!1,e.exchangeLoading=!1};return be(()=>{N()}),(n,o)=>{const u=v("van-loading"),G=v("VanField"),Z=v("VanButton"),ie=v("VanPicker"),re=v("VanPopup");return i(),r("div",Ge,[p(Qe),t("div",Ze,[t("section",null,[t("div",He,[t("div",{class:"flex-start gap-1",onClick:o[0]||(o[0]=c=>Q(0))},[t("img",{src:s(k).icon,alt:"",class:"w-6 h-6"},null,8,Fe),t("span",We,l(s(k).name),1),je]),t("div",Pe,[C(l(n.$t("assets.balance"))+" ",1),s(g)?(i(),L(u,{key:0,size:"18px"})):(i(),r("span",Xe,l(s(j)(s(b)(s(e).balance0||0))),1))])]),t("div",ze,[p(G,{class:"bg-[#fff9f0] text-default opacity-50","input-align":"right",modelValue:s(e).resouceAmount,"onUpdate:modelValue":o[1]||(o[1]=c=>s(e).resouceAmount=c),onFocus:q,type:"number",placeholder:"0"},null,8,["modelValue"]),t("div",Je,[(i(!0),r(T,null,O(s(e).percents,c=>(i(),r("div",{class:"text-xs text-[primary] border border-solid border-primary rounded-md px-1 py-[2px]",key:c.value,onClick:Ct=>ee(c)},l(c.name),9,Ke))),128))])])]),t("div",{class:"flex-center mt-3",onClick:se},$e),t("section",et,[t("div",tt,[t("div",{class:"flex-start gap-1",onClick:o[2]||(o[2]=c=>Q(1))},[t("img",{src:s(U).icon,alt:"",class:"w-6 h-6"},null,8,st),t("span",nt,l(s(U).name),1),ot]),t("div",at,[C(l(n.$t("assets.balance"))+" ",1),s(g)?(i(),L(u,{key:0,size:"18px"})):(i(),r("span",lt,l(s(j)(s(b)(s(e).balance1||0))),1))])]),t("div",ct,[p(G,{class:"bg-[#fff9f0] text-default opacity-50","input-align":"right",modelValue:s(e).toAmount,"onUpdate:modelValue":o[3]||(o[3]=c=>s(e).toAmount=c),onFocus:$,type:"number",placeholder:"0"},null,8,["modelValue"])])]),t("div",it,"1 "+l(s(e).token0)+" = "+l(s(B)?s(b)(s(B),6).toString():"-")+" "+l(s(e).token1),1),t("div",rt,[p(Z,{class:"btn h-[35px] min-w-[100px] px-4",disabled:s(e).isAuth,loading:s(e).authLoading,onClick:le},{default:R(()=>[C(l(n.$t("assets.auth"))+l(s(k).name),1)]),_:1},8,["disabled","loading"]),p(Z,{class:"btn h-[35px] min-w-[100px] px-4",loading:s(e).exchangeLoading,disabled:!s(e).isAuth||s(e).authLoading,onClick:ce},{default:R(()=>[t("div",ut,[dt,C(" "+l(n.$t("assets.change")),1)])]),_:1},8,["loading","disabled"])]),s(e).firstAuth?(i(),r("div",mt,[gt,t("div",pt,[(i(),r(T,null,O(3,c=>t("div",{key:c,class:"w-1 h-1 bg-[#ffd489] rounded-full"})),64))]),t("div",{class:_e(["w-[13px] h-[13px] rounded-full border-gray2 border-solid border text-gray2 text-xs flex-center",{"bg-[#ffd489] text-white":s(e).isAuth}])},"2 ",2)])):ve("v-if",!0)]),p(re,{show:s(m),"onUpdate:show":o[5]||(o[5]=c=>Ie(m)?m.value=c:null),round:"",position:"bottom"},{default:R(()=>[p(ie,{"show-toolbar":"",columns:s(e).tokenIndex?s(e).tokens1:s(e).tokens0,onCancel:o[4]||(o[4]=c=>m.value=!1),onConfirm:te},null,8,["columns"])]),_:1},8,["show"])])}}}),ht=M(ft,[["__scopeId","data-v-4237ee9c"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/userAssets/components/Exchange.vue"]]),kt=""+new URL("../images/Union-9b366c9a.png",import.meta.url).href,At="data:image/png;base64,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",xt={class:"bg-gradient-to-b from-color4 to-color9 rounded-b-xl p-5 relative overflow-hidden"},wt=t("img",{src:kt,class:"absolute w-full h-auto top-0 lef-0"},null,-1),bt={class:"relative flex items-center justify-center"},_t=t("img",{src:At,class:"h-6 w-auto mr-2"},null,-1),vt={class:"bg-white px-2.5 mt-2.5 rounded-xl relative"},It=V({setup(a){const d=Be(["MCOIN","MUSD","MAI","USDT","BNB"]);return(f,y)=>(i(),r("div",xt,[wt,t("header",bt,[_t,t("div",null,l(f.$t("assets.myAssets")),1)]),t("div",vt,[(i(!0),r(T,null,O(d.value,_=>(i(),L(Se,{key:_,token:_,icon:!0,"token-name":!0,class:"w-full justify-between py-2.5 border-b border-solid border-gray1 last:border-0 font-semibold"},null,8,["token"]))),128))])]))}}),Ut=M(It,[["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/userAssets/components/MyAssets.vue"]]),Bt=V({setup(a){return(d,f)=>(i(),r("div",null,[p(Ut),p(ht)]))}}),Nt=M(Bt,[["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/userAssets/UserAssets.vue"]]);export{Nt as default};
