import{_ as R,d as W,A as J,u as K,m as Q,C as Y,D as k,w as T,a as Z,o as ee,E as A,e as m,g as t,G as c,h as s,H as y,q as B,P as g,W as i,b as r,j as se,t as o,L as _,k as F,a9 as I,F as ae,s as te,p as oe,l as ne,aa as le,X as d,T as ce}from"./index-e452b068.js";import{_ as ie}from"./Vector-light-ecef907e.js";import{_ as re}from"./exchange-1-427770c5.js";import{_ as ue}from"./exchange2-3cce7f16.js";import{U as de,a as me,C as pe}from"./ChangeLang-42ddd3c7.js";import{B as fe}from"./BgBox-1f277382.js";import{u as ge}from"./lendingPoolContract-a0fed04c.js";import"./avatarRing-8eae2442.js";import"./level-93a6fb73.js";import"./TokenBalance-685d962d.js";const D=p=>(oe("data-v-cbacc2e6"),p=p(),ne(),p),_e={class:"h-full relative"},he={class:"px-2.5 flex justify-between items-center py-5 relative header-bg"},be=D(()=>t("img",{src:ie,alt:"",class:"absolute w-[125px] right-0 z-0"},null,-1)),ve={class:"bg-[#FFFDF8] rounded-2xl shadow-inset-2 px-2 py-4"},xe={class:"flex-center-bw"},we={class:"flex-start gap-2.5"},ke=["src"],Ae={class:"font-semibold"},ye={class:"opacity-80 flex-center"},De={key:1},Se={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},Ue={class:"flex justify-end items-center gap-2 mt-2"},Ce=["onClick"],Le=D(()=>t("img",{src:re,class:"w-20 block",alt:""},null,-1)),Me=[Le],Ve={class:"flex-center-bw"},Te={class:"flex-start gap-2.5"},Be=["src"],Fe={class:"font-semibold"},Ie={class:"opacity-80 flex-center"},$e={key:1},Ne={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},Ee={class:"opacity-70 text-center mt-2"},ze={class:"flex-center gap-4 mt-5 text-white font-semibold"},Oe={class:"flex-center gap-1"},Pe=D(()=>t("img",{src:ue,class:"w-4",alt:""},null,-1)),je=W({setup(p){const{usdtAddress:h,musdAddress:b,deposit:$,withdraw:N}=ge(),{t:E}=J();K();const e=Q({userInfo:{address:""},percents:[{name:"25%",value:.25},{name:"50%",value:.5},{name:"75%",value:.75},{name:"MAX",value:1}],token0:"USDT",token1:"MUSD",balance0:0,balance1:0,resouceAmount:null,toAmount:null,authLoading:!1,isAuth:!1,exchangeLoading:!1,allowanceAmount:0,resouceDisabled:!0,toDisabled:!0}),[S,U]=Y(!1),u=k(()=>({name:e.token0,icon:B(`images/tokens/${e.token0}.png`),token:g[`${e.token0}`]})),v=k(()=>({name:e.token1,icon:B(`images/tokens/${e.token1}.png`),token:g[`${e.token1}`]})),z=()=>{e.resouceDisabled=!1,e.toDisabled=!0},O=()=>{e.resouceDisabled=!0,e.toDisabled=!1};T(()=>e.resouceAmount,(a,n)=>{e.resouceDisabled||(e.toAmount=i(a*f.value),e.isAuth=+e.allowanceAmount>=+a&&e.allowanceAmount>0)},{immediate:!0,deep:!0}),T(()=>e.toAmount,(a,n)=>{e.toDisabled||(e.resouceAmount=i(a/f.value))});const P=a=>{e.resouceDisabled=!1,e.resouceAmount=i(+le(e.balance0).times(a.value))},f=k(()=>({MUSDUSDT:1,USDTMUSD:1})[e.token0+e.token1]),j=()=>{e.token0==="MUSD"?(e.token0="USDT",e.token1="MUSD"):(e.token0="MUSD",e.token1="USDT"),e.resouceAmount=0,w()},x=Z(""),H=async()=>{const a=u.value.name==="MUSD"?await b():await h();x.value=a},C=async()=>{const a=await(await d(x.value)).allowance(g.lendingPool);e.isAuth=+a.result>0,e.allowanceAmount=a.result||0},X=async()=>{e.authLoading=!0;const{approve:a}=d(x.value),n=await a(g.lendingPool);e.authLoading=!1,n.success&&C()},q=async()=>{U(!0),e.balance0=u.value.name==="MUSD"?+await d(await b()).balanceOf():+await d(await h()).balanceOf(),e.balance1=v.value.name==="MUSD"?+await d(await b()).balanceOf():+await d(await h()).balanceOf(),U(!1)},G=async()=>{if(!e.resouceAmount||e.resouceAmount===0)return ce(E("assets.pleaseInput"));e.exchangeLoading=!0;let a;u.value.name==="MUSD"?a=await N(i(e.resouceAmount)):a=await $(i(e.resouceAmount)),e.exchangeLoading=!1,a.success&&(e.resouceAmount=0,w())},w=async()=>{await C(),q(),e.authLoading=!1,e.exchangeLoading=!1};return ee(async()=>{await H(),w()}),(a,n)=>{const L=A("van-loading"),M=A("VanField"),V=A("VanButton");return r(),m("div",_e,[t("div",he,[c(de,{class:"z-50",info:s(e).userInfo},null,8,["info"]),c(pe,{class:"mr-auto ml-[5px]"}),c(me,{tokens:["MCOIN","MUSD","MAI"],onHandleTo:n[0]||(n[0]=l=>a.$router.push(l)),class:"z-50 asset-max-width"}),be]),c(fe,{icon:"svg/ecology/two-way-exchange.svg",text:a.$t("ecology.exchange")},{default:y(()=>[se(" MUSD \u53CC\u5411\u5151\u6362 USDT "),t("div",ve,[t("section",null,[t("div",xe,[t("div",we,[t("img",{src:s(u).icon,alt:"",class:"w-6 h-6"},null,8,ke),t("span",Ae,o(s(u).name),1)]),t("div",ye,[_(o(a.$t("assets.balance"))+" ",1),s(S)?(r(),F(L,{key:0,size:"18px"})):(r(),m("span",De,o(s(I)(s(i)(s(e).balance0||0))),1))])]),t("div",Se,[c(M,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",modelValue:s(e).resouceAmount,"onUpdate:modelValue":n[1]||(n[1]=l=>s(e).resouceAmount=l),onFocus:z,type:"number",placeholder:"0"},null,8,["modelValue"]),t("div",Ue,[(r(!0),m(ae,null,te(s(e).percents,l=>(r(),m("div",{class:"text-xs text-oriange1 border border-solid border-oriange1 rounded-md px-1 py-[2px] hover:bg-[#ffcd89]",key:l.value,onClick:He=>P(l)},o(l.name),9,Ce))),128))])])]),t("div",{class:"flex-center mt-3"},[t("div",{class:"w-20",onClick:j},Me)]),t("section",null,[t("div",Ve,[t("div",Te,[t("img",{src:s(v).icon,alt:"",class:"w-6 h-6"},null,8,Be),t("span",Fe,o(s(v).name),1)]),t("div",Ie,[_(o(a.$t("assets.balance"))+" ",1),s(S)?(r(),F(L,{key:0,size:"18px"})):(r(),m("span",$e,o(s(I)(s(i)(s(e).balance1||0))),1))])]),t("div",Ne,[c(M,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",disabled:!0,modelValue:s(e).resouceAmount,"onUpdate:modelValue":n[2]||(n[2]=l=>s(e).resouceAmount=l),onFocus:O,type:"number",placeholder:"0"},null,8,["modelValue"])])]),t("div",Ee,"1 "+o(s(e).token0)+" = "+o(s(f)?s(i)(s(f),6).toString():"-")+" "+o(s(e).token1),1),t("div",ze,[c(V,{class:"btn h-[35px] min-w-[100px] px-4",disabled:s(e).isAuth,loading:s(e).authLoading,onClick:X},{default:y(()=>[_(o(a.$t("assets.auth"))+o(s(u).name),1)]),_:1},8,["disabled","loading"]),c(V,{class:"btn h-[35px] min-w-[100px] px-4",loading:s(e).exchangeLoading,disabled:!s(e).isAuth||s(e).authLoading,onClick:G},{default:y(()=>[t("div",Oe,[Pe,_(" "+o(a.$t("assets.change")),1)])]),_:1},8,["loading","disabled"])])])]),_:1},8,["text"])])}}}),es=R(je,[["__scopeId","data-v-cbacc2e6"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/Exchange.vue"]]);export{es as default};
