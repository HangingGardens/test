import{_ as oe,d as ae,E as L,b as l,e as m,j as I,g as s,t,k as C,F as E,s as Q,G as f,H as y,L as A,A as ye,u as we,a as v,m as W,C as be,w as xe,D as Me,o as Le,h as a,as as ee,K as Ie,W as h,a9 as Ce,p as $e,l as ke,X as k,P as D,at as se,au as te}from"./index-85d13ebb.js";import{_ as Be}from"./Vector-light-ecef907e.js";import{U as Re,a as Fe,C as Ue}from"./ChangeLang-b6db5305.js";import{B as De}from"./BgBox-ac4ae5a4.js";import{u as Ee}from"./lendingPoolContract-577d6bf0.js";import"./avatarRing-8eae2442.js";import"./level-93a6fb73.js";import"./TokenBalance-9332a244.js";const Se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMsSURBVHgB7Zc9TBRBFMf/MztHUKJuo81RLEFNtDobNbFAEsVGg0iCIRYclbGTxspESbCwwthYclREY0BDbLQAE02UxmuMiUrYQhosPGNOCOzMODMHx+7dfl7s9Jfc7cd8vDfz3rz3FvjXIWgBOeM4HpgjIR1KUZGCVNiGVyajbgUZSa3A5pMjBQheVCP6CYgTMZmr/hYtzsfJsOummDZZATnl2Ft7rQeq4wgyQAhKaRSJVWBr5vBZWHIOEjZawOwIMMauLj+L6ROO97R7RHKU8BdQQopKiemIthDhj7svS2AOUeT2geTPg9jHzKOsfIJ0ZxGLIL254a+LiQqsKw+3KF2IcjQoodaZRyAdnYHXsvoNfOEa8Hs1dJgyY4Wt867Gk0Ib+1nUuhspvCNfFy7X3oOXJ8wP1VXzjl2YB/bmQ4eqpdq8w5psfu1Dr55RawUR0JP3QZ1BiNVXEG9vBBXXiimziM9TEOV7UVNAEn6ibcgt1+cMTKJWjxhovs9cxYeJpjb+8WGtT9cgYhG0GJgz2Cp7kIYwOytHNOT2xw6lhPSHKiDnHDvS9tt4b67XHC2M7ROh/SEOdbocHcp3nll98g1WAJWxg/F9CaE91LHUPqARa++QhM4jqAWpXQUIlbZENuhRlRoOHAc6z4HorVerF9u+EIdOYjv3dQWEgE0oMkELt3cn1cdy6VZ0HPCPY/xHkwLK/i6QdQ9q8JeXTDRMi/TYz7oydU3avTJaJItwI2vDa44DZMCtKNu4yIL2+GrylvvRGdIfjpm/UQpMKz+4g5R4L3rMCciExKL/MeB2AqKEDJhsmBB4GrEkH49UYI+qXvQuII1w5wqsvnmwi6/NfaoxEqXGCqnp4OXa+U1lqMTikh46tXt/8HRSd2P7xtWHKqCdEZwMIAGxMltzwK1fJjumYCysPowsyTZnuovKIaeQhHZCpUQcyqyjbcPLpbC22KJUl2YCcjIpSUWiTal2M6wU2yE2+OpqlgvRm9YxA7KVw7Eq74oTXtMxJaZWhCpYqOyJ2hEpTSB7DmqV2oa+pIqsrX2aqY8Vr50VdAY1SUzlEQbPTfs19B8/fwAnjyghAiecpAAAAABJRU5ErkJggg==";const Te={class:"bg-[#FFFDF8] rounded-2xl shadow-inset-2 px-2 py-4 mt-[10px]"},Ve={class:"flex-start text-2xl font-semibold"},He={key:1},Pe={class:"flex justify-between items-center border-line pb-[10px]"},Oe={class:"text-sm mb-[5px]"},qe={class:"opacity-60"},Ye={class:"flex-center-bw mb-[10px] mt-[10px]"},je={class:"text-sm"},Qe={class:"font-semibold"},Je={class:"flex-center-bw mb-[10px]"},Ke={class:"text-sm"},Ne={class:"font-semibold"},Xe={class:"flex-center-bw"},ze={class:"text-sm"},Ge={class:"font-semibold"},Ze={class:"flex-center gap-4 mt-5 text-white font-semibold"},We=ae({props:{list:{type:null,required:!1},authMusdLoading:{type:null,required:!0},authMusd:{type:null,required:!0},musdAllowance:{type:null,required:!0}},emits:["approveMusd","rollover","repay"],setup(p,{emit:w}){const S=async()=>{w("approveMusd")},T=(i,x)=>{w("rollover",i,x)},V=(i,x)=>{w("repay",i,x)};return(i,x)=>{const H=L("van-skeleton"),b=L("VanButton");return l(),m(E,null,[I(" \u501F\u8D37\u5386\u53F2 "),s("div",Te,[s("div",Ve,t(i.$t("ecology.my loan history")),1),p.list.length===0?(l(),C(H,{key:0,row:3})):(l(),m("div",He,[(l(!0),m(E,null,Q(p.list,(c,B)=>(l(),m("div",{class:"bg-[#fff9f0] mt-3 rounded-lg p-4",key:c.loanId},[s("div",Pe,[s("div",null,[s("div",Oe,t(i.$t("ecology.flow id"))+" "+t(c.loanId),1),s("div",qe,t(c.startTime),1)]),f(b,{class:"btn"},{default:y(()=>[A(t(c.loanStatus===1?i.$t("ecology.ongoing"):i.$t("ecology.overdue")),1)]),_:2},1024)]),s("div",Ye,[s("div",je,t(i.$t("ecology.loanAmount")),1),s("div",Qe,t(c.loanAmount)+" MUSD",1)]),s("div",Je,[s("div",Ke,t(i.$t("ecology.initial stake amount")),1),s("div",Ne,t(c.collateralAmount)+" MAI",1)]),s("div",Xe,[s("div",ze,t(i.$t("ecology.morgage date")),1),s("div",Ge,t(c.endTime),1)]),I(" \u7EED\u8D37\u548C\u5F52\u8FD8\u7EED\u8D37 "),s("div",Ze,[f(b,{class:"btn-item h-[35px] min-w-[100px] px-4",loading:c.rolloverLoading,disabled:+c.pid==0,onClick:r=>T(c.loanId,B)},{default:y(()=>[A(t(i.$t("ecology.relloverLoan")),1)]),_:2},1032,["loading","disabled","onClick"]),p.authMusd&&p.musdAllowance>=c.loanAmount?(l(),C(b,{key:0,class:"btn-item h-[35px] min-w-[100px] px-4",disabled:!p.authMusd,onClick:r=>V(c.loanId,B),loading:c.loanLoading},{default:y(()=>[A(t(i.$t("ecology.repayLoan")),1)]),_:2},1032,["disabled","onClick","loading"])):(l(),C(b,{key:1,class:"btn-item h-[35px] min-w-[100px] px-4",onClick:S,loading:p.authMusdLoading},{default:y(()=>[A(t(i.$t("assets.auth"))+" MUSD",1)]),_:1},8,["loading"]))])]))),128))]))])],2112)}}}),es=oe(We,[["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MortgageHistory.vue"]]);const ne=p=>($e("data-v-c2753ef4"),p=p(),ke(),p),ss={class:"h-full relative"},ts={class:"px-2.5 flex justify-between items-center py-5 relative header-bg"},os=ne(()=>s("img",{src:Be,alt:"",class:"absolute w-[125px] right-0 z-0"},null,-1)),as={class:"bg-[#FFFDF8] rounded-2xl shadow-inset-2 px-2 py-4"},ns={class:"text-2xl font-semibold mb-[10px]"},ls={key:1,class:"grid grid-cols-3 gap-4"},is={key:2,class:"flex-start w-full rounded-[10px] bg-[#fff9f0] p-[10px] mt-[10px] mb-[18px]"},cs=ne(()=>s("img",{class:"w-[18px] mr-[10px]",src:Se},null,-1)),ds={class:"opacity-60 default"},us={class:"flex-center-bw"},rs={class:"flex-start text-2xl font-semibold"},ps={class:"opacity-80 flex-center"},gs={key:1},ms=A(" MAI "),vs={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},fs={class:"flex justify-end items-center gap-2 mt-2"},hs=["onClick"],As={class:"mt-[20px]"},_s={class:"text-2xl font-semibold"},ys={class:"flex-center-bw mb-[10px] mt-[10px]"},ws={class:"font-semibold"},bs={class:"font-medium"},xs={class:"flex-center-bw mb-[10px]"},Ms={class:"font-semibold"},Ls={class:"font-medium"},Is={class:"flex-center-bw mb-[10px]"},Cs={class:"font-semibold"},$s={class:"font-medium"},ks={class:"flex-center-bw"},Bs={class:"font-semibold"},Rs={class:"font-medium"},Fs={class:"flex-center gap-4 mt-5 text-white font-semibold"},Us=ae({setup(p){const{maiAddress:w,rollover:S,repay:T,loans:V,getLoanIds:i,getPrice:x,borrow:H,musdAddress:b,poolInfo:c,poolLength:B}=Ee();ye(),we();const r=v(null),n=W({userInfo:{address:""},percents:[{name:"25%",value:.25},{name:"50%",value:.5},{name:"75%",value:.75},{name:"MAX",value:1}],token0:"USDT",token1:"MUSD",balance0:0,balance1:0,resouceAmount:null,allowanceAmount:0,toAmount:0,authLoading:!1,isAuth:!1,exchangeLoading:!1,maiBalance:0,isAuthMai:!1,isAuthMusd:!1,authMusdLoading:!1}),[le,J]=be(!1),ie=W({7:0,90:15,180:30,365:65});xe(()=>r.value,(e,o)=>{n.isAuthMai=+n.allowanceAmount>=+e&&n.allowanceAmount>0},{immediate:!0,deep:!0});const ce=e=>{r.value=h(e*P.value*.8)},K=v(0),N=async()=>{const e=await(await k(await b())).allowance(D.lendingPool);n.isAuthMusd=+e.result>0,K.value=e.result||0},X=async()=>{const e=await await k(await w()).allowance(D.lendingPool);n.isAuthMai=+e.result>0,n.allowanceAmount=e.result||0},de=async()=>{n.authLoading=!0;const e=await k(await w()).approve(D.lendingPool);n.authLoading=!1,e.success&&X()},ue=async()=>{n.authMusdLoading=!0;const{approve:e}=k(await b()),o=await e(D.lendingPool);n.authMusdLoading=!1,o.success&&N()},z=async()=>{J(!0),n.maiBalance=+await k(await w()).balanceOf(),console.log(n.maiBalance,"state.maiBalance"),P.value=h(n.maiBalance*F.value),console.log(P.value,"maxLoanMusd"),J(!1)},R=v(1),G=v(1),_=v([]),re=async()=>{const e=await B();console.log(e),_.value=[];let o=[];for(let d=0;d<e.result;d++){const g=await pe(d);o.push(g)}_.value=o.sort((d,g)=>d.pid-g.pid),R.value=_.value[1].pid},$=Me(()=>_.value[G.value]),pe=async e=>{const o=await c(e);if(!!o.success)return{pid:e,duration:o.result.duration,interestRate:o.result.interestRate/1e3/.8,penaltyRate:o.result.penaltyRate/1e3}},ge=(e,o)=>{R.value=e.pid,G.value=o},F=v(0),me=async()=>{const e=await x();!e.success||(F.value=e.result,console.log(F.value,"exchangeRatio"))},P=v(0),O=v(!1),ve=async()=>{O.value=!0;const e=await H(R.value,r.value);O.value=!1,e.success&&(r.value=null,z(),U())};let M=v([]);const q=v([]),U=async()=>{const e=await i();q.value=[],!(!e.success||!e.result.length)&&((e.result||[]).forEach(async o=>{const d=await fe(o);q.value.push(d)}),M.value=q.value)},fe=async e=>{const o=await V(e);if(!o.success)return;const d=_.value.findIndex(u=>u.pid===+o.result.pid),g=+(o.result.dueTime||0),Y=g-_.value[d].duration;return{loanId:e,...o.result,loanAmount:h(se(o.result.loanAmount)),collateralAmount:h(se(o.result.collateralAmount)),startTime:te(Y),endTime:te(g),loanStatus:new Date().getTime()<g*1e3?1:2,loanLoading:!1,rolloverLoading:!1}},he=async(e,o)=>{console.log(e,"222"),M.value[o].loanLoading=!0;const d=await T(e);M.value[o].loanLoading=!1,d.success&&U()},Ae=async(e,o)=>{M.value[o].rolloverLoading=!0;const d=await S(e);M.value[o].rolloverLoading=!1,d.success&&U()},_e=async()=>{X(),N(),await me(),await re(),z(),U()};return Le(async()=>{_e()}),(e,o)=>{const d=L("van-skeleton"),g=L("VanButton"),Y=L("van-loading"),Z=L("VanField");return l(),m("div",ss,[s("div",ts,[f(Re,{class:"z-50",info:a(n).userInfo},null,8,["info"]),f(Ue,{class:"mr-auto ml-[5px]"}),f(Fe,{tokens:["MCOIN","MUSD","MAI"],onHandleTo:o[0]||(o[0]=u=>e.$router.push(u)),class:"z-50 asset-max-width"}),os]),f(De,{icon:"svg/ecology/mortgage.svg",text:e.$t("ecology.calculateCurrency")},{default:y(()=>[s("div",as,[I(" \u501F\u51FA\u65F6\u957F "),s("div",ns,t(e.$t("ecology.lendingDuration")),1),_.value.length===0?(l(),C(d,{key:0,class:"mb-3",row:3})):(l(),m("div",ls,[(l(!0),m(E,null,Q(_.value.slice(1),(u,j)=>(l(),C(g,{class:Ie(["text-sm font-medium h-[35px] px-4 rounded pool-btn",{"hover-bg":u.pid===R.value}]),key:j,onClick:Ds=>ge(u,j+1)},{default:y(()=>[A(t(a(ee)(u.duration)+e.$t("ecology.day")),1)]),_:2},1032,["class","onClick"]))),128))])),a($)?(l(),m("div",is,[cs,s("div",ds,[s("div",null,t(e.$t("ecology.borrowingCosts"))+"\uFF1A"+t(a(h)(a($).interestRate)||"-")+"%",1),s("div",null,t(e.$t("ecology.penaltyRatio"))+"\uFF1A"+t(a($).penaltyRate||"-")+"%",1),s("div",null,t(e.$t("ecology.Additional",{day:a(ie)[a(ee)(a($).duration)]||0}))+"\uFF1A"+t(a(h)(a($).interestRate)||"-")+"%",1),s("div",null,t(e.$t("ecology.borrowingfeesreturn")),1)])])):I("v-if",!0),s("section",null,[s("div",us,[s("div",rs,t(e.$t("ecology.loanAmount")),1),s("div",ps,[A(t(e.$t("ecology.mortgageable assets"))+"\uFF1A ",1),a(le)?(l(),C(Y,{key:0,size:"18px"})):(l(),m("span",gs,t(a(Ce)(a(h)(a(n).maiBalance||0))),1)),ms])]),s("div",vs,[f(Z,{class:"text-[32px] bg-[#fff9f0] font-bold","input-align":"left",modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=u=>r.value=u),type:"number",placeholder:"0"},null,8,["modelValue"]),s("div",fs,[(l(!0),m(E,null,Q(a(n).percents,u=>(l(),m("div",{class:"text-xs text-oriange1 border border-solid border-oriange1 rounded-md px-1 py-[2px] hover:bg-[#ffcd89]",key:u.value,onClick:j=>ce(u.value)},t(u.name),9,hs))),128))])])]),I(" \u501F\u8D37\u9884\u89C8 "),s("div",As,[s("span",_s,t(e.$t("ecology.loan preview")),1),s("div",ys,[s("div",ws,t(e.$t("ecology.collateralAssets")),1),s("div",bs,t(a(h)(r.value/F.value*1.25||0))+" MAI",1)]),s("div",xs,[s("div",Ms,t(e.$t("ecology.collateralPrice")),1),s("div",Ls,t(a(h)((r.value||0)*1.25))+" MUSD",1)]),s("div",Is,[s("div",Cs,t(e.$t("ecology.loanAmount")),1),s("div",$s,t(r.value||0)+" MUSD",1)]),s("div",ks,[s("div",Bs,t(e.$t("ecology.actualArrival")),1),s("div",Rs,t(r.value||0)+" MUSD",1)])]),s("div",Fs,[f(g,{class:"btn h-[35px] min-w-[100px] px-4",disabled:a(n).isAuthMai,loading:a(n).authLoading,onClick:de},{default:y(()=>[A(t(e.$t("assets.auth"))+" MAI",1)]),_:1},8,["disabled","loading"]),f(g,{class:"btn h-[35px] min-w-[100px] px-4",loading:O.value,disabled:!a(n).isAuthMai||a(n).authLoading,onClick:ve},{default:y(()=>[A(t(e.$t("ecology.submitApplication")),1)]),_:1},8,["loading","disabled"])])]),I(" \u6211\u7684\u501F\u8D37\u5386\u53F2 "),f(es,{list:a(M),authMusd:a(n).isAuthMusd,musdAllowance:K.value,authMusdLoading:a(n).authMusdLoading,onApproveMusd:ue,onRepay:he,onRollover:Ae},null,8,["list","authMusd","musdAllowance","authMusdLoading"])]),_:1},8,["text"])])}}}),Ys=oe(Us,[["__scopeId","data-v-c2753ef4"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/Mortgage.vue"]]);export{Ys as default};
