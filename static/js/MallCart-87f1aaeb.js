import{a as D,o as J,aA as G,aB as ae,aC as se,G as i,aD as V,d as I,aE as le,aF as F,aG as q,aH as A,aI as ce,aJ as re,aK as ie,D as P,aL as ue,aM as M,aN as de,aO as me,aP as fe,aQ as he,aR as ge,m as U,aw as Q,aS as Ce,aT as pe,aU as ve,aV as be,aW as j,aX as Be,aY as ke,aZ as _e,a_ as we,a$ as ye,b0 as xe,b1 as Te,_ as K,A as Ae,E,b as _,e as T,g as b,t as x,F as X,s as Z,H as N,h as B,a9 as Ie,W as Se,j as z,L as Oe,B as $e,C as Pe,k as Ee,p as Ne,l as De,ac as Le}from"./index-dd2b66f1.js";import{_ as He}from"./mall-9e8f333c.js";import{O as Re}from"./OrderGoods-acf9dca6.js";import{a as Fe,b as Me,c as Ve,d as qe}from"./cart-188dc918.js";import"./MCOIN-c941fc3b.js";const Ue=(e,t)=>{const a=D(),o=()=>{a.value=se(e).height};return J(()=>{if(G(o),t)for(let l=1;l<=3;l++)setTimeout(o,100*l)}),ae(()=>G(o)),a};function Ke(e,t){const a=Ue(e,!0);return o=>i("div",{class:t("placeholder"),style:{height:a.value?`${a.value}px`:void 0}},[o()])}const[ee,W]=V("action-bar"),te=Symbol(ee),Ge={placeholder:Boolean,safeAreaInsetBottom:F};var je=I({name:ee,props:Ge,setup(e,{slots:t}){const a=D(),o=Ke(a,W),{linkChildren:l}=le(te);l();const d=()=>{var h;return i("div",{ref:a,class:[W(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(h=t.default)==null?void 0:h.call(t)])};return()=>e.placeholder?o(d):d()}});const ze=q(je),[We,Ye]=V("action-bar-button"),Je=A({},ce,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var Qe=I({name:We,props:Je,setup(e,{slots:t}){const a=re(),{parent:o,index:l}=ie(te),d=P(()=>{if(o){const m=o.children[l.value-1];return!(m&&"isButton"in m)}}),h=P(()=>{if(o){const m=o.children[l.value+1];return!(m&&"isButton"in m)}});return ue({isButton:!0}),()=>{const{type:m,icon:f,text:k,color:p,loading:w,disabled:C}=e;return i(M,{class:Ye([m,{last:h.value,first:d.value}]),size:"large",type:m,icon:f,color:p,loading:w,disabled:C,onClick:a},{default:()=>[t.default?t.default():k]})}}});const Y=q(Qe),[Xe,v,$]=V("dialog"),Ze=A({},de,{title:String,theme:String,width:me,message:[String,Function],callback:Function,allowHtml:Boolean,className:fe,transition:he("van-dialog-bounce"),messageAlign:String,closeOnPopstate:F,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:F,closeOnClickOverlay:Boolean}),et=[...ge,"transition","closeOnPopstate"];var ne=I({name:Xe,props:Ze,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:t,slots:a}){const o=D(),l=U({confirm:!1,cancel:!1}),d=c=>t("update:show",c),h=c=>{var n;d(!1),(n=e.callback)==null||n.call(e,c)},m=c=>()=>{!e.show||(t(c),e.beforeClose?(l[c]=!0,we(e.beforeClose,{args:[c],done(){h(c),l[c]=!1},canceled(){l[c]=!1}})):h(c))},f=m("cancel"),k=m("confirm"),p=be(c=>{var n,r;if(c.target!==((r=(n=o.value)==null?void 0:n.popupRef)==null?void 0:r.value))return;({Enter:e.showConfirmButton?k:j,Escape:e.showCancelButton?f:j})[c.key](),t("keydown",c)},["enter","esc"]),w=()=>{const c=a.title?a.title():e.title;if(c)return i("div",{class:v("header",{isolated:!e.message&&!a.default})},[c])},C=c=>{const{message:n,allowHtml:r,messageAlign:s}=e,g=v("message",{"has-title":c,[s]:s}),y=Be(n)?n():n;return r&&typeof y=="string"?i("div",{class:g,innerHTML:y},null):i("div",{class:g},[y])},L=()=>{if(a.default)return i("div",{class:v("content")},[a.default()]);const{title:c,message:n,allowHtml:r}=e;if(n){const s=!!(c||a.title);return i("div",{key:r?1:0,class:v("content",{isolated:!s})},[C(s)])}},H=()=>i("div",{class:[_e,v("footer")]},[e.showCancelButton&&i(M,{size:"large",text:e.cancelButtonText||$("cancel"),class:v("cancel"),style:{color:e.cancelButtonColor},loading:l.cancel,disabled:e.cancelButtonDisabled,onClick:f},null),e.showConfirmButton&&i(M,{size:"large",text:e.confirmButtonText||$("confirm"),class:[v("confirm"),{[ke]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:l.confirm,disabled:e.confirmButtonDisabled,onClick:k},null)]),R=()=>i(ze,{class:v("footer")},{default:()=>[e.showCancelButton&&i(Y,{type:"warning",text:e.cancelButtonText||$("cancel"),class:v("cancel"),color:e.cancelButtonColor,loading:l.cancel,disabled:e.cancelButtonDisabled,onClick:f},null),e.showConfirmButton&&i(Y,{type:"danger",text:e.confirmButtonText||$("confirm"),class:v("confirm"),color:e.confirmButtonColor,loading:l.confirm,disabled:e.confirmButtonDisabled,onClick:k},null)]}),O=()=>a.footer?a.footer():e.theme==="round-button"?R():H();return()=>{const{width:c,title:n,theme:r,message:s,className:g}=e;return i(ve,Q({ref:o,role:"dialog",class:[v([r]),g],style:{width:pe(c)},tabindex:0,"aria-labelledby":n||s,onKeydown:p,"onUpdate:show":d},Ce(e,et)),{default:()=>[w(),L(),O()]})}}});let S;function tt(){({instance:S}=xe({setup(){const{state:t,toggle:a}=Te();return()=>i(ne,Q(t,{"onUpdate:show":a}),null)}}))}function u(e){return ye?new Promise((t,a)=>{S||tt(),S.open(A({},u.currentOptions,e,{callback:o=>{(o==="confirm"?t:a)(o)}}))}):Promise.resolve()}u.defaultOptions={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};u.currentOptions=A({},u.defaultOptions);u.alert=u;u.confirm=e=>u(A({showCancelButton:!0},e));u.close=()=>{S&&S.toggle(!1)};u.setDefaultOptions=e=>{A(u.currentOptions,e)};u.resetDefaultOptions=()=>{u.currentOptions=A({},u.defaultOptions)};u.Component=q(ne);u.install=e=>{e.use(u.Component),e.config.globalProperties.$dialog=u};const nt={class:"flex-start mt-2.5"},ot=b("img",{src:He,class:"w-4 mr-1"},null,-1),at={class:"text-base font-semibold"},st={class:"bg-white mt-2.5 rounded-xl p-2.5"},lt=I({props:{cartInfo:{type:null,required:!0}},emits:["changeNumber","handelDel","handleTo"],setup(e,{emit:t}){const{cartInfo:a}=e,{t:o}=Ae(),l=U({timeOutEvent:null}),d=()=>{clearTimeout(l.timeOutEvent),l.timeOutEvent=setTimeout(()=>{l.timeOutEvent=0},600)},h=(m,f)=>{clearTimeout(l.timeOutEvent),l.timeOutEvent===0&&u.confirm({message:o("cart.remove"),confirmButtonText:o("common.confirm"),confirmButtonColor:"#FEA021",cancelButtonText:o("common.cancel")}).then(()=>{t("handelDel",a,m,f)}).catch(()=>{})};return(m,f)=>{const k=E("van-checkbox");return _(),T("div",null,[b("div",nt,[ot,b("div",at,x(e.cartInfo.storeName||"-"),1)]),(_(!0),T(X,null,Z(e.cartInfo.goods,(p,w)=>(_(),T("div",st,[i(k,{name:p,class:"min-w-min"},{default:N(()=>[i(Re,{goods:p,number:p.number||1,class:"w-full flex-1 mb-2.5 last:mb-0",onChangeNumber:C=>t("changeNumber",p,C),onTouchstart:f[0]||(f[0]=C=>d()),onTouchend:C=>h(p,w),onMousedown:f[1]||(f[1]=C=>d()),onMouseup:C=>h(p,w),onHandleTo:f[2]||(f[2]=C=>t("handleTo",C))},null,8,["goods","number","onChangeNumber","onTouchend","onMouseup"])]),_:2},1032,["name"])]))),256))])}}}),ct=K(lt,[["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/mallCart/components/CartStore.vue"]]);const rt={class:"fixed safe-bottom-page bottom-0 w-full px-2.5 safe-bottom sm:bottom-[5%] lg:bottom-[10%] z-20"},it={class:"w-full h-14 flex items-center justify-between pb-0.5 px-2 bg-white rounded-full sm:w-[355px] shadow-2"},ut={class:"opacity-70"},dt={key:0,class:"ml-2 text-default text-sm"},mt={class:"opacity-70"},ft={class:"text-primary text-base font-semibold"},ht={key:0},gt=I({props:{goodsChecked:{type:null,required:!0},loading:{type:Boolean,required:!0},isCheckAll:{type:Boolean,required:!0},totalAmount:{type:null,required:!0}},emits:["totalCheck","handleCartBuy"],setup(e,{emit:t}){return(a,o)=>{const l=E("van-radio"),d=E("VanButton");return _(),T("div",rt,[b("div",it,[b("div",{class:"flex items-end justify-between text-default",onClick:o[0]||(o[0]=h=>t("totalCheck"))},[i(l,{checked:e.isCheckAll,"checked-color":"#FEA021"},{default:N(()=>[b("span",ut,x(a.$t("common.checkAll")),1)]),_:1},8,["checked"]),e.goodsChecked&&e.goodsChecked.length?(_(),T("div",dt,[b("span",mt,x(a.$t("common.total")),1),b("span",ft,x(B(Ie)(B(Se)(e.totalAmount||0)))+"Mcoin",1)])):z("v-if",!0)]),i(d,{class:"btn-orange btn-shadow px-8 h-[40px] text-white",loading:e.loading,disabled:!e.goodsChecked.length,onClick:o[1]||(o[1]=h=>t("handleCartBuy"))},{default:N(()=>[Oe(x(a.$t("cart.settle")),1),e.goodsChecked&&e.goodsChecked.length?(_(),T("span",ht,"("+x(e.goodsChecked.length)+")",1)):z("v-if",!0)]),_:1},8,["loading","disabled"])])])}}}),Ct=K(gt,[["__scopeId","data-v-362c8168"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/mallCart/components/CartSubmitBar.vue"]]);const pt=e=>(Ne("data-v-7ac48904"),e=e(),De(),e),vt={class:"p-2.5"},bt={class:"text-xl font-semibold"},Bt=pt(()=>b("div",{class:"safe-bottom-page"},null,-1)),kt=I({setup(e){const t=U({total:0,originList:[],list:[],goodsChecked:[]}),a=$e(),{loadingToggle:o}=Le(),l=n=>{a.push(n)},d=D(null),h=P(()=>t.originList.length>0&&t.originList.length===t.goodsChecked.length),m=P(()=>{let n=0;for(let r of t.goodsChecked)n+=r.price*r.number;return n}),f=async(n,r)=>{o(!0);const s=await Ve({goodsId:n.goodsId,number:r});o(!1),s.success&&(n.number=r)},k=()=>{h.value?w():p()},p=()=>{d.value.toggleAll(!0)},w=()=>{d.value.toggleAll()},C=async(n,r,s)=>{o(!0),(await qe(r.goodsId)).success&&n.goods.splice(s,1)},L=async()=>{o(!0);const n=await Fe();o(!1),!(!n.success||!n.data)&&(t.originList=n.data||[],t.total=t.originList.length,H(t.originList))},H=n=>{t.list=n.reduce((r,s)=>{const g=s.id;s.id=s.goodsId,s.icons=s.icon,s.checked===1&&t.goodsChecked.push(s);const y=r.findIndex(oe=>oe.storeId===s.storeId);return y!==-1?r[y].goods.push(s):r.push({id:g,storeId:s.storeId,storeName:s.storeName,goods:[s]}),r},[])},[R,O]=Pe(!1),c=async()=>{O(!0);let n=[];t.goodsChecked.forEach(s=>{n.push(s.id)});const r=await Me(n.join(","));O(!1),r.success&&l("/submitOrderCart")};return J(()=>{L()}),(n,r)=>{const s=E("van-checkbox-group");return _(),T("div",null,[b("div",vt,[i(s,{modelValue:B(t).goodsChecked,"onUpdate:modelValue":r[0]||(r[0]=g=>B(t).goodsChecked=g),ref:(g,y)=>{y.checkboxGroup=g,d.value=g},"checked-color":"#FEA021"},{default:N(()=>[b("div",bt,x(n.$t("cart.cart"))+"("+x(B(t).total)+")",1),(_(!0),T(X,null,Z(B(t).list,g=>(_(),Ee(ct,{cartInfo:g,onChangeNumber:f,onHandelDel:C,onHandleTo:l},null,8,["cartInfo"]))),256))]),_:1},8,["modelValue"])]),Bt,i(Ct,{goodsChecked:B(t).goodsChecked,isCheckAll:B(h),totalAmount:B(m),loading:B(R),onTotalCheck:k,onHandleCartBuy:c},null,8,["goodsChecked","isCheckAll","totalAmount","loading"])])}}}),At=K(kt,[["__scopeId","data-v-7ac48904"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/mallCart/MallCart.vue"]]);export{At as default};
