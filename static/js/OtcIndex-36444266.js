import{_ as ne,d as oe,A as fe,aw as Oe,D as X,E as D,b as y,e as T,g as e,h as s,t as n,G as P,ao as Ie,k as C,F as ie,s as ge,H as B,L as I,K as te,Z as Me,ax as _e,M as ee,ay as Be,az as Se,z as Fe,a4 as H,a6 as G,a8 as Ce,aA as re,a2 as le,a5 as pe,a3 as he,m as ue,w as we,a as E,C as ce,o as me,W as j,X as Z,P as se,j as U,p as xe,l as ke,at as ye,u as Le,ac as Ue}from"./index-e87e19e8.js";const Te=""+new URL("../images/sell-28e94682.svg",import.meta.url).href,Pe=""+new URL("../images/buy-0ac551f5.svg",import.meta.url).href;const De={class:"pt-5"},Ve={class:"flex items-center h-5 text-[#2E2008] text-base"},qe=["src"],Ne={class:"font-semibold ml-0.5"},Re={class:"bg-[#FFF1D9]/[0.6] rounded-xl mt-2.5 p-4 pb-1.5"},Ee={class:"w-full"},je={class:"flex"},ze={class:"my-th w-4/12"},We={class:"my-th w-5/12"},He={class:"my-th w-3/12"},Ge={key:1,class:"max-h-36 w-full overflow-auto pt-1.5"},Xe={class:"w-4/12 text-overflow"},Ke={class:"text-base font-medium text-[#2E2008]"},Ye={class:"w-5/12 text-overflow"},Ze={class:"text-base font-medium text-[#2E2008]"},Je={class:"w-3/12 text-overflow"},Qe=oe({props:{type:{type:null,required:!0},list:{type:Array,required:!0},isOld:{type:Boolean,required:!1}},emits:["onClick","onCheckMyOrder"],setup(o,{emit:u}){const{type:$,list:F}=o,_=fe();Oe();const M=X(()=>{const w={icon:Te,title:_.t("ecology.Sellorders"),subTitle:_.t("ecology.mysellorder"),btnText:_.t("ecology.buyin")};return $=="buy"&&(w.icon=Pe,w.title=_.t("ecology.buyorder"),w.subTitle=_.t("ecology.mybill"),w.btnText=_.t("ecology.sellout")),w}),L=w=>{u("onClick",$,w)},g=()=>{u("onCheckMyOrder",$)};return(w,v)=>{const x=D("van-icon"),z=D("van-skeleton"),b=D("VanButton");return y(),T("div",De,[e("div",Ve,[e("img",{src:s(M).icon,class:"w-5",alt:""},null,8,qe),e("span",Ne,n(s(M).title),1),e("span",{class:"ml-auto font-medium opacity-80",onClick:g},n(s(M).subTitle),1),P(x,{class:"font-semibold text-sm mx-px",name:"arrow",onClick:g})]),e("div",Re,[e("div",Ee,[e("div",je,[e("span",ze,n(w.$t("mall.price")),1),e("span",We,n(w.$t("ecology.quantity")),1),e("span",He,n(w.$t("shop.operation")),1)]),s(Ie)?(y(),C(z,{key:0,class:"mt-3",row:3})):(y(),T("div",Ge,[(y(!0),T(ie,null,ge(o.list,A=>(y(),T("div",{class:"flex w-full py-2.5",key:A.price},[e("span",Xe,[e("span",Ke,n(A.price),1)]),e("span",Ye,[e("span",Ze,n(A.amount),1)]),e("span",Je,[P(b,{class:te(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":o.type=="buy"}]),onClick:k=>L(A),disabled:o.isOld},{default:B(()=>[I(n(s(M).btnText),1)]),_:2},1032,["class","onClick","disabled"])])]))),128))]))])])])}}}),ve=ne(Qe,[["__scopeId","data-v-1cc2456f"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OtcOrder.vue"]]);const et={class:"w-[21rem] p-5 bg-[#FFFDF8] text-xs text-[#2E2008]"},tt={class:"flex justify-between items-center pb-4 header font-semibold text-base"},st=oe({props:{show:{type:Boolean,required:!0},title:{type:null,required:!0}},emits:["close"],setup(o,{emit:u}){const{show:$,title:F}=o,_=()=>{u("close")};return(M,L)=>{const g=D("van-icon"),w=D("van-popup");return y(),C(w,_e(M.$attrs,{show:o.show,"onUpdate:show":L[0]||(L[0]=v=>ee($)?$.value=v:null),round:"","overlay-class":"",onClose:_}),{default:B(()=>[e("div",et,[e("div",tt,[e("span",null,n(o.title),1),P(g,{name:"cross",class:"font-semibold text-xl",onClick:_})]),e("div",null,[Me(M.$slots,"default",{},void 0,!0)])])]),_:3},16,["show"])}}}),be=ne(st,[["__scopeId","data-v-41985eb3"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyDialog.vue"]]),de=o=>{const u=o?Be():Se(),$=Fe().getCurrentAccount();return{pending:async(t,a,c)=>{try{const d=await(await u.pending(t,le(a),le(c))).wait();return H(d)}catch(d){return pe(d),G(d)}},usdtAddress:async()=>{try{const t=await u.USDT();return H(t)}catch(t){return G(t)}},MIN_AMOUNT:async()=>{try{const t=await u.MIN_AMOUNT();return Ce(t)}catch{return 0}},MIN_REMAIN_AMOUNT:async()=>{try{const t=await u.MIN_REMAIN_AMOUNT();return H(t)}catch(t){return G(t)}},lastPrice:async()=>{try{const t=await u.lastPrice();return re(t.toString())}catch{return 0}},getMarketPrices:async t=>{try{const a=await u.getMarketPrices(t);return H(a)}catch(a){return G(a)}},getPriceTotals:async(t,a)=>{try{const c=await u.getPriceTotals(t,le(a));return H(c)}catch(c){return G(c)}},getMarketIds:async(t,a)=>{try{const c=await u.getMarketIds(t,a);return H(c)}catch(c){return G(c)}},getOrderInfo:async t=>{try{const a=await u.getOrderInfo(t);return H(a)}catch(a){return G(a)}},batchTrade:async t=>{try{const c=await(await await u.batchTrade(t)).wait();return H(c)}catch(a){return pe(a),G(a)}},trade:async(t,a)=>{try{const c=await u.estimateGas.trade(t,le(a)),K=await(await await u.trade(t,le(a),{gasLimit:he(c,3e3)})).wait();return H(K)}catch(c){return pe(c),G(c)}},getPendingIds:async()=>{try{const t=await u.getPendingIds($);return H(t)}catch(t){return G(t)}},cancel:async t=>{try{const a=await u.estimateGas.cancel(t),d=await(await await u.cancel(t.toString(),{gasLimit:he(a,3e3)})).wait();return H(d)}catch(a){return pe(a),G(a)}},musdAddress:async()=>{try{const t=await u.MUSD();return H(t)}catch(t){return G(t)}},maiAddress:async()=>{try{const t=await u.MAI();return H(t)}catch(t){return G(t)}}}};const nt={class:"mt-4 text-[#2E2008]"},ot={class:"text-sm font-medium"},at={class:"bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},lt={class:"mt-5 text-sm font-medium"},rt={class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},ct={class:"text-base opacity-60"},it={class:"flex flex-col items-center justify-center mt-5"},ut={key:3,class:"mt-5 text-center"},dt={key:4,class:"mt-5 text-center"},pt=oe({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},lastPrice:{type:null,required:!0}},emits:["update:show","success"],setup(o,{emit:u}){const{show:$,type:F}=o,{t:_}=fe(),{musdAddress:M,MIN_AMOUNT:L,maiAddress:g,pending:w}=de(),v=ue({number:null,price:null}),x=X(()=>{const r={title:_("ecology.Pendingpurchase"),numberText:_("ecology.buyquantity"),priceText:_("ecology.buyprice")};return F=="sell"&&(r.title=_("ecology.Hangforsale"),r.numberText=_("ecology.sellquantity"),r.priceText=_("ecology.sellingprice")),r}),z=X(()=>l.value>0&&(F==="buy"?l.value>=b.value:l.value>=+N.value));we(()=>v.price,(r,p)=>{A.value||(b.value=+r*+v.number)}),we(()=>v.number,(r,p)=>{k.value||(b.value=+r*+v.price)});const b=E(null),A=E(!1),k=E(!1),O=()=>{A.value=!1,k.value=!0},W=()=>{A.value=!0,k.value=!1},[i,t]=ce(!1),a=()=>{u("update:show",!1)},c=E(""),d=async()=>{const r=F==="buy"?await M():await g();!r.success||(c.value=r.result)},K=async()=>{t(!0);const r=await await Z(c.value).approve(se.otc);t(!1),r.success&&V()},l=E(null),V=async()=>{t(!0);const r=await(await Z(c.value)).allowance(se.otc);l.value=r.result||0,t(!1)},q=E(0),J=async()=>{const r=await L();q.value=+r},N=E(0),ae=async()=>{const r=await Z(c.value).balanceOf();N.value=+r},[f,S]=ce(!1),m=async()=>{S(!0);const r=await w(F==="buy"?1:2,v.price,v.number);S(!1),r.success&&(a(),u("success"))},h=async()=>{V(),J(),ae()};return me(async()=>{await d(),h()}),(r,p)=>{const Q=D("VanField"),R=D("VanButton");return y(),C(be,{show:o.show,"onUpdate:show":p[2]||(p[2]=Y=>ee($)?$.value=Y:null),title:s(x).title,onClose:a},{default:B(()=>[e("div",nt,[e("div",ot,n(s(x).numberText)+" "+n(l.value),1),e("div",at,[P(Q,{class:"bg-[#fff9f0] text-3xl font-bold",onFocus:W,modelValue:s(v).number,"onUpdate:modelValue":p[0]||(p[0]=Y=>s(v).number=Y),type:"number",placeholder:"0"},null,8,["modelValue"])]),e("div",lt,n(s(x).priceText),1),e("div",rt,[P(Q,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:s(v).price,"onUpdate:modelValue":p[1]||(p[1]=Y=>s(v).price=Y),onFocus:O,type:"number",placeholder:"0"},null,8,["modelValue"]),e("span",ct,n((o.type==="buy","MUSD")),1)]),e("div",it,[s(z)?o.type==="buy"?(y(),C(R,{key:1,onClick:m,disabled:+s(v).price<=0||s(v).number<q.value||b.value>N.value,loading:s(f),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:B(()=>[I(n(r.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(y(),C(R,{key:2,onClick:m,disabled:+s(v).price<=0||s(v).number<q.value||s(v).number>N.value,loading:s(f),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:B(()=>[I(n(r.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(y(),C(R,{key:0,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",loading:s(i),onClick:K},{default:B(()=>[I(n(r.$t("assets.auth"))+" "+n(o.type==="buy"?"MUSD":"MAI"),1)]),_:1},8,["loading"])),o.type=="sell"?(y(),T("div",ut,[e("div",null,"MAI:"+n(N.value),1),e("div",null,n(r.$t("ecology.new price"))+" "+n(o.lastPrice),1),e("div",null,n(r.$t("ecology.hand num"))+" "+n(q.value)+"MAI",1),e("div",null,n(r.$t("ecology.estimated get"))+" "+n(s(j)(b.value*.7))+" MUSD "+n(r.$t("ecology.otcDeduct")),1)])):(y(),T("div",dt,[e("div",null,"MUSD: "+n(N.value),1),e("div",null,n(r.$t("ecology.new price"))+" "+n(o.lastPrice),1),e("div",null,n(r.$t("ecology.hand num"))+" "+n(q.value)+" MAI",1),e("div",null,n(r.$t("ecology.estimated consume"))+" "+n(b.value)+" MUSD",1)]))])])]),_:1},8,["show","title"])}}}),mt=ne(pt,[["__scopeId","data-v-6f90ea23"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/PostForm.vue"]]);const $e=o=>(xe("data-v-67dbb134"),o=o(),ke(),o),yt={class:"mt-5"},ft={class:"flex justify-between"},gt={class:"text-base font-semibold"},bt={class:"text-base font-medium opacity-80"},ht={class:"flex justify-between mt-2.5"},wt={class:"text-base font-semibold"},vt={class:"text-base font-medium opacity-80"},_t={class:"flex justify-between mt-6"},xt={class:"text-sm font-medium"},kt={class:"text-sm opacity-80"},$t={class:"flex justify-between items-center bg-[#fff9f0] rounded-lg py-2.5 pr-2.5 mt-2.5"},At={class:"flex flex-col items-center justify-center mt-5"},Ot={class:"mt-5 text-center w-56"},It={key:2,class:"mt-2 text-center"},Mt={class:"text-[#FBA923]"},Bt=I(" MAI "),St=$e(()=>e("br",null,null,-1)),Ft={class:"text-[#FBA923]"},Ct=I(" MUSD"),Lt={key:3,class:"mt-2 text-center"},Ut={class:"text-[#FBA923]"},Tt=I(" MAI "),Pt=$e(()=>e("br",null,null,-1)),Dt={class:"text-[#FBA923]"},Vt=oe({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0},isAuth:{type:Boolean,required:!0},orderInfo:{type:null,required:!0},musdBalance:{type:[Number,String],required:!0},tokenBalance:{type:[Number,String],required:!0},musdAllowance:{type:[Number,String],required:!0},tokenAllowance:{type:[Number,String],required:!0},otcAddress:{type:String,required:!0}},emits:["update:show","approve","success"],setup(o,{emit:u}){const{show:$,type:F,token:_,musd:M,isAuth:L,orderInfo:g,musdBalance:w,tokenBalance:v,otcAddress:x,tokenAllowance:z,musdAllowance:b}=o,{trade:A}=de(),k=ue({isAuth:!1,btnLoading:!1}),O=X(()=>g.remain<d.number),W=X(()=>g.remain>10?`1-${j(g.remain-10)}`:g.remain),i=X(()=>{if(F=="buy")return 1;if(F=="sell")return 2}),t=()=>{u("update:show",!1)},a=async()=>{k.btnLoading=!0;let l;if(i.value===1?l=await Z(_).approve(x):l=await Z(M).approve(x),!l.success)return k.btnLoading=!1;k.isAuth=!0,u("approve"),k.btnLoading=!1,c()},c=async()=>{if(!L&&!k.isAuth)return a();const l=g.remain;if(i.value===1){if(l>z&&l<=v)return a()}else if(l>b&&l<=w)return a();k.btnLoading=!0;try{(await A(g.id,+d.number)).success&&u("success")}finally{k.btnLoading=!1}},d=ue({number:""}),K=()=>{i.value===1?d.number=+v<+g.remain?v:g.remain:d.number=+w/g.price<+g.remain?+w/g.price:g.remain};return(l,V)=>{const q=D("VanField"),J=D("VanButton");return y(),C(be,{show:o.show,"onUpdate:show":V[1]||(V[1]=N=>ee($)?$.value=N:null),title:o.type=="sell"?l.$t("otc.buyIn"):l.$t("otc.sellOut"),onClose:t,overlay:!1},{default:B(()=>[e("div",yt,[e("div",ft,[e("span",gt,n(l.$t("mall.price")),1),e("span",bt,n(s(j)(o.orderInfo.price||0,4))+" MUSD",1)]),e("div",ht,[e("span",wt,n(l.$t("ecology.total")),1),e("span",vt,n(s(j)(o.orderInfo.remain||0,4))+" MAI",1)]),e("div",_t,[e("span",xt,n(o.type=="sell"?l.$t("ecology.buyquantity"):l.$t("ecology.sellquantity")),1),e("span",kt,n(o.type=="sell"?"MUSD":"MAI")+n(l.$t("assets.balance"))+n(o.type=="sell"?o.musdBalance:o.tokenBalance),1)]),e("div",$t,[P(q,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:s(d).number,"onUpdate:modelValue":V[0]||(V[0]=N=>s(d).number=N),type:"number",placeholder:"0"},null,8,["modelValue"]),e("div",{class:"px-1.5 py-1 border-[1px] rounded border-[#FBA923] border-solid text-xs text-[#FBA923] font-medium",onClick:K},"MAX ")]),e("div",At,[o.isAuth||s(k).isAuth?(y(),C(J,{key:0,loading:s(k).btnLoading,disabled:!s(d).number||+s(d).number<=0||s(O),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",onClick:c},{default:B(()=>[I(n(l.$t("common.submit")),1)]),_:1},8,["loading","disabled"])):(y(),C(J,{key:1,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",disabled:!s(d).number||+s(d).number<=0||s(O),loading:s(k).btnLoading,onClick:a},{default:B(()=>[I(n(l.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading"])),e("div",Ot,n(l.$t("ecology.tips",{Currency:o.type=="sell"?"MAI":"MUSD",num:s(W)})),1),U(" \u83B7\u5F97 "),o.type==="sell"?(y(),T("div",It,[I(n(l.$t("ecology.estimated get"))+" ",1),e("span",Mt,n(s(d).number||0),1),Bt,St,I(" "+n(l.$t("ecology.Estimatedconsumption"))+" ",1),e("span",Ft,n(s(j)(+o.orderInfo.price*+s(d).number)),1),Ct])):(y(),T("div",Lt,[I(n(l.$t("ecology.Estimatedconsumption"))+" ",1),e("span",Ut,n(+s(d).number||0),1),Tt,Pt,I(" "+n(l.$t("ecology.estimated get")),1),e("span",Dt,n(s(j)(+s(d).number*+o.orderInfo.price*.7)),1),I(" MUSD "+n(l.$t("ecology.otcDeduct")),1)]))])])]),_:1},8,["show","title"])}}}),qt=ne(Vt,[["__scopeId","data-v-67dbb134"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperateDetail.vue"]]);const Nt={class:"mt-4"},Rt={class:"text-sm text-[#2E2008] font-medium"},Et={class:"text-white flex flex-col justify-center items-center mt-5 font-semibold text-sm"},jt={key:0,class:"mt-2.5 text-center"},zt=oe({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},price:{type:Number,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0}},emits:["update:show","success"],setup(o,{emit:u}){const{show:$,type:F,price:_,token:M,musd:L}=o,g=fe(),{getMarketIds:w,getOrderInfo:v,batchTrade:x,MIN_AMOUNT:z}=de(),b=se.otc,[A,k]=ce(!1),O=E([]),W=f=>{O.value=f},i=ue({orderInfo:{},amountShow:!1,list:[],btnLoading:!1,tokenAllowance:"",tokenBalance:"",musdAllowance:"",musdBalance:""}),t=X(()=>+i.tokenAllowance>=+i.tokenBalance&&+i.tokenAllowance>0),a=X(()=>+i.musdAllowance>=+i.musdBalance&&+i.musdAllowance>0),c=X(()=>{const f={title:g.t("ecology.buy"),btnText:g.t("ecology.buyin"),batchBtnText:g.t("ecology.Bulkbuy"),btnClass:"btn-green"};return F=="buy"&&(f.title=g.t("ecology.Sell"),f.btnText=g.t("ecology.sellout"),f.batchBtnText=g.t("ecology.sellinbulk"),f.btnClass="btn-pink"),f}),d=X(()=>{if(F=="buy")return 1;if(F=="sell")return 2}),K=()=>{u("update:show",!1)},l=async()=>{const f=await Z(L).allowance(se.otc);i.musdAllowance=f.result,i.musdBalance=String(j(await Z(L).balanceOf()));const S=await Z(M).allowance(se.otc);i.tokenAllowance=S.result,i.tokenBalance=String(j(await Z(M).balanceOf()))},V=async()=>{const f=await w(d.value,le(_)),S=[];for(let m=0;m<f.result.length;m++){const h=await v(f.result[m]);S.push({id:f.result[m],price:_,remain:re(h.result.remain.toString())})}i.list=S},q=async()=>{i.btnLoading=!0;let f;if(d.value===1?f=await Z(M).approve(se.otc):f=await Z(L).approve(se.otc),!f.success)return i.btnLoading=!1;await l(),J()},J=async()=>{const f=i.list.reduce((S,m)=>O.value.find(h=>h==m.id)?S+m.remain:S,0);if(d.value===1){if(f>i.tokenAllowance&&f<=i.tokenBalance)return q()}else if(f>i.musdAllowance&&f<=i.musdBalance)return q();i.btnLoading=!0;try{(await x(O.value)).success&&u("success")}finally{i.btnLoading=!1}},N=f=>{i.orderInfo=f,k(!0)},ae=()=>{k(!1),u("success")};return me(async()=>{i.btnLoading=!0,await l(),await V(),i.btnLoading=!1}),(f,S)=>{const m=D("van-checkbox"),h=D("VanButton"),r=D("van-checkbox-group");return y(),T(ie,null,[P(be,{show:o.show,"onUpdate:show":S[1]||(S[1]=p=>ee($)?$.value=p:null),title:`${o.price}${s(c).title}`,onClose:K,"close-on-click-overlay":!s(A)},{default:B(()=>[e("div",Nt,[P(r,{modelValue:O.value,"onUpdate:modelValue":S[0]||(S[0]=p=>O.value=p),onChange:W},{default:B(()=>[(y(!0),T(ie,null,ge(s(i).list,p=>(y(),T("div",{class:"flex justify-between items-center bg-[#fff9f0] rounded-lg p-2.5 mt-2.5",key:p.id},[P(m,{name:p.id,"icon-size":"1rem","checked-color":"#14D8A9"},{default:B(()=>[e("span",Rt,n(s(j)(p.remain||0,4))+" MAI",1)]),_:2},1032,["name"]),P(h,{class:te(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":o.type=="buy"}]),onClick:Q=>N(p)},{default:B(()=>[I(n(s(c).btnText),1)]),_:2},1032,["class","onClick"])]))),128))]),_:1},8,["modelValue"]),e("div",Et,[U(" \u6388\u6743 "),s(d)==1&&!s(t)||s(d)==2&&!s(a)?(y(),C(h,{key:0,disabled:!O.value.length,loading:s(i).btnLoading,class:te(["py-3 flex-1 w-40",s(c).btnClass]),onClick:q},{default:B(()=>[I(n(f.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading","class"])):(y(),T(ie,{key:1},[U(" \u6279\u91CF\u8D2D\u4E70 "),P(h,{disabled:!O.value.length,loading:s(i).btnLoading,class:te(["py-3 flex-1 w-40",s(c).btnClass]),onClick:J},{default:B(()=>[I(n(s(c).batchBtnText),1)]),_:1},8,["disabled","loading","class"])],2112))]),o.type==="buy"?(y(),T("div",jt,n(f.$t("ecology.otcDeduct")),1)):U("v-if",!0)])]),_:1},8,["show","title","close-on-click-overlay"]),s(A)?(y(),C(qt,{key:0,type:o.type,show:s(A),"onUpdate:show":S[2]||(S[2]=p=>ee(A)?A.value=p:null),token:o.token,musd:o.musd,isAuth:o.type=="sell"?s(a):s(t),isMusdtAuth:s(a),orderInfo:s(i).orderInfo,musdBalance:s(i).musdBalance,tokenBalance:s(i).tokenBalance,otcAddress:s(b),tokenAllowance:s(i).tokenAllowance,musdAllowance:s(i).musdAllowance,onApprove:l,onSuccess:ae},null,8,["type","show","token","musd","isAuth","isMusdtAuth","orderInfo","musdBalance","tokenBalance","otcAddress","tokenAllowance","musdAllowance"])):U("v-if",!0)],64)}}}),Wt=ne(zt,[["__scopeId","data-v-176626b2"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperatePopup.vue"]]),Ht=""+new URL("../images/Rectangle_L_O-1a09b3b3.svg",import.meta.url).href,Gt=""+new URL("../images/Rectangle_L_W-bf92913e.svg",import.meta.url).href,Xt=""+new URL("../images/Rectangle_R_O-b6604591.svg",import.meta.url).href,Kt=""+new URL("../images/Rectangle_R_W-ed1e7ed6.svg",import.meta.url).href;const Yt={class:"w-[21rem] bg-[#FFFDF8] text-xs text-[#2E2008]"},Zt={class:"container"},Jt={class:"flex justify-between items-center font-semibold text-base py-4 px-5"},Qt={class:"h-10 flex relative"},es=["src"],ts=["src"],ss={class:"h-10 z-10 flex items-center w-[21rem] text-base font-medium"},ns={class:"p-2.5 maxH overflow-auto"},os={class:"flex justify-between header pb-2.5"},as={class:"text-xl font-bold"},ls={class:"flex justify-between mt-2.5 text-sm"},rs={class:"opacity-80"},cs={class:"font-semibold"},is={class:"flex justify-between mt-2.5 text-sm"},us={class:"opacity-80"},ds={class:"font-semibold"},ps={class:"flex justify-between mt-2.5 text-sm"},ms={class:"opacity-80"},ys={class:"font-semibold"},fs=oe({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},isOld:{type:Boolean,required:!1}},emits:["update:show","success"],setup(o,{emit:u}){const{show:$,type:F,isOld:_}=o,{getPendingIds:M,cancel:L,getOrderInfo:g}=de(_),w=()=>{u("update:show",!1)},v=X(()=>x.value==="buy"?O.value.filter(t=>t.direct===1):O.value.filter(t=>t.direct===2)),x=E("buy"),z=t=>{x.value!=t&&(x.value=t)},b=X(()=>x.value=="buy"?Gt:Ht),A=X(()=>x.value=="sell"?Kt:Xt),k=E([]),O=E([]),W=async()=>{const t=await M();!t.success||(k.value=t.result,k.value.forEach(async a=>{const c=await g(a);O.value.push({direct:+c.result.direct,price:j(ye(c.result.price)),total:j(ye(c.result.total)),remain:j(ye(c.result.remain)),token:c.result.token,sender:c.result.sender,status:+c.result.status,id:a,loading:!1})}))},i=async t=>{t.loading=!0;const a=await L(t.id);t.loading=!1,a.success&&(w(),u("success"))};return me(()=>{x.value=F,W()}),(t,a)=>{const c=D("van-icon"),d=D("VanButton"),K=D("van-popup");return y(),C(K,_e(t.$attrs,{show:o.show,"onUpdate:show":a[2]||(a[2]=l=>ee($)?$.value=l:null),style:{height:"80vh"},round:"","overlay-class":"",onClose:w}),{default:B(()=>[e("div",Yt,[e("div",Zt,[e("div",Jt,[e("span",null,n(t.$t("ecology.mypendingorder")),1),P(c,{name:"cross",class:"font-semibold text-xl",onClick:w})]),e("div",Qt,[e("img",{class:te(["h-10 absolute left-0 bottom-[-1px]",{"z-10":x.value=="buy"}]),src:s(b),alt:""},null,10,es),e("img",{class:te(["h-10 absolute right-0 bottom-[-1px]",{"z-10":x.value=="sell"}]),src:s(A),alt:""},null,10,ts),e("div",ss,[e("span",{class:te(["text-[#2E2008] flex-1 text-center",{"text-[#FEA021]":x.value=="buy"}]),onClick:a[0]||(a[0]=l=>z("buy"))},n(t.$t("ecology.mybill")),3),e("span",{class:te(["text-[#2E2008] opacity-60 flex-1 text-center",{"text-[#FEA021]":x.value=="sell"}]),onClick:a[1]||(a[1]=l=>z("sell"))},n(t.$t("ecology.mysellorder")),3)])])]),e("div",ns,[U(" \u8BA2\u5355\u9879 "),(y(!0),T(ie,null,ge(s(v),(l,V)=>(y(),T("div",{class:"bg-[#FFF1D9]/[0.4] rounded p-2.5 mt-2.5 order-box",key:V},[e("div",os,[e("span",as,n(l.price||0),1),U(" \u64A4\u9500 "),l.status==1?(y(),C(d,{key:0,class:"btn-border px-3.5 h-[28px] rounded-2xl text-xs text-[#FBA923] font-medium min-w-[65px] text-center"},{default:B(()=>[I(n(t.$t("ecology.completed")),1)]),_:1})):U("v-if",!0),l.status==0?(y(),C(d,{key:1,onClick:q=>i(l),loading:l.loading,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:B(()=>[I(n(t.$t("ecology.revoke")),1)]),_:2},1032,["onClick","loading"])):U("v-if",!0),l.status===2?(y(),C(d,{key:2,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:B(()=>[I(n(t.$t("ecology.canceled")),1)]),_:1})):U("v-if",!0)]),e("div",ls,[e("span",rs,n(t.$t("ecology.Totalendingorders")),1),e("span",cs,n(l.total||0)+" MAI",1)]),e("div",is,[e("span",us,n(t.$t("ecology.transactionquantity")),1),e("span",ds,n(l.total-l.remain||0)+" MAI",1)]),e("div",ps,[e("span",ms,n(t.$t("ecology.remainingquantity")),1),e("span",ys,n(l.remain||0)+" MAI",1)])]))),128))])])]),_:1},16,["show"])}}}),gs=ne(fs,[["__scopeId","data-v-0ab69f7b"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyOtcOrder.vue"]]);const Ae=o=>(xe("data-v-5b5e4784"),o=o(),ke(),o),bs={class:"bg-[#FFFDF8] rounded-xl p-2.5 pt-5 pb-3.5"},hs={class:"flex-center flex-col text-[#F36B07] rounded-xl bg-[#FFF1D9]/[0.6] py-5 font-normal text-sm"},ws={class:"text-3xl font-bold"},vs=Ae(()=>e("span",{class:"ml-2"},"MUSD",-1)),_s={class:"text-[#2E2008] font-medium opacity-60"},xs={class:"pt-2.5 pb-1 flex justify-between text-white font-semibold text-sm"},ks=Ae(()=>e("div",{class:"w-5"},null,-1)),$s=oe({props:{isOld:{type:Boolean,required:!1}},setup(o){const u=o,{loadingToggle:$}=Ue(),{lastPrice:F,getMarketPrices:_,getMarketIds:M,maiAddress:L,musdAddress:g,getOrderInfo:w}=de(u.isOld),{reloadStore:v}=Le(),x=1,z=2,b=ue({token:"",musd:"",sellOrderList:[],buyOrderList:[],lastPrice:0,selectPrice:0,minAmount:0,maxAmount:0}),A=E(),k=E(""),O=E(""),[W,i]=ce(!1),[t,a]=ce(!1),[c,d]=ce(!1),K=m=>{k.value=m,i(!0)},l=(m,h)=>{A.value=h.price,O.value=m,a(!0)},V=m=>{O.value=m,d(!0)},q=async()=>{const m=await F();b.lastPrice=m||0},J=async()=>{const m=await L(),h=await g();b.token=m.result,b.musd=h.result},N=async()=>{const m=await _(z),h=[];for(let r=0;r<m.result.length;r++){const p=await M(z,m.result[r]);let Q=0;for(let R=0;R<p.result.length;R++){const Y=await w(p.result[R]);Q+=re(Y.result.remain.toString())}h.push({price:re(m.result[r].toString()),amount:j(Q)}),b.sellOrderList=h.filter(R=>R.amount!==0),b.sellOrderList=b.sellOrderList.sort((R,Y)=>R.price-Y.price)}},ae=async()=>{const m=await _(x),h=[];for(let r=0;r<m.result.length;r++){const p=await M(x,m.result[r]);let Q=0;for(let R=0;R<p.result.length;R++){const Y=await w(p.result[R]);Q+=re(Y.result.remain.toString())}h.push({price:re(m.result[r].toString()),amount:j(Q)})}b.buyOrderList=h.filter(r=>r.amount!==0),b.buyOrderList=b.buyOrderList.sort((r,p)=>p.price-r.price)},f=async()=>{v.reload(),ae(),N(),q(),a(!1)},S=async()=>{$(!0),await Promise.all([J(),q(),N(),ae()]),$(!1)};return me(async()=>{await S()}),(m,h)=>{const r=D("VanButton");return y(),T("div",bs,[e("div",hs,[e("div",null,[e("span",ws,n(s(b).lastPrice),1),vs]),e("div",_s,n(m.$t("ecology.Latesttransactionprice")),1)]),e("div",xs,[P(r,{class:"flex-1 h-10 px-4 btn-green",onClick:h[0]||(h[0]=p=>K("buy")),disabled:o.isOld},{default:B(()=>[I(n(m.$t("ecology.Pendingpurchase")),1)]),_:1},8,["disabled"]),ks,P(r,{class:"flex-1 h-10 px-4 btn-pink",onClick:h[1]||(h[1]=p=>K("sell")),disabled:o.isOld},{default:B(()=>[I(n(m.$t("ecology.Hangforsale")),1)]),_:1},8,["disabled"])]),P(ve,{type:"sell",onOnClick:l,onOnCheckMyOrder:V,list:s(b).sellOrderList,isOld:o.isOld},null,8,["list","isOld"]),P(ve,{type:"buy",onOnClick:l,onOnCheckMyOrder:V,list:s(b).buyOrderList,isOld:o.isOld},null,8,["list","isOld"]),U(" \u53D1\u5E03\u7684\u5F39\u7A97 "),s(W)?(y(),C(mt,{key:0,show:s(W),"onUpdate:show":h[2]||(h[2]=p=>ee(W)?W.value=p:null),onSuccess:f,type:k.value,lastPrice:s(b).lastPrice},null,8,["show","type","lastPrice"])):U("v-if",!0),U(" \u4E70\u5165\u5356\u51FA\u64CD\u4F5C\u5F39\u7A97 "),s(t)?(y(),C(Wt,{key:1,show:s(t),"onUpdate:show":h[3]||(h[3]=p=>ee(t)?t.value=p:null),type:O.value,price:A.value,token:s(b).token,musd:s(b).musd,onSuccess:f},null,8,["show","type","price","token","musd"])):U("v-if",!0),U(" \u6211\u7684\u8BA2\u5355\u5F39\u7A97 "),s(c)?(y(),C(gs,{key:2,show:s(c),"onUpdate:show":h[4]||(h[4]=p=>ee(c)?c.value=p:null),type:O.value,isOld:o.isOld,success:"handleSuccess"},null,8,["show","type","isOld"])):U("v-if",!0)])}}}),Os=ne($s,[["__scopeId","data-v-5b5e4784"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/OtcIndex.vue"]]);export{Os as O};
