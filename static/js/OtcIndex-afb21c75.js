import{_ as oe,d as ae,A as fe,D as G,E as V,b as h,e as X,g as t,h as s,t as n,G as P,ao as ke,k as T,F as ie,s as be,H as C,L as N,K as se,j as q,Z as $e,aw as _e,M as ee,ax as Ae,ay as Oe,z as Ie,a4 as z,a6 as W,a8 as Me,az as re,a2 as le,a5 as pe,a3 as he,m as ue,w as we,a as E,C as ce,o as me,X as Z,P as ne,W as H,at as ye,u as Be,p as Ce,l as Fe,ac as Se}from"./index-08fb0670.js";const Le=""+new URL("../images/sell-28e94682.svg",import.meta.url).href,Te=""+new URL("../images/buy-0ac551f5.svg",import.meta.url).href;const Ue={class:"pt-5"},Pe={class:"flex items-center h-5 text-[#2E2008] text-base"},Ve=["src"],qe={class:"font-semibold ml-0.5"},Ne={class:"bg-[#FFF1D9]/[0.6] rounded-xl mt-2.5 p-4 pb-1.5"},Re={class:"w-full"},De={class:"flex"},Ee={class:"my-th w-4/12"},je={class:"my-th w-5/12"},ze={class:"my-th w-3/12"},We={key:1,class:"max-h-36 w-full overflow-auto pt-1.5"},He={class:"w-4/12 text-overflow"},Ge={class:"text-base font-medium text-[#2E2008]"},Xe={class:"w-5/12 text-overflow"},Ke={class:"text-base font-medium text-[#2E2008]"},Ye={class:"w-3/12 text-overflow"},Ze=ae({props:{type:{type:null,required:!0},list:{type:Array,required:!0},isOld:{type:Boolean,required:!1}},emits:["onClick","onCheckMyOrder"],setup(o,{emit:c}){const{type:A,list:S}=o,v=fe(),M=G(()=>{const w={icon:Le,title:v.t("ecology.Sellorders"),subTitle:v.t("ecology.mysellorder"),btnText:v.t("ecology.buyin")};return A=="buy"&&(w.icon=Te,w.title=v.t("ecology.buyorder"),w.subTitle=v.t("ecology.mybill"),w.btnText=v.t("ecology.sellout")),w}),L=w=>{c("onClick",A,w)},p=()=>{c("onCheckMyOrder",A)};return(w,x)=>{const k=V("van-icon"),j=V("van-skeleton"),m=V("VanButton");return h(),X("div",Ue,[t("div",Pe,[t("img",{src:s(M).icon,class:"w-5",alt:""},null,8,Ve),t("span",qe,n(s(M).title),1),t("span",{class:"ml-auto font-medium opacity-80",onClick:p},n(s(M).subTitle),1),P(k,{class:"font-semibold text-sm mx-px",name:"arrow",onClick:p})]),t("div",Ne,[t("div",Re,[t("div",De,[t("span",Ee,n(w.$t("mall.price")),1),t("span",je,n(w.$t("ecology.quantity")),1),t("span",ze,n(w.$t("shop.operation")),1)]),s(ke)?(h(),T(j,{key:0,class:"mt-3",row:3})):(h(),X("div",We,[(h(!0),X(ie,null,be(o.list,O=>(h(),X("div",{class:"flex w-full py-2.5",key:O.price},[t("span",He,[t("span",Ge,n(O.price),1)]),t("span",Xe,[t("span",Ke,n(O.amount),1)]),t("span",Ye,[P(m,{class:se(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":o.type=="buy"}]),onClick:U=>L(O),disabled:o.isOld},{default:C(()=>[N(n(s(M).btnText),1)]),_:2},1032,["class","onClick","disabled"])])]))),128))]))]),q(` <table border="1" class="w-full">
        <thead>
          <tr>
            <th class="my-th w-4/12">{{ $t('mall.price') }}</th>
            <th class="my-th w-5/12">{{ $t('ecology.quantity') }}</th>
            <th class="my-th w-3/12">{{ $t('shop.operation') }}</th>
          </tr>
        </thead>
        <tbody class="max-h-36">
          <tr class="h-10 leading-10 " v-for="(item, index) in list" :key="item.price">
            <td class="w-4/12">
              <span class="text-base font-medium text-[#2E2008]">{{ item.price }}</span>
            </td>
            <td class="w-5/12">
              <span class="text-base font-medium text-[#2E2008]">{{ item.amount }}</span>
            </td>
            <td class="w-3/12">
              <VanButton class="align-middle btn rounded px-3.5 h-6 leading-6" :class="{ 'btn-buy': type == 'buy' }"
                @click="onClick">
                {{ labels.btnText }}
              </VanButton>
            </td>
          </tr>
        </tbody>

      </table> `)])])}}}),ve=oe(Ze,[["__scopeId","data-v-1cc2456f"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OtcOrder.vue"]]);const Je={class:"w-[21rem] p-5 bg-[#FFFDF8] text-xs text-[#2E2008]"},Qe={class:"flex justify-between items-center pb-4 header font-semibold text-base"},et=ae({props:{show:{type:Boolean,required:!0},title:{type:null,required:!0}},emits:["close"],setup(o,{emit:c}){const{show:A,title:S}=o,v=()=>{c("close")};return(M,L)=>{const p=V("van-icon"),w=V("van-popup");return h(),T(w,_e(M.$attrs,{show:o.show,"onUpdate:show":L[0]||(L[0]=x=>ee(A)?A.value=x:null),round:"","overlay-class":"",onClose:v}),{default:C(()=>[t("div",Je,[t("div",Qe,[t("span",null,n(o.title),1),P(p,{name:"cross",class:"font-semibold text-xl",onClick:v})]),t("div",null,[$e(M.$slots,"default",{},void 0,!0)])])]),_:3},16,["show"])}}}),ge=oe(et,[["__scopeId","data-v-41985eb3"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyDialog.vue"]]),de=o=>{const c=o?Ae():Oe(),A=Ie().getCurrentAccount();return{pending:async(e,l,r)=>{try{const $=await(await c.pending(e,le(l),le(r))).wait();return z($)}catch($){return pe($),W($)}},usdtAddress:async()=>{try{const e=await c.USDT();return z(e)}catch(e){return W(e)}},MIN_AMOUNT:async()=>{try{const e=await c.MIN_AMOUNT();return Me(e)}catch{return 0}},MIN_REMAIN_AMOUNT:async()=>{try{const e=await c.MIN_REMAIN_AMOUNT();return z(e)}catch(e){return W(e)}},lastPrice:async()=>{try{const e=await c.lastPrice();return re(e.toString())}catch{return 0}},getMarketPrices:async e=>{try{const l=await c.getMarketPrices(e);return z(l)}catch(l){return W(l)}},getPriceTotals:async(e,l)=>{try{const r=await c.getPriceTotals(e,le(l));return z(r)}catch(r){return W(r)}},getMarketIds:async(e,l)=>{try{const r=await c.getMarketIds(e,l);return z(r)}catch(r){return W(r)}},getOrderInfo:async e=>{try{const l=await c.getOrderInfo(e);return z(l)}catch(l){return W(l)}},batchTrade:async e=>{try{const r=await(await await c.batchTrade(e)).wait();return z(r)}catch(l){return pe(l),W(l)}},trade:async(e,l)=>{try{const r=await c.estimateGas.trade(e,le(l)),I=await(await await c.trade(e,le(l),{gasLimit:he(r,3e3)})).wait();return z(I)}catch(r){return pe(r),W(r)}},getPendingIds:async()=>{try{const e=await c.getPendingIds(A);return z(e)}catch(e){return W(e)}},cancel:async e=>{try{const l=await c.estimateGas.cancel(e),$=await(await await c.cancel(e.toString(),{gasLimit:he(l,3e3)})).wait();return z($)}catch(l){return pe(l),W(l)}},musdAddress:async()=>{try{const e=await c.MUSD();return z(e)}catch(e){return W(e)}},maiAddress:async()=>{try{const e=await c.MAI();return z(e)}catch(e){return W(e)}}}};const tt={class:"mt-4 text-[#2E2008]"},st={class:"text-sm font-medium"},nt={class:"bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},ot={class:"mt-5 text-sm font-medium"},at={class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},lt={class:"text-base opacity-60"},rt={class:"mt-5 flex flex-col justify-center items-center"},ct={key:2,class:"mt-5 text-center"},it={key:3,class:"mt-5 text-center"},ut=ae({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},lastPrice:{type:null,required:!0}},emits:["update:show","success"],setup(o,{emit:c}){const{show:A,type:S}=o,{t:v}=fe(),{musdAddress:M,MIN_AMOUNT:L,maiAddress:p,pending:w}=de(),x=ue({number:null,price:null}),k=G(()=>{const a={title:v("ecology.Pendingpurchase"),numberText:v("ecology.buyquantity"),priceText:v("ecology.buyprice")};return S=="sell"&&(a.title=v("ecology.Hangforsale"),a.numberText=v("ecology.sellquantity"),a.priceText=v("ecology.sellingprice")),a}),j=G(()=>(console.log(_.value),_.value>0&&_.value>=m.value));we(()=>x.price,(a,u)=>{console.log(a,"newVal"),!O.value&&(m.value=+a*+x.number)}),we(()=>x.number,(a,u)=>{U.value||(m.value=+a*+x.price)});const m=E(null),O=E(!1),U=E(!1),f=()=>{O.value=!1,U.value=!0},R=()=>{O.value=!0,U.value=!1},[i,e]=ce(!1),l=()=>{c("update:show",!1)},r=E(""),$=async()=>{const a=S==="buy"?await M():await p();!a.success||(r.value=a.result)},I=async()=>{e(!0);const a=await await Z(r.value).approve(ne.otc);e(!1),a.success&&b()},_=E(null),b=async()=>{e(!0);const a=await(await Z(r.value)).allowance(ne.otc);_.value=a.result||0,e(!1)},F=E(0),te=async()=>{const a=await L();F.value=+a},K=E(0),J=async()=>{const a=await Z(r.value).balanceOf();K.value=+a},[y,B]=ce(!1),d=async()=>{B(!0);const a=await w(S==="buy"?1:2,x.price,x.number);B(!1),a.success&&(l(),c("success"))},g=async()=>{b(),te(),J()};return me(async()=>{await $(),g()}),(a,u)=>{const Q=V("VanField"),D=V("VanButton");return h(),T(ge,{show:o.show,"onUpdate:show":u[2]||(u[2]=Y=>ee(A)?A.value=Y:null),title:s(k).title,onClose:l},{default:C(()=>[t("div",tt,[t("div",st,n(s(k).numberText),1),t("div",nt,[P(Q,{class:"bg-[#fff9f0] text-3xl font-bold",onFocus:R,modelValue:s(x).number,"onUpdate:modelValue":u[0]||(u[0]=Y=>s(x).number=Y),type:"number",placeholder:"0"},null,8,["modelValue"])]),t("div",ot,n(s(k).priceText),1),t("div",at,[P(Q,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:s(x).price,"onUpdate:modelValue":u[1]||(u[1]=Y=>s(x).price=Y),onFocus:f,type:"number",placeholder:"0"},null,8,["modelValue"]),t("span",lt,n(o.type==="buy"?"MUSD":"MAI"),1)]),t("div",rt,[s(j)?(h(),T(D,{key:1,onClick:d,disabled:+s(x).price<=0||s(x).number<F.value||m.value>K.value,loading:s(y),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:C(()=>[N(n(a.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(h(),T(D,{key:0,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",loading:s(i),onClick:I},{default:C(()=>[N(n(a.$t("assets.auth"))+" "+n(o.type==="buy"?"MUSD":"MAI"),1)]),_:1},8,["loading"])),o.type=="sell"?(h(),X("div",ct,[t("div",null,"MAI:"+n(K.value),1),t("div",null,n(a.$t("ecology.new price"))+n(o.lastPrice),1),t("div",null,n(a.$t("ecology.hand num"))+" "+n(F.value)+"MAI",1),t("div",null,n(a.$t("ecology.estimated get"))+" "+n(m.value)+"MUSD",1)])):(h(),X("div",it,[t("div",null,"MUSD: "+n(K.value),1),t("div",null,n(a.$t("ecology.new price"))+n(o.lastPrice),1),t("div",null,n(a.$t("ecology.hand num"))+" "+n(F.value)+"MAI",1),t("div",null,n(a.$t("ecology.estimated consume"))+" "+n(m.value)+"MUSD",1)]))])])]),_:1},8,["show","title"])}}}),dt=oe(ut,[["__scopeId","data-v-6f90ea23"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/PostForm.vue"]]);const pt={class:"mt-5"},mt={class:"flex justify-between"},yt={class:"text-base font-semibold"},ft={class:"text-base font-medium opacity-80"},bt={class:"flex justify-between mt-2.5"},gt={class:"text-base font-semibold"},ht={class:"text-base font-medium opacity-80"},wt={class:"flex justify-between mt-6"},vt={class:"text-sm font-medium"},_t={class:"text-sm opacity-80"},xt={class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg py-2.5 pr-2.5 mt-2.5"},kt={class:"flex flex-col items-center justify-center mt-5"},$t={class:"mt-5 text-center w-56"},At={class:"mt-2"},Ot={class:"text-[#FBA923]"},It=ae({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0},isAuth:{type:Boolean,required:!0},orderInfo:{type:null,required:!0},musdBalance:{type:[Number,String],required:!0},tokenBalance:{type:[Number,String],required:!0},musdAllowance:{type:[Number,String],required:!0},tokenAllowance:{type:[Number,String],required:!0},otcAddress:{type:String,required:!0}},emits:["update:show","approve","success"],setup(o,{emit:c}){const{show:A,type:S,token:v,musd:M,isAuth:L,orderInfo:p,musdBalance:w,tokenBalance:x,otcAddress:k,tokenAllowance:j,musdAllowance:m}=o,O=.05,{trade:U}=de(),f=ue({isAuth:!1,btnLoading:!1}),R=G(()=>p.remain<I.number),i=G(()=>p.remain>10?`1-${H(p.remain-10)}`:p.remain),e=G(()=>{if(S=="buy")return 1;if(S=="sell")return 2}),l=()=>{c("update:show",!1)},r=async()=>{f.btnLoading=!0;let b;if(e.value===1?b=await Z(v).approve(k):b=await Z(M).approve(k),!b.success)return f.btnLoading=!1;f.isAuth=!0,c("approve"),f.btnLoading=!1,$()},$=async()=>{if(!L&&!f.isAuth)return r();const b=p.remain;if(e.value===1){if(b>j&&b<=x)return r()}else if(b>m&&b<=w)return r();f.btnLoading=!0;try{(await U(p.id,+I.number)).success&&c("success")}finally{f.btnLoading=!1}},I=ue({number:""}),_=()=>{e.value===1?I.number=+x<+p.remain?x:p.remain:I.number=+w/p.price<+p.remain?+w/p.price:p.remain};return(b,F)=>{const te=V("VanField"),K=V("VanButton");return h(),T(ge,{show:o.show,"onUpdate:show":F[1]||(F[1]=J=>ee(A)?A.value=J:null),title:o.type=="sell"?b.$t("otc.buyIn"):b.$t("otc.sellOut"),onClose:l,overlay:!1},{default:C(()=>[t("div",pt,[t("div",mt,[t("span",yt,n(b.$t("mall.price")),1),t("span",ft,n(s(H)(o.orderInfo.price||0,4))+" MUSD",1)]),t("div",bt,[t("span",gt,n(b.$t("ecology.total")),1),t("span",ht,n(s(H)(o.orderInfo.remain||0,4))+" MAI",1)]),t("div",wt,[t("span",vt,n(o.type=="sell"?b.$t("ecology.buyquantity"):b.$t("ecology.sellquantity")),1),t("span",_t,n(o.type=="sell"?"MUSD":"MAI")+n(b.$t("assets.balance"))+n(o.type=="sell"?o.musdBalance:o.tokenBalance),1)]),t("div",xt,[P(te,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:s(I).number,"onUpdate:modelValue":F[0]||(F[0]=J=>s(I).number=J),type:"number",placeholder:"0"},null,8,["modelValue"]),t("div",{class:"px-1.5 py-1 border-[1px] rounded border-[#FBA923] border-solid text-xs text-[#FBA923] font-medium",onClick:_},"MAX ")]),t("div",kt,[o.isAuth||s(f).isAuth?(h(),T(K,{key:0,loading:s(f).btnLoading,disabled:!s(I).number||+s(I).number<=0||s(R),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",onClick:$},{default:C(()=>[N(n(b.$t("common.submit")),1)]),_:1},8,["loading","disabled"])):(h(),T(K,{key:1,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",disabled:!s(I).number||+s(I).number<=0||s(R),loading:s(f).btnLoading,onClick:r},{default:C(()=>[N(n(b.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading"])),t("div",$t,n(b.$t("ecology.tips",{Currency:o.type=="sell"?"MAI":"MUSD",num:s(i)})),1),t("div",At,[N("*"+n(b.$t("ecology.Estimatedconsumption"))+" ",1),t("span",Ot,n(s(e)===1?s(H)(+s(I).number*O):s(H)(+s(I).number*o.orderInfo.price*O)),1),N(" "+n(o.type=="sell"?"MUSD":"MAI"),1)])])])]),_:1},8,["show","title"])}}}),Mt=oe(It,[["__scopeId","data-v-67dbb134"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperateDetail.vue"]]);const Bt={class:"mt-4"},Ct={class:"text-sm text-[#2E2008] font-medium"},Ft={class:"text-white flex flex-col justify-center items-center mt-5 font-semibold text-sm"},St=ae({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},price:{type:Number,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0}},emits:["update:show","success"],setup(o,{emit:c}){const{show:A,type:S,price:v,token:M,musd:L}=o,p=fe(),{getMarketIds:w,getOrderInfo:x,batchTrade:k,MIN_AMOUNT:j}=de(),m=ne.otc,[O,U]=ce(!1),f=E([]),R=y=>{f.value=y},i=ue({orderInfo:{},amountShow:!1,list:[],btnLoading:!1,tokenAllowance:"",tokenBalance:"",musdAllowance:"",musdBalance:""}),e=G(()=>+i.tokenAllowance>0),l=G(()=>+i.musdAllowance>0),r=G(()=>{const y={title:p.t("ecology.buy"),btnText:p.t("ecology.buyin"),batchBtnText:p.t("ecology.Bulkbuy"),btnClass:"btn-green"};return S=="buy"&&(y.title=p.t("ecology.Sell"),y.btnText=p.t("ecology.sellout"),y.batchBtnText=p.t("ecology.sellinbulk"),y.btnClass="btn-pink"),y}),$=G(()=>{if(S=="buy")return 1;if(S=="sell")return 2}),I=()=>{c("update:show",!1)},_=async()=>{const y=await Z(L).allowance(ne.otc);i.musdAllowance=y.result,i.musdBalance=String(H(await Z(L).balanceOf()));const B=await Z(M).allowance(ne.otc);i.tokenAllowance=B.result,i.tokenBalance=String(H(await Z(M).balanceOf()))},b=async()=>{const y=await w($.value,le(v)),B=[];for(let d=0;d<y.result.length;d++){const g=await x(y.result[d]);B.push({id:y.result[d],price:v,remain:re(g.result.remain.toString())})}i.list=B},F=async()=>{i.btnLoading=!0;let y;if($.value===1?y=await Z(M).approve(ne.otc):y=await Z(L).approve(ne.otc),!y.success)return i.btnLoading=!1;await _(),te()},te=async()=>{const y=i.list.reduce((B,d)=>f.value.find(g=>g==d.id)?B+d.remain:B,0);if($.value===1){if(y>i.tokenAllowance&&y<=i.tokenBalance)return F()}else if(y>i.musdAllowance&&y<=i.musdBalance)return F();i.btnLoading=!0;try{(await k(f.value)).success&&c("success")}finally{i.btnLoading=!1}},K=y=>{i.orderInfo=y,U(!0)},J=()=>{U(!1),c("success")};return me(async()=>{i.btnLoading=!0,await _(),await b(),i.btnLoading=!1}),(y,B)=>{const d=V("van-checkbox"),g=V("VanButton"),a=V("van-checkbox-group");return h(),X(ie,null,[P(ge,{show:o.show,"onUpdate:show":B[1]||(B[1]=u=>ee(A)?A.value=u:null),title:`${o.price}${s(r).title}`,onClose:I,"close-on-click-overlay":!s(O)},{default:C(()=>[t("div",Bt,[P(a,{modelValue:f.value,"onUpdate:modelValue":B[0]||(B[0]=u=>f.value=u),onChange:R},{default:C(()=>[(h(!0),X(ie,null,be(s(i).list,u=>(h(),X("div",{class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg p-2.5 mt-2.5",key:u.id},[P(d,{name:u.id,"icon-size":"1rem","checked-color":"#14D8A9"},{default:C(()=>[t("span",Ct,n(s(H)(u.remain||0,4))+" MAI",1)]),_:2},1032,["name"]),P(g,{class:se(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":o.type=="buy"}]),onClick:Q=>K(u)},{default:C(()=>[N(n(s(r).btnText),1)]),_:2},1032,["class","onClick"])]))),128))]),_:1},8,["modelValue"]),t("div",Ft,[q(" \u6388\u6743 "),s($)==1&&!s(e)||s($)==2&&!s(l)?(h(),T(g,{key:0,disabled:!f.value.length,loading:s(i).btnLoading,class:se(["py-3 flex-1 w-40",s(r).btnClass]),onClick:F},{default:C(()=>[N(n(y.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading","class"])):(h(),X(ie,{key:1},[q(" \u6279\u91CF\u8D2D\u4E70 "),P(g,{disabled:!f.value.length,loading:s(i).btnLoading,class:se(["py-3 flex-1 w-40",s(r).btnClass]),onClick:te},{default:C(()=>[N(n(s(r).batchBtnText),1)]),_:1},8,["disabled","loading","class"])],2112))])])]),_:1},8,["show","title","close-on-click-overlay"]),s(O)?(h(),T(Mt,{key:0,type:o.type,show:s(O),"onUpdate:show":B[2]||(B[2]=u=>ee(O)?O.value=u:null),token:o.token,musd:o.musd,isAuth:o.type=="sell"?s(l):s(e),isMusdtAuth:s(l),orderInfo:s(i).orderInfo,musdBalance:s(i).musdBalance,tokenBalance:s(i).tokenBalance,otcAddress:s(m),tokenAllowance:s(i).tokenAllowance,musdAllowance:s(i).musdAllowance,onApprove:_,onSuccess:J},null,8,["type","show","token","musd","isAuth","isMusdtAuth","orderInfo","musdBalance","tokenBalance","otcAddress","tokenAllowance","musdAllowance"])):q("v-if",!0)],64)}}}),Lt=oe(St,[["__scopeId","data-v-176626b2"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperatePopup.vue"]]),Tt=""+new URL("../images/Rectangle_L_O-1a09b3b3.svg",import.meta.url).href,Ut=""+new URL("../images/Rectangle_L_W-bf92913e.svg",import.meta.url).href,Pt=""+new URL("../images/Rectangle_R_O-b6604591.svg",import.meta.url).href,Vt=""+new URL("../images/Rectangle_R_W-ed1e7ed6.svg",import.meta.url).href;const qt={class:"w-[21rem] bg-[#FFFDF8] text-xs text-[#2E2008]"},Nt={class:"container"},Rt={class:"flex justify-between items-center font-semibold text-base py-4 px-5"},Dt={class:"h-10 flex relative"},Et=["src"],jt=["src"],zt={class:"h-10 z-10 flex items-center w-[21rem] text-base font-medium"},Wt={class:"p-2.5 maxH overflow-auto"},Ht={class:"flex justify-between header pb-2.5"},Gt={class:"text-xl font-bold"},Xt={class:"flex justify-between mt-2.5 text-sm"},Kt={class:"opacity-80"},Yt={class:"font-semibold"},Zt={class:"flex justify-between mt-2.5 text-sm"},Jt={class:"opacity-80"},Qt={class:"font-semibold"},es={class:"flex justify-between mt-2.5 text-sm"},ts={class:"opacity-80"},ss={class:"font-semibold"},ns=ae({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},isOld:{type:Boolean,required:!1}},emits:["update:show"],setup(o,{emit:c}){const{show:A,type:S,isOld:v}=o,{getPendingIds:M,cancel:L,getOrderInfo:p}=de(v),w=()=>{c("update:show",!1)},x=G(()=>k.value==="buy"?f.value.filter(e=>e.direct===1):f.value.filter(e=>e.direct===2)),k=E("buy"),j=e=>{k.value!=e&&(k.value=e)},m=G(()=>k.value=="buy"?Ut:Tt),O=G(()=>k.value=="sell"?Vt:Pt),U=E([]),f=E([]),R=async()=>{const e=await M();!e.success||(U.value=e.result,U.value.forEach(async l=>{const r=await p(l);f.value.push({direct:+r.result.direct,price:H(ye(r.result.price)),total:H(ye(r.result.total)),remain:H(ye(r.result.remain)),token:r.result.token,sender:r.result.sender,status:+r.result.status,id:l})}))},i=async e=>{!(await L(e)).success||w()};return me(()=>{k.value=S,R()}),(e,l)=>{const r=V("van-icon"),$=V("VanButton"),I=V("van-popup");return h(),T(I,_e(e.$attrs,{show:o.show,"onUpdate:show":l[2]||(l[2]=_=>ee(A)?A.value=_:null),style:{height:"80vh"},round:"","overlay-class":"",onClose:w}),{default:C(()=>[t("div",qt,[t("div",Nt,[t("div",Rt,[t("span",null,n(e.$t("ecology.mypendingorder")),1),P(r,{name:"cross",class:"font-semibold text-xl",onClick:w})]),t("div",Dt,[t("img",{class:se(["h-10 absolute left-0 bottom-[-1px]",{"z-10":k.value=="buy"}]),src:s(m),alt:""},null,10,Et),t("img",{class:se(["h-10 absolute right-0 bottom-[-1px]",{"z-10":k.value=="sell"}]),src:s(O),alt:""},null,10,jt),t("div",zt,[t("span",{class:se(["text-[#2E2008] flex-1 text-center",{"text-[#FEA021]":k.value=="buy"}]),onClick:l[0]||(l[0]=_=>j("buy"))},n(e.$t("ecology.mybill")),3),t("span",{class:se(["text-[#2E2008] opacity-60 flex-1 text-center",{"text-[#FEA021]":k.value=="sell"}]),onClick:l[1]||(l[1]=_=>j("sell"))},n(e.$t("ecology.mysellorder")),3)])])]),t("div",Wt,[q(" \u8BA2\u5355\u9879 "),(h(!0),X(ie,null,be(s(x),(_,b)=>(h(),X("div",{class:"bg-[#FFF1D9]/[0.4] rounded p-2.5 mt-2.5 order-box",key:b},[t("div",Ht,[t("span",Gt,n(_.price||0),1),q(" \u64A4\u9500 "),_.status==1?(h(),T($,{key:0,class:"btn-border px-3.5 h-[28px] rounded-2xl text-xs text-[#FBA923] font-medium min-w-[65px] text-center"},{default:C(()=>[N(n(e.$t("ecology.completed")),1)]),_:1})):q("v-if",!0),_.status==0?(h(),T($,{key:1,onClick:F=>i(_.id),class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:C(()=>[N(n(e.$t("ecology.revoke")),1)]),_:2},1032,["onClick"])):q("v-if",!0),_.status===2?(h(),T($,{key:2,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:C(()=>[N(n(e.$t("ecology.canceled")),1)]),_:1})):q("v-if",!0)]),t("div",Xt,[t("span",Kt,n(e.$t("ecology.Totalendingorders")),1),t("span",Yt,n(_.total||0)+" MAI",1)]),t("div",Zt,[t("span",Jt,n(e.$t("ecology.transactionquantity")),1),t("span",Qt,n(_.total-_.remain||0)+" MAI",1)]),t("div",es,[t("span",ts,n(e.$t("ecology.remainingquantity")),1),t("span",ss,n(_.remain||0)+" MAI",1)])]))),128))])])]),_:1},16,["show"])}}}),os=oe(ns,[["__scopeId","data-v-0ab69f7b"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyOtcOrder.vue"]]);const xe=o=>(Ce("data-v-5b5e4784"),o=o(),Fe(),o),as={class:"bg-[#FFFDF8] rounded-xl p-2.5 pt-5 pb-3.5"},ls={class:"flex-center flex-col text-[#F36B07] rounded-xl bg-[#FFF1D9]/[0.6] py-5 font-normal text-sm"},rs={class:"text-3xl font-bold"},cs=xe(()=>t("span",{class:"ml-2"},"MUSD",-1)),is={class:"text-[#2E2008] font-medium opacity-60"},us={class:"pt-2.5 pb-1 flex justify-between text-white font-semibold text-sm"},ds=xe(()=>t("div",{class:"w-5"},null,-1)),ps=ae({props:{isOld:{type:Boolean,required:!1}},setup(o){const c=o,{loadingToggle:A}=Se(),{lastPrice:S,getMarketPrices:v,getMarketIds:M,maiAddress:L,musdAddress:p,getOrderInfo:w}=de(c.isOld),{reloadStore:x}=Be(),k=1,j=2,m=ue({token:"",musd:"",sellOrderList:[],buyOrderList:[],lastPrice:0,selectPrice:0,minAmount:0,maxAmount:0}),O=E(),U=E(""),f=E(""),[R,i]=ce(!1),[e,l]=ce(!1),[r,$]=ce(!1),I=d=>{U.value=d,i(!0)},_=(d,g)=>{O.value=g.price,f.value=d,l(!0)},b=d=>{f.value=d,$(!0)},F=async()=>{const d=await S();m.lastPrice=d||0},te=async()=>{const d=await L(),g=await p();m.token=d.result,m.musd=g.result},K=async()=>{const d=await v(j),g=[];for(let a=0;a<d.result.length;a++){const u=await M(j,d.result[a]);let Q=0;for(let D=0;D<u.result.length;D++){const Y=await w(u.result[D]);Q+=re(Y.result.remain.toString())}g.push({price:re(d.result[a].toString()),amount:H(Q)}),m.sellOrderList=g.filter(D=>D.amount!==0),m.sellOrderList=m.sellOrderList.sort((D,Y)=>D.price-Y.price)}},J=async()=>{const d=await v(k),g=[];for(let a=0;a<d.result.length;a++){const u=await M(k,d.result[a]);let Q=0;for(let D=0;D<u.result.length;D++){const Y=await w(u.result[D]);Q+=re(Y.result.remain.toString())}g.push({price:re(d.result[a].toString()),amount:H(Q)})}m.buyOrderList=g.filter(a=>a.amount!==0),m.buyOrderList=m.buyOrderList.sort((a,u)=>u.price-a.price)},y=async()=>{x.reload(),J(),K(),F(),l(!1)},B=async()=>{A(!0),await Promise.all([te(),F(),K(),J()]),A(!1)};return me(async()=>{await B()}),(d,g)=>{const a=V("VanButton");return h(),X("div",as,[t("div",ls,[t("div",null,[t("span",rs,n(s(m).lastPrice),1),cs]),t("div",is,n(d.$t("ecology.Latesttransactionprice")),1)]),t("div",us,[P(a,{class:"flex-1 h-10 px-4 btn-green",onClick:g[0]||(g[0]=u=>I("buy")),disabled:o.isOld},{default:C(()=>[N(n(d.$t("ecology.Pendingpurchase")),1)]),_:1},8,["disabled"]),ds,P(a,{class:"flex-1 h-10 px-4 btn-pink",onClick:g[1]||(g[1]=u=>I("sell")),disabled:o.isOld},{default:C(()=>[N(n(d.$t("ecology.Hangforsale")),1)]),_:1},8,["disabled"])]),P(ve,{type:"sell",onOnClick:_,onOnCheckMyOrder:b,list:s(m).sellOrderList,isOld:o.isOld},null,8,["list","isOld"]),P(ve,{type:"buy",onOnClick:_,onOnCheckMyOrder:b,list:s(m).buyOrderList,isOld:o.isOld},null,8,["list","isOld"]),q(" \u53D1\u5E03\u7684\u5F39\u7A97 "),s(R)?(h(),T(dt,{key:0,show:s(R),"onUpdate:show":g[2]||(g[2]=u=>ee(R)?R.value=u:null),onSuccess:y,type:U.value,lastPrice:s(m).lastPrice},null,8,["show","type","lastPrice"])):q("v-if",!0),q(" \u4E70\u5165\u5356\u51FA\u64CD\u4F5C\u5F39\u7A97 "),s(e)?(h(),T(Lt,{key:1,show:s(e),"onUpdate:show":g[3]||(g[3]=u=>ee(e)?e.value=u:null),type:f.value,price:O.value,token:s(m).token,musd:s(m).musd,onSuccess:y},null,8,["show","type","price","token","musd"])):q("v-if",!0),q(" \u6211\u7684\u8BA2\u5355\u5F39\u7A97 "),s(r)?(h(),T(os,{key:2,show:s(r),"onUpdate:show":g[4]||(g[4]=u=>ee(r)?r.value=u:null),type:f.value,isOld:o.isOld},null,8,["show","type","isOld"])):q("v-if",!0)])}}}),ys=oe(ps,[["__scopeId","data-v-5b5e4784"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/OtcIndex.vue"]]);export{ys as O};
