import{_ as te,d as ae,E as L,b as n,e as v,j as I,g as s,t as o,k as C,F as S,s as Q,G as f,H as y,L as _,A as ye,u as we,a as m,m as W,C as be,w as xe,D as Me,o as Le,h as a,as as ee,K as Ie,W as A,a9 as Ce,p as Be,l as $e,X as $,P as E,at as se,au as oe}from"./index-08fb0670.js";import{_ as ke}from"./Vector-light-ecef907e.js";import{U as Fe,a as Re,C as Ue}from"./ChangeLang-06468dcb.js";import{B as De}from"./BgBox-a59256fc.js";import{u as Ee}from"./lendingPoolContract-bfbdfeb9.js";import"./avatarRing-8eae2442.js";import"./level-93a6fb73.js";import"./TokenBalance-29aebd14.js";const Se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMsSURBVHgB7Zc9TBRBFMf/MztHUKJuo81RLEFNtDobNbFAEsVGg0iCIRYclbGTxspESbCwwthYclREY0BDbLQAE02UxmuMiUrYQhosPGNOCOzMODMHx+7dfl7s9Jfc7cd8vDfz3rz3FvjXIWgBOeM4HpgjIR1KUZGCVNiGVyajbgUZSa3A5pMjBQheVCP6CYgTMZmr/hYtzsfJsOummDZZATnl2Ft7rQeq4wgyQAhKaRSJVWBr5vBZWHIOEjZawOwIMMauLj+L6ROO97R7RHKU8BdQQopKiemIthDhj7svS2AOUeT2geTPg9jHzKOsfIJ0ZxGLIL254a+LiQqsKw+3KF2IcjQoodaZRyAdnYHXsvoNfOEa8Hs1dJgyY4Wt867Gk0Ib+1nUuhspvCNfFy7X3oOXJ8wP1VXzjl2YB/bmQ4eqpdq8w5psfu1Dr55RawUR0JP3QZ1BiNVXEG9vBBXXiimziM9TEOV7UVNAEn6ibcgt1+cMTKJWjxhovs9cxYeJpjb+8WGtT9cgYhG0GJgz2Cp7kIYwOytHNOT2xw6lhPSHKiDnHDvS9tt4b67XHC2M7ROh/SEOdbocHcp3nll98g1WAJWxg/F9CaE91LHUPqARa++QhM4jqAWpXQUIlbZENuhRlRoOHAc6z4HorVerF9u+EIdOYjv3dQWEgE0oMkELt3cn1cdy6VZ0HPCPY/xHkwLK/i6QdQ9q8JeXTDRMi/TYz7oydU3avTJaJItwI2vDa44DZMCtKNu4yIL2+GrylvvRGdIfjpm/UQpMKz+4g5R4L3rMCciExKL/MeB2AqKEDJhsmBB4GrEkH49UYI+qXvQuII1w5wqsvnmwi6/NfaoxEqXGCqnp4OXa+U1lqMTikh46tXt/8HRSd2P7xtWHKqCdEZwMIAGxMltzwK1fJjumYCysPowsyTZnuovKIaeQhHZCpUQcyqyjbcPLpbC22KJUl2YCcjIpSUWiTal2M6wU2yE2+OpqlgvRm9YxA7KVw7Eq74oTXtMxJaZWhCpYqOyJ2hEpTSB7DmqV2oa+pIqsrX2aqY8Vr50VdAY1SUzlEQbPTfs19B8/fwAnjyghAiecpAAAAABJRU5ErkJggg==";const Te={class:"bg-[#FFFDF8] rounded-2xl shadow-inset-2 px-2 py-4 mt-[10px]"},Ve={class:"flex-start text-2xl font-semibold"},He={key:1},Pe={class:"flex justify-between items-center border-line pb-[10px]"},Oe={class:"text-sm mb-[5px]"},qe={class:"opacity-60"},Ye={class:"flex-center-bw mb-[10px] mt-[10px]"},je={class:"text-sm"},Qe={class:"font-semibold"},Je={class:"flex-center-bw mb-[10px]"},Ke={class:"text-sm"},Xe={class:"font-semibold"},Ne={class:"flex-center-bw"},ze={class:"text-sm"},Ge={class:"font-semibold"},Ze={class:"flex-center gap-4 mt-5 text-white font-semibold"},We=ae({props:{list:{type:null,required:!1},authMusdLoading:{type:null,required:!0},authMusd:{type:null,required:!0},musdAllowance:{type:null,required:!0}},emits:["approveMusd","rollover","repay"],setup(g,{emit:w}){const T=async()=>{w("approveMusd")},V=(i,x)=>{w("rollover",i,x)},H=(i,x)=>{w("repay",i,x)};return(i,x)=>{const P=L("van-skeleton"),b=L("VanButton");return n(),v(S,null,[I(" \u501F\u8D37\u5386\u53F2 "),s("div",Te,[s("div",Ve,o(i.$t("ecology.my loan history")),1),g.list.length===0?(n(),C(P,{key:0,row:3})):(n(),v("div",He,[(n(!0),v(S,null,Q(g.list,(c,k)=>(n(),v("div",{class:"bg-[#fff9f0] mt-3 rounded-lg p-4",key:c.loanId},[s("div",Pe,[s("div",null,[s("div",Oe,o(i.$t("ecology.flow id"))+" "+o(c.loanId),1),s("div",qe,o(c.startTime),1)]),f(b,{class:"btn"},{default:y(()=>[_(o(c.loanStatus===1?i.$t("ecology.ongoing"):i.$t("ecology.overdue")),1)]),_:2},1024)]),s("div",Ye,[s("div",je,o(i.$t("ecology.loanAmount")),1),s("div",Qe,o(c.loanAmount)+" MUSD",1)]),s("div",Je,[s("div",Ke,o(i.$t("ecology.initial stake amount")),1),s("div",Xe,o(c.collateralAmount)+" MAI",1)]),s("div",Ne,[s("div",ze,o(i.$t("ecology.morgage date")),1),s("div",Ge,o(c.endTime),1)]),I(" \u7EED\u8D37\u548C\u5F52\u8FD8\u7EED\u8D37 "),s("div",Ze,[f(b,{class:"btn-item h-[35px] min-w-[100px] px-4",loading:c.rolloverLoading,disabled:+c.pid==0,onClick:r=>V(c.loanId,k)},{default:y(()=>[_(o(i.$t("ecology.relloverLoan")),1)]),_:2},1032,["loading","disabled","onClick"]),g.authMusd&&g.musdAllowance>=c.loanAmount?(n(),C(b,{key:0,class:"btn-item h-[35px] min-w-[100px] px-4",disabled:!g.authMusd,onClick:r=>H(c.loanId,k),loading:c.loanLoading},{default:y(()=>[_(o(i.$t("ecology.repayLoan")),1)]),_:2},1032,["disabled","onClick","loading"])):(n(),C(b,{key:1,class:"btn-item h-[35px] min-w-[100px] px-4",onClick:T,loading:g.authMusdLoading},{default:y(()=>[_(o(i.$t("assets.auth"))+" MUSD",1)]),_:1},8,["loading"]))])]))),128))]))])],2112)}}}),es=te(We,[["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MortgageHistory.vue"]]);const le=g=>(Be("data-v-c2753ef4"),g=g(),$e(),g),ss={class:"h-full relative"},os={class:"px-2.5 flex justify-between items-center py-5 relative header-bg"},ts=le(()=>s("img",{src:ke,alt:"",class:"absolute w-[125px] right-0 z-0"},null,-1)),as={class:"bg-[#FFFDF8] rounded-2xl shadow-inset-2 px-2 py-4"},ls={class:"text-2xl font-semibold mb-[10px]"},ns={key:1,class:"grid grid-cols-3 gap-4"},is={key:2,class:"flex-start w-full rounded-[10px] bg-[#fff9f0] p-[10px] mt-[10px] mb-[18px]"},us=le(()=>s("img",{class:"w-[18px] mr-[10px]",src:Se},null,-1)),cs={class:"opacity-60 default"},ds={class:"flex-center-bw"},rs={class:"flex-start text-2xl font-semibold"},ps={class:"opacity-80 flex-center"},gs={key:1},vs=_(" MAI "),ms={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},fs={class:"flex justify-end items-center gap-2 mt-2"},hs=["onClick"],As={class:"mt-[20px]"},_s={class:"text-2xl font-semibold"},ys={class:"flex-center-bw mb-[10px] mt-[10px]"},ws={class:"font-semibold"},bs={class:"font-medium"},xs={class:"flex-center-bw mb-[10px]"},Ms={class:"font-semibold"},Ls={class:"font-medium"},Is={class:"flex-center-bw mb-[10px]"},Cs={class:"font-semibold"},Bs={class:"font-medium"},$s={class:"flex-center-bw"},ks={class:"font-semibold"},Fs={class:"font-medium"},Rs={class:"flex-center gap-4 mt-5 text-white font-semibold"},Us=ae({setup(g){const{maiAddress:w,rollover:T,repay:V,loans:H,getLoanIds:i,getPrice:x,borrow:P,musdAddress:b,poolInfo:c,poolLength:k}=Ee();ye(),we();const r=m(null),l=W({userInfo:{address:""},percents:[{name:"25%",value:.25},{name:"50%",value:.5},{name:"75%",value:.75},{name:"MAX",value:1}],token0:"USDT",token1:"MUSD",balance0:0,balance1:0,resouceAmount:null,allowanceAmount:0,toAmount:0,authLoading:!1,isAuth:!1,exchangeLoading:!1,maiBalance:0,isAuthMai:!1,isAuthMusd:!1,authMusdLoading:!1}),[ne,J]=be(!1),ie=W({7:0,90:15,180:30,365:65});xe(()=>r.value,(e,t)=>{l.isAuthMai=+l.allowanceAmount>=+e&&l.allowanceAmount>0},{immediate:!0,deep:!0});const ue=e=>{console.log(e,"\u767E\u5206\u6BD4",U.value),r.value=A(e*U.value*.8)},K=m(0),X=async()=>{const e=await(await $(await b())).allowance(E.lendingPool);l.isAuthMusd=+e.result>0,K.value=e.result||0},N=async()=>{const e=await await $(await w()).allowance(E.lendingPool);l.isAuthMai=+e.result>0,l.allowanceAmount=e.result||0},ce=async()=>{l.authLoading=!0;const e=await $(await w()).approve(E.lendingPool);l.authLoading=!1,e.success&&N()},de=async()=>{l.authMusdLoading=!0;const{approve:e}=$(await b()),t=await e(E.lendingPool);l.authMusdLoading=!1,t.success&&X()},z=async()=>{J(!0),l.maiBalance=+await $(await w()).balanceOf(),console.log(l.maiBalance,"state.maiBalance"),U.value=A(l.maiBalance*R.value),console.log(U.value,"maxLoanMusd"),J(!1)},F=m(1),G=m(1),h=m([]),re=async()=>{const e=await k();console.log(e),h.value=[];let t=[];for(let u=0;u<e.result;u++){const p=await pe(u);t.push(p)}h.value=t.sort((u,p)=>(console.log(u,p,"22222222222222222222222"),u.pid-p.pid)),console.log(h,"poolInfoList","\u6C60\u5B50\u6C60\u5B50"),F.value=h.value[1].pid},B=Me(()=>h.value[G.value]),pe=async e=>{const t=await c(e);if(!!t.success)return{pid:e,duration:t.result.duration,interestRate:t.result.interestRate/1e3/.8,penaltyRate:t.result.penaltyRate/1e3}},ge=(e,t)=>{F.value=e.pid,G.value=t},R=m(0),ve=async()=>{const e=await x();!e.success||(R.value=e.result,console.log(R.value,"exchangeRatio"))},U=m(0),O=m(!1),me=async()=>{O.value=!0;const e=await P(F.value,r.value);O.value=!1,e.success&&(r.value=null,z(),D())};let M=m([]);const q=m([]),D=async()=>{const e=await i();console.log(e,"\u5386\u53F2\u5386\u53F2"),q.value=[],!(!e.success||!e.result.length)&&((e.result||[]).forEach(async t=>{const u=await fe(t);q.value.push(u)}),M.value=q.value)},fe=async e=>{const t=await H(e);if(!t.success)return;const u=h.value.findIndex(d=>d.pid===+t.result.pid),p=+(t.result.dueTime||0),Y=p-h.value[u].duration;return{loanId:e,...t.result,loanAmount:A(se(t.result.loanAmount)),collateralAmount:A(se(t.result.collateralAmount)),startTime:oe(Y),endTime:oe(p),loanStatus:new Date().getTime()<p*1e3?1:2,loanLoading:!1,rolloverLoading:!1}},he=async(e,t)=>{console.log(e,"222"),M.value[t].loanLoading=!0;const u=await V(e);M.value[t].loanLoading=!1,u.success&&D()},Ae=async(e,t)=>{M.value[t].rolloverLoading=!0;const u=await T(e);M.value[t].rolloverLoading=!1,u.success&&D()},_e=async()=>{N(),X(),await ve(),await re(),z(),D()};return Le(async()=>{_e()}),(e,t)=>{const u=L("van-skeleton"),p=L("VanButton"),Y=L("van-loading"),Z=L("VanField");return n(),v("div",ss,[s("div",os,[f(Fe,{class:"z-50",info:a(l).userInfo},null,8,["info"]),f(Ue,{class:"mr-auto ml-[5px]"}),f(Re,{tokens:["MCOIN","MUSD","MAI"],onHandleTo:t[0]||(t[0]=d=>e.$router.push(d)),class:"z-50 asset-max-width"}),ts]),f(De,{icon:"svg/ecology/mortgage.svg",text:e.$t("ecology.calculateCurrency")},{default:y(()=>[s("div",as,[I(" \u501F\u51FA\u65F6\u957F "),s("div",ls,o(e.$t("ecology.lendingDuration")),1),h.value.length===0?(n(),C(u,{key:0,class:"mb-3",row:3})):(n(),v("div",ns,[(n(!0),v(S,null,Q(h.value.slice(1),(d,j)=>(n(),C(p,{class:Ie(["text-sm font-medium h-[35px] px-4 rounded pool-btn",{"hover-bg":d.pid===F.value}]),key:j,onClick:Ds=>ge(d,j+1)},{default:y(()=>[_(o(a(ee)(d.duration)+e.$t("ecology.day")),1)]),_:2},1032,["class","onClick"]))),128))])),a(B)?(n(),v("div",is,[us,s("div",cs,[s("div",null,o(e.$t("ecology.borrowingCosts"))+"\uFF1A"+o(a(A)(a(B).interestRate)||"-")+"%",1),s("div",null,o(e.$t("ecology.penaltyRatio"))+"\uFF1A"+o(a(B).penaltyRate||"-")+"%",1),s("div",null,o(e.$t("ecology.Additional",{day:a(ie)[a(ee)(a(B).duration)]||0}))+"\uFF1A"+o(a(A)(a(B).interestRate)||"-")+"%",1),s("div",null,o(e.$t("ecology.borrowingfeesreturn")),1)])])):I("v-if",!0),s("section",null,[s("div",ds,[s("div",rs,o(e.$t("ecology.loanAmount")),1),s("div",ps,[_(o(e.$t("ecology.mortgageable assets"))+"\uFF1A ",1),a(ne)?(n(),C(Y,{key:0,size:"18px"})):(n(),v("span",gs,o(a(Ce)(a(A)(a(l).maiBalance||0))),1)),vs])]),s("div",ms,[f(Z,{class:"text-[32px] bg-[#fff9f0] font-bold","input-align":"left",modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=d=>r.value=d),type:"number",placeholder:"0"},null,8,["modelValue"]),s("div",fs,[(n(!0),v(S,null,Q(a(l).percents,d=>(n(),v("div",{class:"text-xs text-oriange1 border border-solid border-oriange1 rounded-md px-1 py-[2px] hover:bg-[#ffcd89]",key:d.value,onClick:j=>ue(d.value)},o(d.name),9,hs))),128))])])]),I(" \u501F\u8D37\u9884\u89C8 "),s("div",As,[s("span",_s,o(e.$t("ecology.loan preview")),1),s("div",ys,[s("div",ws,o(e.$t("ecology.collateralAssets")),1),s("div",bs,o(a(A)(r.value/R.value*1.25||0))+" MAI",1)]),s("div",xs,[s("div",Ms,o(e.$t("ecology.collateralPrice")),1),s("div",Ls,o(a(A)((r.value||0)*1.25))+" MUSD",1)]),s("div",Is,[s("div",Cs,o(e.$t("ecology.loanAmount")),1),s("div",Bs,o(r.value||0)+" MUSD",1)]),s("div",$s,[s("div",ks,o(e.$t("ecology.actualArrival")),1),s("div",Fs,o(r.value||0)+" MUSD",1)])]),s("div",Rs,[f(p,{class:"btn h-[35px] min-w-[100px] px-4",disabled:a(l).isAuthMai,loading:a(l).authLoading,onClick:ce},{default:y(()=>[_(o(e.$t("assets.auth"))+" MAI",1)]),_:1},8,["disabled","loading"]),f(p,{class:"btn h-[35px] min-w-[100px] px-4",loading:O.value,disabled:!a(l).isAuthMai||a(l).authLoading,onClick:me},{default:y(()=>[_(o(e.$t("ecology.submitApplication")),1)]),_:1},8,["loading","disabled"])])]),I(" \u6211\u7684\u501F\u8D37\u5386\u53F2 "),f(es,{list:a(M),authMusd:a(l).isAuthMusd,musdAllowance:K.value,authMusdLoading:a(l).authMusdLoading,onApproveMusd:de,onRepay:he,onRollover:Ae},null,8,["list","authMusd","musdAllowance","authMusdLoading"])]),_:1},8,["text"])])}}}),Ys=te(Us,[["__scopeId","data-v-c2753ef4"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/Mortgage.vue"]]);export{Ys as default};
