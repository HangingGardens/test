import{_ as se,d as ne,A as fe,aw as $e,D as L,E as V,b as g,e as U,g as e,h as t,t as s,G as P,ao as ke,k as S,F as ie,s as ge,H as B,L as h,K as J,Z as Ae,ax as _e,M as Z,ay as Oe,az as Ie,z as Me,a4 as z,a6 as W,a8 as Be,aA as le,a2 as ae,a5 as pe,a3 as he,m as ue,w as ve,a as R,C as re,o as me,W as M,X,P as te,j as q,at as ye,u as Fe,p as Se,l as Ce,ac as Le}from"./index-7bcb6f7b.js";const Ue=""+new URL("../images/sell-28e94682.svg",import.meta.url).href,Te=""+new URL("../images/buy-0ac551f5.svg",import.meta.url).href;const De={class:"pt-5"},Pe={class:"flex items-center h-5 text-[#2E2008] text-base"},Ve=["src"],qe={class:"font-semibold ml-0.5"},Ne={class:"bg-[#FFF1D9]/[0.6] rounded-xl mt-2.5 p-4 pb-1.5"},Re={class:"w-full"},Ee={class:"flex"},je={class:"my-th w-4/12"},ze={class:"my-th w-5/12"},We={class:"my-th w-3/12"},He={key:1,class:"max-h-36 w-full overflow-auto pt-1.5"},Ge={class:"w-4/12 text-overflow"},Xe={class:"text-base font-medium text-[#2E2008]"},Ke={class:"w-5/12 text-overflow"},Ye={class:"text-base font-medium text-[#2E2008]"},Ze={class:"w-3/12 text-overflow"},Je=ne({props:{type:{type:null,required:!0},list:{type:Array,required:!0},isOld:{type:Boolean,required:!1}},emits:["onClick","onCheckMyOrder"],setup(a,{emit:m}){const{type:c,list:C}=a,w=fe();$e();const O=L(()=>{const _={icon:Ue,title:w.t("ecology.Sellorders"),subTitle:w.t("ecology.mysellorder"),btnText:w.t("ecology.buyin")};return c=="buy"&&(_.icon=Te,_.title=w.t("ecology.buyorder"),_.subTitle=w.t("ecology.mybill"),_.btnText=w.t("ecology.sellout")),_}),k=_=>{m("onClick",c,_)},I=()=>{m("onCheckMyOrder",c)};return(_,v)=>{const A=V("van-icon"),E=V("van-skeleton"),b=V("VanButton");return g(),U("div",De,[e("div",Pe,[e("img",{src:t(O).icon,class:"w-5",alt:""},null,8,Ve),e("span",qe,s(t(O).title),1),e("span",{class:"ml-auto font-medium opacity-80",onClick:I},s(t(O).subTitle),1),P(A,{class:"font-semibold text-sm mx-px",name:"arrow",onClick:I})]),e("div",Ne,[e("div",Re,[e("div",Ee,[e("span",je,s(_.$t("mall.price")),1),e("span",ze,s(_.$t("ecology.quantity")),1),e("span",We,s(_.$t("shop.operation")),1)]),t(ke)?(g(),S(E,{key:0,class:"mt-3",row:3})):(g(),U("div",He,[(g(!0),U(ie,null,ge(a.list,y=>(g(),U("div",{class:"flex w-full py-2.5",key:y.price},[e("span",Ge,[e("span",Xe,s(y.price),1)]),e("span",Ke,[e("span",Ye,s(y.amount),1)]),e("span",Ze,[P(b,{class:J(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":a.type=="buy"}]),onClick:T=>k(y),disabled:a.isOld},{default:B(()=>[h(s(t(O).btnText),1)]),_:2},1032,["class","onClick","disabled"])])]))),128))]))])])])}}}),we=se(Je,[["__scopeId","data-v-1cc2456f"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OtcOrder.vue"]]);const Qe={class:"w-[21rem] p-5 bg-[#FFFDF8] text-xs text-[#2E2008]"},et={class:"flex justify-between items-center pb-4 header font-semibold text-base"},tt=ne({props:{show:{type:Boolean,required:!0},title:{type:null,required:!0}},emits:["close"],setup(a,{emit:m}){const{show:c,title:C}=a,w=()=>{m("close")};return(O,k)=>{const I=V("van-icon"),_=V("van-popup");return g(),S(_,_e(O.$attrs,{show:a.show,"onUpdate:show":k[0]||(k[0]=v=>Z(c)?c.value=v:null),round:"","overlay-class":"",onClose:w}),{default:B(()=>[e("div",Qe,[e("div",et,[e("span",null,s(a.title),1),P(I,{name:"cross",class:"font-semibold text-xl",onClick:w})]),e("div",null,[Ae(O.$slots,"default",{},void 0,!0)])])]),_:3},16,["show"])}}}),be=se(tt,[["__scopeId","data-v-41985eb3"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyDialog.vue"]]),de=a=>{const m=a?Oe():Ie(),c=Me().getCurrentAccount();return{pending:async(n,r,p)=>{try{const F=await(await m.pending(n,ae(r),ae(p))).wait();return z(F)}catch(F){return pe(F),W(F)}},usdtAddress:async()=>{try{const n=await m.USDT();return z(n)}catch(n){return W(n)}},MIN_AMOUNT:async()=>{try{const n=await m.MIN_AMOUNT();return Be(n)}catch{return 0}},MIN_REMAIN_AMOUNT:async()=>{try{const n=await m.MIN_REMAIN_AMOUNT();return z(n)}catch(n){return W(n)}},lastPrice:async()=>{try{const n=await m.lastPrice();return le(n.toString())}catch{return 0}},getMarketPrices:async n=>{try{const r=await m.getMarketPrices(n);return z(r)}catch(r){return W(r)}},getPriceTotals:async(n,r)=>{try{const p=await m.getPriceTotals(n,ae(r));return z(p)}catch(p){return W(p)}},getMarketIds:async(n,r)=>{try{const p=await m.getMarketIds(n,r);return z(p)}catch(p){return W(p)}},getOrderInfo:async n=>{try{const r=await m.getOrderInfo(n);return z(r)}catch(r){return W(r)}},batchTrade:async n=>{try{const p=await(await await m.batchTrade(n)).wait();return z(p)}catch(r){return pe(r),W(r)}},trade:async(n,r)=>{try{const p=await m.estimateGas.trade(n,ae(r)),N=await(await await m.trade(n,ae(r),{gasLimit:he(p,3e3)})).wait();return z(N)}catch(p){return pe(p),W(p)}},getPendingIds:async()=>{try{const n=await m.getPendingIds(c);return z(n)}catch(n){return W(n)}},cancel:async n=>{try{const r=await m.estimateGas.cancel(n),F=await(await await m.cancel(n.toString(),{gasLimit:he(r,3e3)})).wait();return z(F)}catch(r){return pe(r),W(r)}},musdAddress:async()=>{try{const n=await m.MUSD();return z(n)}catch(n){return W(n)}},maiAddress:async()=>{try{const n=await m.MAI();return z(n)}catch(n){return W(n)}}}};const st={class:"mt-4 text-[#2E2008]"},nt={class:"text-sm font-medium"},ot={class:"bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},at={class:"mt-5 text-sm font-medium"},lt={class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},rt={class:"text-base opacity-60"},ct={class:"flex flex-col items-center justify-center mt-5"},it={key:0,class:"mt-5"},ut={lass:"mt-1"},dt={class:"text-[#FBA923]"},pt={class:"text-[#FBA923]"},mt=h(" MUSD "),yt={key:1,class:"mt-5"},ft={class:"mt-1"},gt={class:"text-[#FBA923]"},bt={class:"text-[#FBA923]"},ht=h(" MAI "),vt=ne({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},lastPrice:{type:null,required:!0}},emits:["update:show","success"],setup(a,{emit:m}){const{show:c,type:C}=a,{t:w}=fe(),{musdAddress:O,MIN_AMOUNT:k,maiAddress:I,pending:_}=de(),v=ue({number:null,price:null}),A=L(()=>{const o={title:w("ecology.Pendingpurchase"),numberText:w("ecology.buyquantity"),priceText:w("ecology.buyprice")};return C=="sell"&&(o.title=w("ecology.Hangforsale"),o.numberText=w("ecology.sellquantity"),o.priceText=w("ecology.sellingprice")),o}),E=L(()=>x.value>0&&(C==="buy"?x.value>=b.value:x.value>=+v.number));ve(()=>v.price,(o,f)=>{y.value||(b.value=+o*+v.number)}),ve(()=>v.number,(o,f)=>{T.value||(b.value=+o*+v.price)});const b=R(null),y=R(!1),T=R(!1),u=()=>{y.value=!1,T.value=!0},D=()=>{y.value=!0,T.value=!1},[d,n]=re(!1),r=()=>{m("update:show",!1)},p=R(""),F=async()=>{const o=C==="buy"?await O():await I();!o.success||(p.value=o.result)},N=async()=>{n(!0);const o=await await X(p.value).approve(te.otc);n(!1),o.success&&Y()},x=R(null),Y=async()=>{n(!0);const o=await(await X(p.value)).allowance(te.otc);x.value=o.result||0,n(!1)},j=R(0),ce=async()=>{const o=await k();j.value=+o},H=R(0),Q=async()=>{const o=await X(p.value).balanceOf();H.value=+o},[ee,oe]=re(!1),l=async()=>{oe(!0);const o=await _(C==="buy"?1:2,v.price,v.number);oe(!1),o.success&&(r(),m("success"))},i=async()=>{Y(),ce(),Q()};return me(async()=>{await F(),i()}),(o,f)=>{const K=V("VanField"),$=V("VanButton");return g(),S(be,{show:a.show,"onUpdate:show":f[2]||(f[2]=G=>Z(c)?c.value=G:null),title:t(A).title,onClose:r},{default:B(()=>[e("div",st,[e("div",nt,s(t(A).numberText),1),e("div",ot,[P(K,{class:"bg-[#fff9f0] text-3xl font-bold",onFocus:D,modelValue:t(v).number,"onUpdate:modelValue":f[0]||(f[0]=G=>t(v).number=G),type:"number",placeholder:"0"},null,8,["modelValue"])]),e("div",at,s(t(A).priceText),1),e("div",lt,[P(K,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:t(v).price,"onUpdate:modelValue":f[1]||(f[1]=G=>t(v).price=G),onFocus:u,type:"number",placeholder:"0"},null,8,["modelValue"]),e("span",rt,s((a.type==="buy","MUSD")),1)]),e("div",ct,[t(E)?a.type==="buy"?(g(),S($,{key:1,onClick:l,disabled:+t(v).price<=0||b.value<j.value||b.value>H.value,loading:t(ee),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:B(()=>[h(s(o.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(g(),S($,{key:2,onClick:l,disabled:+t(v).price<=0||b.value<j.value||t(v).number>H.value,loading:t(ee),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:B(()=>[h(s(o.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(g(),S($,{key:0,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",loading:t(d),onClick:N},{default:B(()=>[h(s(o.$t("assets.auth"))+" "+s(a.type==="buy"?"MUSD":"MAI"),1)]),_:1},8,["loading"]))]),a.type=="sell"?(g(),U("div",it,[e("div",null,"MAI"+s(o.$t("assets.balance"))+s(H.value),1),e("div",null,s(o.$t("ecology.new price"))+": "+s(a.lastPrice),1),e("div",null,s(o.$t("ecology.hand num"))+" "+s(j.value)+"MUSD, "+s(o.$t("ecology.otcDeduct")),1),e("div",ut,[h("*"+s(o.$t("ecology.estimated consume"))+" ",1),e("span",dt,s(t(M)(t(v).number)),1),h(" MAI, "+s(o.$t("ecology.estimated get")),1),e("span",pt,s(t(M)(b.value*.7)),1),mt])])):(g(),U("div",yt,[e("div",null,"MUSD"+s(o.$t("assets.balance"))+s(t(M)(H.value)),1),e("div",null,s(o.$t("ecology.new price"))+": "+s(a.lastPrice),1),e("div",null,s(o.$t("ecology.hand num"))+" "+s(j.value)+" MUSD",1),e("div",ft,[h("*"+s(o.$t("ecology.estimated consume"))+" ",1),e("span",gt,s(b.value),1),h(" MUSD, "+s(o.$t("ecology.estimated get"))+" ",1),e("span",bt,s(t(M)(t(v).number)),1),ht])]))])]),_:1},8,["show","title"])}}}),wt=se(vt,[["__scopeId","data-v-6f90ea23"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/PostForm.vue"]]);const _t={class:"mt-5"},xt={class:"flex justify-between"},$t={class:"text-base font-semibold"},kt={class:"text-base font-medium opacity-80"},At={class:"flex justify-between mt-2.5"},Ot={class:"text-base font-semibold"},It={class:"text-base font-medium opacity-80"},Mt={class:"flex justify-between mt-6"},Bt={class:"text-sm font-medium"},Ft={class:"text-sm opacity-80"},St={class:"flex justify-between items-center bg-[#fff9f0] rounded-lg py-2.5 pr-2.5 mt-2.5"},Ct={class:"flex flex-col items-center justify-center mt-5"},Lt={class:"mt-5"},Ut={key:0,class:"mt-2 text-left"},Tt={class:"text-[#FBA923]"},Dt={class:"text-[#FBA923]"},Pt=h(" MUSD"),Vt={key:1,class:"mt-2"},qt={class:"text-[#FBA923]"},Nt={class:"text-[#FBA923]"},Rt=ne({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0},orderInfo:{type:null,required:!0},isAuth:{type:Boolean,required:!0},musdBalance:{type:[Number,String],required:!0},tokenBalance:{type:[Number,String],required:!0},musdAllowance:{type:[Number,String],required:!0},tokenAllowance:{type:[Number,String],required:!0},otcAddress:{type:String,required:!0}},emits:["update:show","approve","success"],setup(a,{emit:m}){const c=a,{trade:C}=de(),w=L(()=>+c.tokenAllowance>=+y.number&&+c.tokenAllowance>0),O=L(()=>+c.musdAllowance>=+y.number*+c.orderInfo.price&&+c.musdAllowance>0),k=ue({isAuth:!1,btnLoading:!1}),I=L(()=>c.orderInfo.remain<y.number),_=L(()=>c.orderInfo.remain*c.orderInfo.price>10?`1-${M(c.orderInfo.remain-10/c.orderInfo.price)} || ${c.orderInfo.remain}`:c.orderInfo.remain),v=L(()=>{if(c.type=="buy")return 1;if(c.type=="sell")return 2}),A=()=>{m("update:show",!1)},E=async()=>{k.btnLoading=!0;let u;if(v.value===1?u=await X(c.token).approve(c.otcAddress):u=await X(c.musd).approve(c.otcAddress),!u.success)return k.btnLoading=!1;k.isAuth=!0,m("approve"),k.btnLoading=!1},b=async()=>{k.btnLoading=!0;try{(await C(c.orderInfo.id,+y.number)).success&&m("success")}finally{k.btnLoading=!1}},y=ue({number:""}),T=()=>{v.value===1?y.number=+c.tokenBalance<+c.orderInfo.remain?c.tokenBalance:c.orderInfo.remain:y.number=+c.musdBalance/c.orderInfo.price<+c.orderInfo.remain?+c.musdBalance/c.orderInfo.price:c.orderInfo.remain};return(u,D)=>{const d=V("VanField"),n=V("VanButton");return g(),S(be,{show:a.show,"onUpdate:show":D[1]||(D[1]=r=>Z(show)?show.value=r:null),title:a.type=="sell"?u.$t("otc.buyIn"):u.$t("otc.sellOut"),onClose:A,overlay:!1},{default:B(()=>[e("div",_t,[e("div",xt,[e("span",$t,s(u.$t("mall.price")),1),e("span",kt,s(t(M)(a.orderInfo.price||0,4))+" MUSD",1)]),e("div",At,[e("span",Ot,s(u.$t("ecology.total")),1),e("span",It,s(t(M)(a.orderInfo.remain||0,4))+" MAI",1)]),e("div",Mt,[e("span",Bt,s(a.type=="sell"?u.$t("ecology.buyquantity"):u.$t("ecology.sellquantity")),1),e("span",Ft,s(a.type=="sell"?"MUSD":"MAI")+s(u.$t("assets.balance"))+s(a.type=="sell"?a.musdBalance:a.tokenBalance),1)]),e("div",St,[P(d,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:t(y).number,"onUpdate:modelValue":D[0]||(D[0]=r=>t(y).number=r),type:"number",placeholder:"0"},null,8,["modelValue"]),e("div",{class:"px-1.5 py-1 border-[1px] rounded border-[#FBA923] border-solid text-xs text-[#FBA923] font-medium",onClick:T},"MAX ")]),e("div",Ct,[(a.type==="sell"?t(O):t(w))?(g(),S(n,{key:0,loading:t(k).btnLoading,disabled:!t(y).number||+t(y).number<=0||t(I),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",onClick:b},{default:B(()=>[h(s(u.$t("common.submit")),1)]),_:1},8,["loading","disabled"])):(g(),S(n,{key:1,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",disabled:!t(y).number||+t(y).number<=0||t(I),loading:t(k).btnLoading,onClick:E},{default:B(()=>[h(s(u.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading"]))]),e("div",Lt,s(u.$t("ecology.tips",{Currency:a.type=="sell"?"MAI":"MUSD",num:t(_)})),1),q(" \u83B7\u5F97 "),a.type==="sell"?(g(),U("div",Ut,[h(" *"+s(u.$t("ecology.estimated get"))+" ",1),e("span",Tt,s(t(y).number||0),1),h(" MAI,"+s(u.$t("ecology.Estimatedconsumption"))+" ",1),e("span",Dt,s(t(M)(+a.orderInfo.price*+t(y).number)),1),Pt])):(g(),U("div",Vt,[h("*"+s(u.$t("ecology.Estimatedconsumption"))+" ",1),e("span",qt,s(+t(y).number||0),1),h(" MAI,"+s(u.$t("ecology.estimated get")),1),e("span",Nt,s(t(M)(+t(y).number*+a.orderInfo.price*.7)),1),h(" MUSD "+s(u.$t("ecology.otcDeduct")),1)]))])]),_:1},8,["show","title"])}}}),Et=se(Rt,[["__scopeId","data-v-67dbb134"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperateDetail.vue"]]);const jt={class:"mt-4"},zt={class:"text-sm text-[#2E2008] font-medium"},Wt={class:"text-white flex flex-col justify-center items-center mt-5 font-semibold text-sm"},Ht={key:0,class:"mt-5"},Gt={class:"mt-1"},Xt={class:"mt-1"},Kt={class:"text-[#FBA923]"},Yt={class:"text-[#FBA923]"},Zt=h(" MUSD "),Jt={key:1,class:"mt-5"},Qt={class:"mt-1"},es={class:"text-[#FBA923]"},ts={class:"text-[#FBA923]"},ss=h(" MAI "),ns=ne({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},price:{type:Number,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0}},emits:["update:show","success"],setup(a,{emit:m}){const{show:c,type:C,price:w,token:O,musd:k}=a,I=fe(),{getMarketIds:_,getOrderInfo:v,batchTrade:A,MIN_AMOUNT:E}=de(),b=te.otc,[y,T]=re(!1),u=R([]),D=l=>{u.value=l},d=ue({orderInfo:{},amountShow:!1,list:[],btnLoading:!1,tokenAllowance:"",tokenBalance:"",musdAllowance:"",musdBalance:""}),n=L(()=>d.list.reduce((i,o)=>u.value.find(f=>f==o.id)?i+o.remain:i,0)),r=L(()=>d.list.reduce((i,o)=>u.value.find(f=>f==o.id)?i+o.remain*o.price:i,0)),p=L(()=>+d.tokenAllowance>=+n.value&&+d.tokenAllowance>0),F=L(()=>+d.musdAllowance>=+r.value),N=L(()=>{const l={title:I.t("ecology.buy"),btnText:I.t("ecology.buyin"),batchBtnText:I.t("ecology.Bulkbuy"),btnClass:"btn-green"};return C=="buy"&&(l.title=I.t("ecology.Sell"),l.btnText=I.t("ecology.sellout"),l.batchBtnText=I.t("ecology.sellinbulk"),l.btnClass="btn-pink"),l}),x=L(()=>{if(C=="buy")return 1;if(C=="sell")return 2}),Y=()=>{m("update:show",!1)},j=async()=>{const l=await X(k).allowance(te.otc);d.musdAllowance=l.result,d.musdBalance=String(M(await X(k).balanceOf()));const i=await X(O).allowance(te.otc);d.tokenAllowance=i.result,d.tokenBalance=String(M(await X(O).balanceOf()))},ce=async()=>{const l=await _(x.value,ae(w)),i=[];for(let o=0;o<l.result.length;o++){const f=await v(l.result[o]);i.push({id:l.result[o],price:w,remain:le(f.result.remain.toString())})}d.list=i},H=async()=>{d.btnLoading=!0;let l;if(x.value===1?l=await X(O).approve(te.otc):l=await X(k).approve(te.otc),!l.success)return d.btnLoading=!1;await j(),Q()},Q=async()=>{const l=d.list.reduce((i,o)=>u.value.find(f=>f==o.id)?i+o.remain:i,0);if(x.value===1){if(l>d.tokenAllowance&&l<=d.tokenBalance)return H()}else if(l>d.musdAllowance&&l<=d.musdBalance)return H();d.btnLoading=!0;try{(await A(u.value)).success&&m("success")}finally{d.btnLoading=!1}},ee=l=>{d.orderInfo=l,T(!0)},oe=()=>{T(!1),m("success")};return me(async()=>{d.btnLoading=!0,await j(),await ce(),d.btnLoading=!1}),(l,i)=>{const o=V("van-checkbox"),f=V("VanButton"),K=V("van-checkbox-group");return g(),U(ie,null,[P(be,{show:a.show,"onUpdate:show":i[1]||(i[1]=$=>Z(c)?c.value=$:null),title:`${a.price}${t(N).title}`,onClose:Y,"close-on-click-overlay":!t(y)},{default:B(()=>[e("div",jt,[P(K,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=$=>u.value=$),onChange:D},{default:B(()=>[(g(!0),U(ie,null,ge(t(d).list,$=>(g(),U("div",{class:"flex justify-between items-center bg-[#fff9f0] rounded-lg p-2.5 mt-2.5",key:$.id},[P(o,{name:$.id,"icon-size":"1rem","checked-color":"#14D8A9"},{default:B(()=>[e("span",zt,s(t(M)($.remain||0,4))+" MAI",1)]),_:2},1032,["name"]),P(f,{class:J(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":a.type=="buy"}]),onClick:G=>ee($)},{default:B(()=>[h(s(t(N).btnText),1)]),_:2},1032,["class","onClick"])]))),128))]),_:1},8,["modelValue"]),e("div",Wt,[q(" \u6388\u6743 "),(a.type==="sell"?!t(F):!t(p))?(g(),S(f,{key:0,disabled:!u.value.length,loading:t(d).btnLoading,class:J(["py-3 flex-1 w-40",t(N).btnClass]),onClick:H},{default:B(()=>[h(s(l.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading","class"])):(g(),U(ie,{key:1},[q(" \u6279\u91CF\u8D2D\u4E70 "),P(f,{disabled:!u.value.length,loading:t(d).btnLoading,class:J(["py-3 flex-1 w-40",t(N).btnClass]),onClick:Q},{default:B(()=>[h(s(t(N).batchBtnText),1)]),_:1},8,["disabled","loading","class"])],2112))]),a.type=="buy"?(g(),U("div",Ht,[e("div",null,"MAI"+s(l.$t("assets.balance"))+s(t(d).musdBalance),1),e("div",Gt,s(l.$t("ecology.otcDeduct")),1),e("div",Xt,[h("*"+s(l.$t("ecology.estimated consume"))+" ",1),e("span",Kt,s(t(M)(t(n))),1),h(" MAI, "+s(l.$t("ecology.estimated get"))+" ",1),e("span",Yt,s(t(M)(t(r)*.7)),1),Zt])])):(g(),U("div",Jt,[e("div",null,"MAI"+s(l.$t("assets.balance"))+s(t(d).musdBalance),1),e("div",Qt,[h("*"+s(l.$t("ecology.estimated consume"))+" ",1),e("span",es,s(t(M)(t(r))),1),h(" MUSD, "+s(l.$t("ecology.estimated get"))+" ",1),e("span",ts,s(t(M)(t(n))),1),ss])]))])]),_:1},8,["show","title","close-on-click-overlay"]),t(y)?(g(),S(Et,{key:0,type:a.type,show:t(y),"onUpdate:show":i[2]||(i[2]=$=>Z(y)?y.value=$:null),token:a.token,musd:a.musd,isAuth:a.type=="sell"?t(F):t(p),isMusdtAuth:t(F),orderInfo:t(d).orderInfo,musdBalance:t(d).musdBalance,tokenBalance:t(d).tokenBalance,otcAddress:t(b),tokenAllowance:t(d).tokenAllowance,musdAllowance:t(d).musdAllowance,onApprove:j,onSuccess:oe},null,8,["type","show","token","musd","isAuth","isMusdtAuth","orderInfo","musdBalance","tokenBalance","otcAddress","tokenAllowance","musdAllowance"])):q("v-if",!0)],64)}}}),os=se(ns,[["__scopeId","data-v-176626b2"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperatePopup.vue"]]),as=""+new URL("../images/Rectangle_L_O-1a09b3b3.svg",import.meta.url).href,ls=""+new URL("../images/Rectangle_L_W-bf92913e.svg",import.meta.url).href,rs=""+new URL("../images/Rectangle_R_O-b6604591.svg",import.meta.url).href,cs=""+new URL("../images/Rectangle_R_W-ed1e7ed6.svg",import.meta.url).href;const is={class:"w-[21rem] bg-[#FFFDF8] text-xs text-[#2E2008]"},us={class:"container"},ds={class:"flex justify-between items-center font-semibold text-base py-4 px-5"},ps={class:"h-10 flex relative"},ms=["src"],ys=["src"],fs={class:"h-10 z-10 flex items-center w-[21rem] text-base font-medium"},gs={class:"p-2.5 maxH overflow-auto"},bs={class:"flex justify-between header pb-2.5"},hs={class:"text-xl font-bold"},vs={class:"flex justify-between mt-2.5 text-sm"},ws={class:"opacity-80"},_s={class:"font-semibold"},xs={class:"flex justify-between mt-2.5 text-sm"},$s={class:"opacity-80"},ks={class:"font-semibold"},As={class:"flex justify-between mt-2.5 text-sm"},Os={class:"opacity-80"},Is={class:"font-semibold"},Ms=ne({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},isOld:{type:Boolean,required:!1}},emits:["update:show","success"],setup(a,{emit:m}){const{show:c,type:C,isOld:w}=a,{getPendingIds:O,cancel:k,getOrderInfo:I}=de(w),_=()=>{m("update:show",!1)},v=L(()=>A.value==="buy"?u.value.filter(n=>n.direct===1):u.value.filter(n=>n.direct===2)),A=R("buy"),E=n=>{A.value!=n&&(A.value=n)},b=L(()=>A.value=="buy"?ls:as),y=L(()=>A.value=="sell"?cs:rs),T=R([]),u=R([]),D=async()=>{const n=await O();!n.success||(T.value=n.result,T.value.forEach(async r=>{const p=await I(r);u.value.push({direct:+p.result.direct,price:M(ye(p.result.price)),total:M(ye(p.result.total)),remain:M(ye(p.result.remain)),token:p.result.token,sender:p.result.sender,status:+p.result.status,id:r,loading:!1})}))},d=async n=>{n.loading=!0;const r=await k(n.id);n.loading=!1,r.success&&(_(),m("success"))};return me(()=>{A.value=C,D()}),(n,r)=>{const p=V("van-icon"),F=V("VanButton"),N=V("van-popup");return g(),S(N,_e(n.$attrs,{show:a.show,"onUpdate:show":r[2]||(r[2]=x=>Z(c)?c.value=x:null),style:{height:"80vh"},round:"","overlay-class":"",onClose:_}),{default:B(()=>[e("div",is,[e("div",us,[e("div",ds,[e("span",null,s(n.$t("ecology.mypendingorder")),1),P(p,{name:"cross",class:"font-semibold text-xl",onClick:_})]),e("div",ps,[e("img",{class:J(["h-10 absolute left-0 bottom-[-1px]",{"z-10":A.value=="buy"}]),src:t(b),alt:""},null,10,ms),e("img",{class:J(["h-10 absolute right-0 bottom-[-1px]",{"z-10":A.value=="sell"}]),src:t(y),alt:""},null,10,ys),e("div",fs,[e("span",{class:J(["text-[#2E2008] flex-1 text-center",{"text-[#FEA021]":A.value=="buy"}]),onClick:r[0]||(r[0]=x=>E("buy"))},s(n.$t("ecology.mybill")),3),e("span",{class:J(["text-[#2E2008] opacity-60 flex-1 text-center",{"text-[#FEA021]":A.value=="sell"}]),onClick:r[1]||(r[1]=x=>E("sell"))},s(n.$t("ecology.mysellorder")),3)])])]),e("div",gs,[q(" \u8BA2\u5355\u9879 "),(g(!0),U(ie,null,ge(t(v),(x,Y)=>(g(),U("div",{class:"bg-[#FFF1D9]/[0.4] rounded p-2.5 mt-2.5 order-box",key:Y},[e("div",bs,[e("span",hs,s(x.price||0),1),q(" \u64A4\u9500 "),x.status==1?(g(),S(F,{key:0,class:"btn-border px-3.5 h-[28px] rounded-2xl text-xs text-[#FBA923] font-medium min-w-[65px] text-center"},{default:B(()=>[h(s(n.$t("ecology.completed")),1)]),_:1})):q("v-if",!0),x.status==0?(g(),S(F,{key:1,onClick:j=>d(x),loading:x.loading,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:B(()=>[h(s(n.$t("ecology.revoke")),1)]),_:2},1032,["onClick","loading"])):q("v-if",!0),x.status===2?(g(),S(F,{key:2,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:B(()=>[h(s(n.$t("ecology.canceled")),1)]),_:1})):q("v-if",!0)]),e("div",vs,[e("span",ws,s(n.$t("ecology.Totalendingorders")),1),e("span",_s,s(x.total||0)+" MAI",1)]),e("div",xs,[e("span",$s,s(n.$t("ecology.transactionquantity")),1),e("span",ks,s(x.total-x.remain||0)+" MAI",1)]),e("div",As,[e("span",Os,s(n.$t("ecology.remainingquantity")),1),e("span",Is,s(x.remain||0)+" MAI",1)])]))),128))])])]),_:1},16,["show"])}}}),Bs=se(Ms,[["__scopeId","data-v-0ab69f7b"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyOtcOrder.vue"]]);const xe=a=>(Se("data-v-5b5e4784"),a=a(),Ce(),a),Fs={class:"bg-[#FFFDF8] rounded-xl p-2.5 pt-5 pb-3.5"},Ss={class:"flex-center flex-col text-[#F36B07] rounded-xl bg-[#FFF1D9]/[0.6] py-5 font-normal text-sm"},Cs={class:"text-3xl font-bold"},Ls=xe(()=>e("span",{class:"ml-2"},"MUSD",-1)),Us={class:"text-[#2E2008] font-medium opacity-60"},Ts={class:"pt-2.5 pb-1 flex justify-between text-white font-semibold text-sm"},Ds=xe(()=>e("div",{class:"w-5"},null,-1)),Ps=ne({props:{isOld:{type:Boolean,required:!1}},setup(a){const m=a,{loadingToggle:c}=Le(),{lastPrice:C,getMarketPrices:w,getMarketIds:O,maiAddress:k,musdAddress:I,getOrderInfo:_}=de(m.isOld),{reloadStore:v}=Fe(),A=1,E=2,b=ue({token:"",musd:"",sellOrderList:[],buyOrderList:[],lastPrice:0,selectPrice:0,minAmount:0,maxAmount:0}),y=R(),T=R(""),u=R(""),[D,d]=re(!1),[n,r]=re(!1),[p,F]=re(!1),N=l=>{T.value=l,d(!0)},x=(l,i)=>{y.value=i.price,u.value=l,r(!0)},Y=l=>{u.value=l,F(!0)},j=async()=>{const l=await C();b.lastPrice=l||0},ce=async()=>{const l=await k(),i=await I();b.token=l.result,b.musd=i.result},H=async()=>{const l=await w(E),i=[];for(let o=0;o<l.result.length;o++){const f=await O(E,l.result[o]);let K=0;for(let $=0;$<f.result.length;$++){const G=await _(f.result[$]);K+=le(G.result.remain.toString())}i.push({price:le(l.result[o].toString()),amount:M(K)}),b.sellOrderList=i.filter($=>$.amount!==0),b.sellOrderList=b.sellOrderList.sort(($,G)=>$.price-G.price)}},Q=async()=>{const l=await w(A),i=[];for(let o=0;o<l.result.length;o++){const f=await O(A,l.result[o]);let K=0;for(let $=0;$<f.result.length;$++){const G=await _(f.result[$]);K+=le(G.result.remain.toString())}i.push({price:le(l.result[o].toString()),amount:M(K)})}b.buyOrderList=i.filter(o=>o.amount!==0),b.buyOrderList=b.buyOrderList.sort((o,f)=>f.price-o.price)},ee=async()=>{v.reload(),Q(),H(),j(),r(!1)},oe=async()=>{c(!0),await Promise.all([ce(),j(),H(),Q()]),c(!1)};return me(async()=>{await oe()}),(l,i)=>{const o=V("VanButton");return g(),U("div",Fs,[e("div",Ss,[e("div",null,[e("span",Cs,s(t(b).lastPrice),1),Ls]),e("div",Us,s(l.$t("ecology.Latesttransactionprice")),1)]),e("div",Ts,[P(o,{class:"flex-1 h-10 px-4 btn-green",onClick:i[0]||(i[0]=f=>N("buy")),disabled:a.isOld},{default:B(()=>[h(s(l.$t("ecology.Pendingpurchase")),1)]),_:1},8,["disabled"]),Ds,P(o,{class:"flex-1 h-10 px-4 btn-pink",onClick:i[1]||(i[1]=f=>N("sell")),disabled:a.isOld},{default:B(()=>[h(s(l.$t("ecology.Hangforsale")),1)]),_:1},8,["disabled"])]),P(we,{type:"sell",onOnClick:x,onOnCheckMyOrder:Y,list:t(b).sellOrderList,isOld:a.isOld},null,8,["list","isOld"]),P(we,{type:"buy",onOnClick:x,onOnCheckMyOrder:Y,list:t(b).buyOrderList,isOld:a.isOld},null,8,["list","isOld"]),q(" \u53D1\u5E03\u7684\u5F39\u7A97 "),t(D)?(g(),S(wt,{key:0,show:t(D),"onUpdate:show":i[2]||(i[2]=f=>Z(D)?D.value=f:null),onSuccess:ee,type:T.value,lastPrice:t(b).lastPrice},null,8,["show","type","lastPrice"])):q("v-if",!0),q(" \u4E70\u5165\u5356\u51FA\u64CD\u4F5C\u5F39\u7A97 "),t(n)?(g(),S(os,{key:1,show:t(n),"onUpdate:show":i[3]||(i[3]=f=>Z(n)?n.value=f:null),type:u.value,price:y.value,token:t(b).token,musd:t(b).musd,onSuccess:ee},null,8,["show","type","price","token","musd"])):q("v-if",!0),q(" \u6211\u7684\u8BA2\u5355\u5F39\u7A97 "),t(p)?(g(),S(Bs,{key:2,show:t(p),"onUpdate:show":i[4]||(i[4]=f=>Z(p)?p.value=f:null),type:u.value,isOld:a.isOld,success:"handleSuccess"},null,8,["show","type","isOld"])):q("v-if",!0)])}}}),qs=se(Ps,[["__scopeId","data-v-5b5e4784"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/OtcIndex.vue"]]);export{qs as O};
