import{_ as A,d as V,E as x,b as p,e as y,g as e,h as n,q as D,t as i,G as v,j as P,H as I,L as U,p as X,l as Y,a as _,F as j,s as E,k as F,K as ie,W as Z,A as K,D as M,C as O,m as re,f as ee,O as ce,o as te,M as J,aa as de,P as Q,T as ue,ae as me,B as pe,w as fe,ac as ve}from"./index-4b9e7bbb.js";import{B as he}from"./BackIcon-2b77c669.js";import{R as ge}from"./RatioBox-2b23b0c3.js";import{_ as _e}from"./mcoin-logo-601d180b.js";import{a as be}from"./mall-3a5e9365.js";import{_ as se}from"./close-384dfae6.js";import{_ as we}from"./mcoin-logo-1-a438d147.js";import{a as xe}from"./bill-ee04a422.js";import{q as ye}from"./shop-e1260a55.js";import{q as $e}from"./category-0a48b360.js";const ke=""+new URL("../images/service-2d6a42d1.svg",import.meta.url).href;const Ce=s=>(X("data-v-277ea9e4"),s=s(),Y(),s),Se={class:"px-3 relative"},Le={class:"p-3 border-oriange2 border border-solid bg rounded-xl mt-[-50px] z-[9999] border-info"},Te=["src"],Ie={class:"flex-1 text-default flex flex-col justify-between"},Ve={class:"font-semibold text-sm"},Be={class:"opacity-60 text-xs"},Ae={class:"text-xs"},qe={class:"flex-end gap-3 mt-5"},Re=Ce(()=>e("img",{src:ke,class:"w-3",alt:""},null,-1)),Ne=[Re],Ue={class:"flex-center mt-3"},Fe=V({props:{info:{type:null,required:!0}},emits:["handleTo","setSubmitShow"],setup(s,{emit:d}){return(f,o)=>{const h=x("VanButton");return p(),y("div",Se,[e("div",Le,[e("div",{class:"flex justify-start gap-3 w-full",onClick:o[0]||(o[0]=()=>d("handleTo",`/shopInfo?address=${s.info.merchant}`))},[e("img",{src:s.info.logo||n(D)("images/goods/defaultImg.png"),class:"h-[65px] aspect-square rounded-xl object-cover",alt:""},null,8,Te),e("div",Ie,[e("div",Ve,i(s.info.storeName||"-"),1),e("div",Be,i(f.$t("shop.shopTime"))+" "+i(s.info.openingHours||"-"),1),e("div",Ae,i(s.info.location+s.info.contactAddress||"-"),1)]),e("div",null,[v(ge,{ratio:s.info.discountRatio||0},null,8,["ratio"])])]),e("div",qe,[P(` <div class="circle-bg w-[22px] h-[22px] flex-center">
          <img src="@/assets/svg/shop/+.svg" class="w-3" alt="">
        </div> `),e("div",{class:"circle-bg w-[22px] h-[22px] flex-center",onClick:o[1]||(o[1]=()=>d("handleTo",`/shopInfo?address=${s.info.merchant}`))},Ne)]),e("div",Ue,[v(h,{class:"font-sans btn-shadow text-default h-[36px] text-[15px] font-semibold bg-btnOrBg w-36 rounded-3xl",onClick:o[2]||(o[2]=u=>d("setSubmitShow"))},{default:I(()=>[U(i(f.$t("common.payBill")),1)]),_:1})])])])}}}),Ge=A(Fe,[["__scopeId","data-v-277ea9e4"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/shop/components/ShopHeader.vue"]]),Pe={class:"flex-start gap-10 mt-4 overflow-x-scroll"},De=V({props:{tabList:{type:Array,required:!0},tabActive:{type:Number,required:!0}},emits:["change"],setup(s,{emit:d}){const f=s,o=_(0),h=u=>{d("change",f.tabList[u].id)};return(u,b)=>{const $=x("VanTab"),B=x("VanTabs");return p(),y("div",Pe,[v(B,{active:o.value,"onUpdate:active":b[0]||(b[0]=r=>o.value=r),onChange:h,background:"",color:"#FEA021",ellipsis:!1},{default:I(()=>[(p(!0),y(j,null,E(s.tabList,r=>(p(),F($,{title:r.name,key:r.id},null,8,["title"]))),128))]),_:1},8,["active"]),P(` <div v-for="tab in tabList" :key="tab.id" class="relative flex-shrink-0" @click="emits('change', tab.id)">
      <div class="text-default text-sm" :class="{ 'font-semibold': tabActive === tab.id }">{{ tab.name }}</div>
      <div class="absolute bottom-[-5px] x-center mx-auto w-5 h-1 rounded-md bg-primary2" v-if="tabActive === tab.id">
      </div>
    </div> `)])}}}),Me=A(De,[["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/shop/components/GoodsTab.vue"]]),Oe={class:"flex-start gap-2"},je=["onClick"],He=V({props:{categoryList:{type:Array,required:!0},categoryActive:{type:Number,required:!0}},emits:["change"],setup(s,{emit:d}){return(f,o)=>{const h=x("VanImage");return p(),y("div",Oe,[(p(!0),y(j,null,E(s.categoryList,u=>(p(),y("div",{class:ie(["px-3 py-2 flex-center gap-1 bg-gray1 rounded-2xl text-xs text-default font-semibold",{"bg-oriange2":s.categoryActive===u.id}]),key:u.id,onClick:b=>d("change",u.id)},[v(h,{src:u.icon,class:"h-4",alt:""},null,8,["src"]),U(" "+i(u.name),1)],10,je))),128))])}}}),ze=A(He,[["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/shop/components/GoodsCategory.vue"]]),Ee={class:"rounded-xl bg-white mt-3"},Ke={class:"flex-center-bw text-default text-xs"},We={class:"flex gap-2 items-center"},Je=["src"],Qe={class:"text-sm flex flex-col items-start justify-between h-[65px]"},Xe={class:"font-semibold text-sm line-clamp-1 break-all"},Ye={class:"opacity-60 line-clamp-1 break-all"},Ze={class:"flex-center gap-1"},et=e("div",{class:"gray-ball"},[e("img",{src:_e})],-1),tt={class:"text-oriange1 font-semibold"},st={class:"px-6 py-1 text-white bg-primary flex-center rounded-xl text-sm no-wrap"},ot=V({props:{goods:{type:null,required:!0}},setup(s){return(d,f)=>(p(),y("div",Ee,[e("section",Ke,[e("div",We,[e("img",{src:(s.goods.icons||"").split(",")[0]||n(D)("images/goods/defaultImg.png"),alt:"",class:"rounded-xl w-[65px] aspect-square object-cover"},null,8,Je),e("div",Qe,[e("div",Xe,i(s.goods.goodsName),1),e("div",Ye,i(s.goods.goodsDesc),1),e("div",Ze,[et,e("div",tt,i(n(Z)(s.goods.price))+"MCOIN",1)])])]),e("div",st,i(s.goods.deliveryType===1?d.$t("common.buy"):d.$t("common.Payment")),1)])]))}}),at=A(ot,[["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/shop/components/ShopGoodsItem.vue"]]),nt={class:"px-3 mt-3"},lt={class:"p-3 bg-white rounded-xl"},it=V({props:{merchant:{type:null,required:!1},goodsTypeList:{type:null,required:!1},goodsClass:{type:null,required:!1}},emits:["handleTo"],setup(s,{emit:d}){const f=s,{t:o}=K(),h=_(0);h.value=f.goodsTypeList[0].id;const u=_(0),b=[{id:0,name:o("common.recommend")}],$=M(()=>{const a=f.goodsClass.filter(T=>T.type===h.value);return b.concat(a)}),B=a=>{h.value=a,q()},r=a=>{console.log(a),u.value=a,q()},t=_([]),k=_(!1),C=_(!1),L=_(0),G=_(10),S=_(0),q=async()=>{C.value=!1,L.value=0,S.value=0,R()},R=async()=>{k.value=!0,L.value+=1,await N(),k.value=!1},N=async()=>{const a=await be({merchant:f.merchant,status:1,page:L.value,size:G.value,deliveryType:h.value,subclassId:u.value?u.value:null});if(k.value=!1,!a.success){C.value=!0;return}if(!a.data||!a.total){C.value=!0,t.value=L.value===1?[]:t.value;return}S.value=a.total;const l=_([]);l.value=a.data.map((T,g)=>T.goods),t.value=L.value===1?l.value:t.value.concat(l.value),t.value.length>=S.value&&(C.value=!0)};return(a,l)=>{const T=x("VanList");return p(),y("div",nt,[e("div",lt,[v(ze,{categoryList:s.goodsTypeList,categoryActive:h.value,onChange:B},null,8,["categoryList","categoryActive"]),v(Me,{tabActive:u.value,tabList:n($),onChange:r},null,8,["tabActive","tabList"]),v(T,{loading:k.value,"onUpdate:loading":l[0]||(l[0]=g=>k.value=g),finished:C.value,"finished-text":a.$t("common.noMore"),"loading-text":a.$t("common.loading"),onLoad:R},{default:I(()=>[(p(!0),y(j,null,E(t.value,g=>(p(),F(at,{key:g.id,goods:g,onClick:()=>{d("handleTo",`/goodsDetail?id=${g.id}`)}},null,8,["goods","onClick"]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])])])}}}),rt=A(it,[["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/shop/components/GoodsPanel.vue"]]);const H=s=>(X("data-v-12d20c9c"),s=s(),Y(),s),ct={class:"w-[85vw] max-w-[375px] p-6 bg-popBg"},dt={class:"flex-center-bw pb-5 border-b border-solid border-gray1"},ut={class:"flex-start font-bold"},mt=H(()=>e("img",{src:se,class:"w-[10px] h-[10px]",alt:""},null,-1)),pt=[mt],ft={class:""},vt={class:"text-center mt-5"},ht={class:"flex-center mt-8 mb-5 rounded-lg bg-[#FFF8EC] py-[5px] pr-[10px]"},gt=H(()=>e("img",{class:"w-[23px] mr-[4px]",src:we,alt:""},null,-1)),_t=H(()=>e("span",{class:"opacity-80"},"MCOIN",-1)),bt={class:"flex-center-bw text-center mt-8 pb-2"},wt={class:""},xt={class:""},yt={class:"flex justify-between mt-4"},$t={class:"flex-1"},kt={class:"px-3 py-3 h-[400px] relative"},Ct={class:"flex-center relative"},St={class:"text-base font-semibold"},Lt=H(()=>e("img",{src:se,class:"w-3 h-3",alt:""},null,-1)),Tt=[Lt],It=V({props:{show:{type:Boolean,required:!0},storeAddress:{type:String,required:!0},storeId:{type:Number,required:!0}},emits:["close"],setup(s,{emit:d}){const{show:f,storeAddress:o,storeId:h}=s,{t:u}=K(),[b,$]=O(!1),[B,r]=O(!1),t=re({amount:null,balance:null,ratio:0,remark:null,hash:"",pointSelfRate:0,allowance:0,walletBalance:null,pointBalance:0}),{merchantDiscounts:k,tradeContributeSelfRate:C,trade:L,pointBalances:G}=ee(),S=ce(),q=M(()=>t.allowance>t.amount),R=async()=>{t.ratio=await k(o)},N=async()=>{t.walletBalance=await(await S).balanceOf(),t.pointBalance=+await G(),t.balance=+t.walletBalance+ +de(t.pointBalance).times(.9)},a=async()=>{t.pointSelfRate=await C()},l=async()=>{const c=await(await S).allowance(Q.flashMall);t.allowance=c.result},T=async()=>{r(!0),(await(await S).approve(Q.flashMall)).success&&await l(),r(!1)},g=async()=>{r(!0);const c=await L(o,t.amount);if(r(!1),!c.success)return r(!1);oe(c.result.hash),await c.result.wait(),r(!1),ue.success(u("common.paySucess")),setTimeout(()=>{r(!1),d("close")},1500)},oe=async c=>{if(r(!0),!(await xe({id:h,amount:t.amount,remark:t.remark,hash:c})).success)return r(!1)};return te(()=>{R(),N(),a(),l()}),(c,m)=>{const ae=x("VanField"),ne=x("van-icon"),z=x("VanButton"),W=x("VanPopup"),le=x("van-field");return p(),y(j,null,[v(W,{show:s.show,"onUpdate:show":m[3]||(m[3]=w=>J(f)?f.value=w:null),round:"",class:""},{default:I(()=>[e("div",ct,[e("div",dt,[e("div",ut,i(c.$t("order.submitOrder")),1),e("div",{onClick:m[0]||(m[0]=w=>d("close"))},pt)]),e("div",ft,[e("div",vt,i(c.$t("order.payAmount")),1),e("div",ht,[P(' <span class="text-[32px] font-black">0.00</span> '),v(ae,{modelValue:n(t).amount,"onUpdate:modelValue":m[1]||(m[1]=w=>n(t).amount=w),placeholder:n(t).balance,"input-align":"left",type:"number",class:"w-[] text-3xl rounded-lg bg-[#FFF8EC]"},null,8,["modelValue","placeholder"]),gt,_t]),e("div",bt,[e("div",wt,i(c.$t("order.preScore")),1),e("div",xt,i(n(Z)(n(t).amount*n(t).ratio*n(t).pointSelfRate)),1)]),e("div",yt,[e("div",$t,i(c.$t("order.orderRemark")),1),e("div",{class:"text-[#D1C2A7] flex-1 line-clamp-1 text-right whitespace-nowrap",onClick:m[2]||(m[2]=w=>n($)(!0))},[U(i(n(t).remark?n(t).remark:c.$t("order.noRemark")),1),v(ne,{name:"arrow"})])]),n(q)?(p(),F(z,{key:1,class:"btn-orange w-full text-white font-semibold mt-5",onClick:g,loading:n(B),disabled:!n(t).amount||+n(t).amount>+n(t).balance},{default:I(()=>[U(i(c.$t("common.confrim")),1)]),_:1},8,["loading","disabled"])):(p(),F(z,{key:0,class:"btn-orange w-full text-white font-semibold mt-5",onClick:T,loading:n(B)},{default:I(()=>[U(i(c.$t("common.approve")),1)]),_:1},8,["loading"]))])])]),_:1},8,["show"]),v(W,{position:"bottom",show:n(b),"onUpdate:show":m[7]||(m[7]=w=>J(b)?b.value=w:null),round:"",class:"h-[400px]"},{default:I(()=>[e("div",kt,[e("div",Ct,[e("div",St,i(c.$t("order.remark")),1),e("div",{class:"absolute right-0",onClick:m[4]||(m[4]=w=>n($)(!1))},Tt)]),v(le,{modelValue:n(t).remark,"onUpdate:modelValue":m[5]||(m[5]=w=>n(t).remark=w),type:"textarea",maxlength:"200",placeholder:c.$t("order.remarkDes"),"show-word-limit":"",class:"bg-[#f2f0ef] text-default h-40 rounded-lg mt-5"},null,8,["modelValue","placeholder"]),v(z,{class:"btn-orange absolute x-center bottom-10 px-16 text-white font-semibold",onClick:m[6]||(m[6]=w=>n($)(!1))},{default:I(()=>[U(i(c.$t("common.confirm")),1)]),_:1})])]),_:1},8,["show"])],64)}}}),Vt=A(It,[["__scopeId","data-v-12d20c9c"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/shop/components/SubmitOrderPop.vue"]]);const Bt={class:"h-full"},At={class:"relative -z-0"},qt=V({name:"Shop"});function Rt(s){const{t:d}=K(),{loadingToggle:f}=ve(),o=_({}),h=me(),u=pe(),[b,$]=O(!1),[B,r]=O(!1),t=M(()=>[{id:1,icon:D("svg/shop/goods-icon.svg"),name:d("shop.goods")},{id:2,icon:D("svg/shop/service-icon.svg"),name:d("shop.service")}]),k=M(()=>h.query.id);fe(k,(a,l)=>{a!==void 0&&N()});const C=_([]),L=async()=>{const a=await ye(k.value);!a.success||!a.data||(o.value=a.data,!o.value.onlineNum||o.value.onlineNum<=0?t.value.splice(0,1):(!o.value.offlineNum||o.value.offlineNum<=0)&&t.value.splice(1,1))},G=async()=>{if(!o.value.merchant)return;const a=await $e({address:o.value.merchant});!a.success||(C.value=a.data||[])},S=a=>{u.push(a)},{merchantDiscounts:q}=ee(),R=async()=>{o.value.discountRatio=await q(o.value.merchant)*100},N=async()=>{r(!1),await L(),R(),G(),r(!0)};return te(async()=>{f(!0),await N(),f(!1)}),(a,l)=>{const T=x("VanImage");return p(),y("div",Bt,[e("header",At,[v(he,{class:"absolute top-3 left-5"}),v(T,{src:o.value.scenery,class:"w-full h-[150px]",alt:"",fit:"cover"},null,8,["src"])]),v(Ge,{info:o.value,onHandleTo:l[0]||(l[0]=g=>S(g)),onSetSubmitShow:l[1]||(l[1]=g=>n($)(!0))},null,8,["info"]),o.value.merchant?(p(),F(rt,{key:0,goodsTypeList:n(t),goodsClass:C.value,merchant:o.value.merchant,onHandleTo:l[2]||(l[2]=g=>S(g))},null,8,["goodsTypeList","goodsClass","merchant"])):P("v-if",!0),o.value.merchant?(p(),F(Vt,{key:1,show:n(b),onClose:l[3]||(l[3]=g=>n($)(!1)),info:o.value,storeAddress:o.value.merchant,"store-id":o.value.id},null,8,["show","info","storeAddress","store-id"])):P("v-if",!0)])}}const Nt=V({...qt,setup:Rt}),Et=A(Nt,[["__scopeId","data-v-3d57cd3e"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/shop/Shop.vue"]]);export{Et as default};
