import{_ as se,d as ne,A as fe,D as G,E as V,b as m,e as H,g as t,h as s,t as o,G as M,ao as Ae,k as U,F as ue,s as ge,H as O,L as E,K as te,j as R,Z as Ie,aw as ve,M as Q,ax as Oe,z as Me,a4 as j,a6 as D,a8 as Be,ay as le,a2 as ae,a5 as pe,a3 as he,m as ce,w as _e,a as z,C as re,o as me,X as Y,P as oe,W,at as ye,u as Ce,p as xe,l as ke,ac as Se}from"./index-8df1d5de.js";import{_ as Fe}from"./Vector-light-ecef907e.js";import{B as Le}from"./BgBox-c33f790b.js";import{U as Te,a as Ue,C as Pe}from"./ChangeLang-45385e49.js";import"./avatarRing-8eae2442.js";import"./level-93a6fb73.js";import"./TokenBalance-7572284a.js";const Ve=""+new URL("../images/sell-28e94682.svg",import.meta.url).href,Ne=""+new URL("../images/buy-0ac551f5.svg",import.meta.url).href;const qe={class:"pt-5"},De={class:"flex items-center h-5 text-[#2E2008] text-base"},Re=["src"],Ee={class:"font-semibold ml-0.5"},je={class:"bg-[#FFF1D9]/[0.6] rounded-xl mt-2.5 p-4 pb-1.5"},ze={class:"w-full"},He={class:"flex"},We={class:"my-th w-4/12"},Ge={class:"my-th w-5/12"},Xe={class:"my-th w-3/12"},Ke={key:1,class:"max-h-36 w-full overflow-auto pt-1.5"},Ye={class:"w-4/12 text-overflow"},Ze={class:"text-base font-medium text-[#2E2008]"},Je={class:"w-5/12 text-overflow"},Qe={class:"text-base font-medium text-[#2E2008]"},et={class:"w-3/12 text-overflow"},tt=ne({props:{type:{type:null,required:!0},list:{type:Array,required:!0}},emits:["onClick","onCheckMyOrder"],setup(n,{emit:k}){const{type:$,list:I}=n,g=fe(),B=G(()=>{const _={icon:Ve,title:g.t("ecology.Sellorders"),subTitle:g.t("ecology.mysellorder"),btnText:g.t("ecology.buyin")};return $=="buy"&&(_.icon=Ne,_.title=g.t("ecology.buyorder"),_.subTitle=g.t("ecology.mybill"),_.btnText=g.t("ecology.sellout")),_}),F=_=>{k("onClick",$,_)},u=()=>{k("onCheckMyOrder",$)};return(_,i)=>{const L=V("van-icon"),v=V("van-skeleton"),S=V("VanButton");return m(),H("div",qe,[t("div",De,[t("img",{src:s(B).icon,class:"w-5",alt:""},null,8,Re),t("span",Ee,o(s(B).title),1),t("span",{class:"ml-auto font-medium opacity-80",onClick:u},o(s(B).subTitle),1),M(L,{class:"font-semibold text-sm mx-px",name:"arrow",onClick:u})]),t("div",je,[t("div",ze,[t("div",He,[t("span",We,o(_.$t("mall.price")),1),t("span",Ge,o(_.$t("ecology.quantity")),1),t("span",Xe,o(_.$t("shop.operation")),1)]),s(Ae)?(m(),U(v,{key:0,class:"mt-3",row:3})):(m(),H("div",Ke,[(m(!0),H(ue,null,ge(n.list,A=>(m(),H("div",{class:"flex w-full py-2.5",key:A.price},[t("span",Ye,[t("span",Ze,o(A.price),1)]),t("span",Je,[t("span",Qe,o(A.amount),1)]),t("span",et,[M(S,{class:te(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":n.type=="buy"}]),onClick:C=>F(A)},{default:O(()=>[E(o(s(B).btnText),1)]),_:2},1032,["class","onClick"])])]))),128))]))]),R(` <table border="1" class="w-full">
        <thead>
          <tr>
            <th class="my-th w-4/12">{{ $t('mall.price') }}</th>
            <th class="my-th w-5/12">{{ $t('ecology.quantity') }}</th>
            <th class="my-th w-3/12">{{ $t('shop.operation') }}</th>
          </tr>
        </thead>
        <tbody class="max-h-36">
          <tr class="h-10 leading-10 " v-for="(item, index) in list" :key="item.price">
            <td class="w-4/12">
              <span class="text-base font-medium text-[#2E2008]">{{ item.price }}</span>
            </td>
            <td class="w-5/12">
              <span class="text-base font-medium text-[#2E2008]">{{ item.amount }}</span>
            </td>
            <td class="w-3/12">
              <VanButton class="align-middle btn rounded px-3.5 h-6 leading-6" :class="{ 'btn-buy': type == 'buy' }"
                @click="onClick">
                {{ labels.btnText }}
              </VanButton>
            </td>
          </tr>
        </tbody>

      </table> `)])])}}}),we=se(tt,[["__scopeId","data-v-1cc2456f"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OtcOrder.vue"]]);const st={class:"w-[21rem] p-5 bg-[#FFFDF8] text-xs text-[#2E2008]"},nt={class:"flex justify-between items-center pb-4 header font-semibold text-base"},ot=ne({props:{show:{type:Boolean,required:!0},title:{type:null,required:!0}},emits:["close"],setup(n,{emit:k}){const{show:$,title:I}=n,g=()=>{k("close")};return(B,F)=>{const u=V("van-icon"),_=V("van-popup");return m(),U(_,ve(B.$attrs,{show:n.show,"onUpdate:show":F[0]||(F[0]=i=>Q($)?$.value=i:null),round:"","overlay-class":"",onClose:g}),{default:O(()=>[t("div",st,[t("div",nt,[t("span",null,o(n.title),1),M(u,{name:"cross",class:"font-semibold text-xl",onClick:g})]),t("div",null,[Ie(B.$slots,"default",{},void 0,!0)])])]),_:3},16,["show"])}}}),be=se(ot,[["__scopeId","data-v-41985eb3"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyDialog.vue"]]),de=()=>{const n=Oe(),k=Me().getCurrentAccount();return{pending:async(e,a,r)=>{try{const y=await(await n.pending(e,ae(a),ae(r))).wait();return console.log(y,"2222"),j(y)}catch(y){return pe(y),D(y)}},usdtAddress:async()=>{try{const e=await n.USDT();return j(e)}catch(e){return D(e)}},MIN_AMOUNT:async()=>{try{const e=await n.MIN_AMOUNT();return Be(e)}catch(e){return D(e)}},MIN_REMAIN_AMOUNT:async()=>{try{const e=await n.MIN_REMAIN_AMOUNT();return j(e)}catch(e){return D(e)}},lastPrice:async()=>{try{const e=await n.lastPrice();return j(le(e.toString()))}catch(e){return D(e)}},getMarketPrices:async e=>{try{const a=await n.getMarketPrices(e);return j(a)}catch(a){return D(a)}},getPriceTotals:async(e,a)=>{try{const r=await n.getPriceTotals(e,ae(a));return j(r)}catch(r){return D(r)}},getMarketIds:async(e,a)=>{try{const r=await n.getMarketIds(e,a);return j(r)}catch(r){return D(r)}},getOrderInfo:async e=>{try{const a=await n.getOrderInfo(e);return j(a)}catch(a){return D(a)}},batchTrade:async e=>{try{const r=await(await await n.batchTrade(e)).wait();return j(r)}catch(a){return pe(a),D(a)}},trade:async(e,a)=>{try{const r=await n.estimateGas.trade(e,ae(a)),T=await(await await n.trade(e,ae(a),{gasLimit:he(r,3e3)})).wait();return j(T)}catch(r){return pe(r),D(r)}},getPendingIds:async()=>{try{const e=await n.getPendingIds(k);return j(e)}catch(e){return D(e)}},cancel:async e=>{try{const a=await n.estimateGas.cancel(e),y=await(await await n.cancel(e.toString(),{gasLimit:he(a,3e3)})).wait();return j(y)}catch(a){return pe(a),D(a)}},musdAddress:async()=>{try{const e=await n.MUSD();return console.log(e,"\u6388\u6743"),j(e)}catch(e){return D(e)}},maiAddress:async()=>{try{const e=await n.MAI();return j(e)}catch(e){return D(e)}}}};const at={class:"mt-4 text-[#2E2008]"},lt={class:"text-sm font-medium"},rt={class:"bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},ct={class:"mt-5 text-sm font-medium"},it={class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},ut={class:"text-base opacity-60"},dt={class:"mt-5 flex flex-col justify-center items-center"},pt={key:2,class:"mt-5 text-center"},mt={key:3,class:"mt-5 text-center"},yt=ne({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},lastPrice:{type:null,required:!0}},emits:["update:show","success"],setup(n,{emit:k}){const{show:$,type:I}=n,{t:g}=fe(),{musdAddress:B,MIN_AMOUNT:F,maiAddress:u,pending:_}=de(),i=ce({number:null,price:null}),L=G(()=>{const l={title:g("ecology.Pendingpurchase"),numberText:g("ecology.buyquantity"),priceText:g("ecology.buyprice")};return I=="sell"&&(l.title=g("ecology.Hangforsale"),l.numberText=g("ecology.sellquantity"),l.priceText=g("ecology.sellingprice")),l}),v=G(()=>(console.log(N.value),N.value>0&&N.value>=S.value));_e(()=>i.price,(l,x)=>{console.log(l,"newVal"),!A.value&&(S.value=+l*+i.number)}),_e(()=>i.number,(l,x)=>{C.value||(S.value=+l*+i.price)});const S=z(null),A=z(!1),C=z(!1),h=()=>{A.value=!1,C.value=!0},K=()=>{A.value=!0,C.value=!1},[e,a]=re(!1),r=()=>{k("update:show",!1)},y=z(""),T=async()=>{const l=I==="buy"?await B():await u();!l.success||(y.value=l.result)},d=async()=>{a(!0);const l=await await Y(y.value).approve(oe.otc);a(!1),l.success&&b()},N=z(null),b=async()=>{a(!0);const l=await(await Y(y.value)).allowance(oe.otc);N.value=l.result||0,a(!1)},P=z(0),J=async()=>{const l=await F();P.value=+l},X=z(0),Z=async()=>{const l=await Y(y.value).balanceOf();X.value=+l},[f,c]=re(!1),p=async()=>{c(!0);const l=await _(I==="buy"?1:2,i.price,i.number);c(!1),l.success&&(r(),k("success"))},w=async()=>{b(),J(),Z()};return me(async()=>{await T(),w()}),(l,x)=>{const q=V("VanField"),ee=V("VanButton");return m(),U(be,{show:n.show,"onUpdate:show":x[2]||(x[2]=ie=>Q($)?$.value=ie:null),title:s(L).title,onClose:r},{default:O(()=>[t("div",at,[t("div",lt,o(s(L).numberText),1),t("div",rt,[M(q,{class:"bg-[#fff9f0] text-3xl font-bold",onFocus:K,modelValue:s(i).number,"onUpdate:modelValue":x[0]||(x[0]=ie=>s(i).number=ie),type:"number",placeholder:"0"},null,8,["modelValue"])]),t("div",ct,o(s(L).priceText),1),t("div",it,[M(q,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:s(i).price,"onUpdate:modelValue":x[1]||(x[1]=ie=>s(i).price=ie),onFocus:h,type:"number",placeholder:"0"},null,8,["modelValue"]),t("span",ut,o(n.type==="buy"?"MUSD":"MAI"),1)]),t("div",dt,[s(v)?(m(),U(ee,{key:1,onClick:p,disabled:+s(i).price<=0||s(i).number<P.value||S.value>X.value,loading:s(f),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:O(()=>[E(o(l.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(m(),U(ee,{key:0,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",loading:s(e),onClick:d},{default:O(()=>[E(o(l.$t("assets.auth"))+" "+o(n.type==="buy"?"MUSD":"MAI"),1)]),_:1},8,["loading"])),n.type=="sell"?(m(),H("div",pt,[t("div",null,"MAI:"+o(X.value),1),t("div",null,o(l.$t("ecology.new price"))+o(n.lastPrice),1),t("div",null,o(l.$t("ecology.hand num"))+" "+o(P.value)+"MAI",1),t("div",null,o(l.$t("ecology.estimated get"))+" "+o(S.value)+"MUSD",1)])):(m(),H("div",mt,[t("div",null,"MUSD: "+o(X.value),1),t("div",null,o(l.$t("ecology.new price"))+o(n.lastPrice),1),t("div",null,o(l.$t("ecology.hand num"))+" "+o(P.value)+"MAI",1),t("div",null,o(l.$t("ecology.estimated consume"))+" "+o(S.value)+"MUSD",1)]))])])]),_:1},8,["show","title"])}}}),ft=se(yt,[["__scopeId","data-v-6f90ea23"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/PostForm.vue"]]);const gt={class:"mt-5"},bt={class:"flex justify-between"},ht={class:"text-base font-semibold"},_t={class:"text-base font-medium opacity-80"},wt={class:"flex justify-between mt-2.5"},vt={class:"text-base font-semibold"},xt={class:"text-base font-medium opacity-80"},kt={class:"flex justify-between mt-6"},$t={class:"text-sm font-medium"},At={class:"text-sm opacity-80"},It={class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg py-2.5 pr-2.5 mt-2.5"},Ot={class:"flex flex-col items-center justify-center mt-5"},Mt={class:"mt-5 text-center w-56"},Bt={class:"mt-2"},Ct={class:"text-[#FBA923]"},St=ne({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0},isAuth:{type:Boolean,required:!0},orderInfo:{type:null,required:!0},musdBalance:{type:[Number,String],required:!0},tokenBalance:{type:[Number,String],required:!0},musdAllowance:{type:[Number,String],required:!0},tokenAllowance:{type:[Number,String],required:!0},otcAddress:{type:String,required:!0}},emits:["update:show","approve","success"],setup(n,{emit:k}){const{show:$,type:I,token:g,musd:B,isAuth:F,orderInfo:u,musdBalance:_,tokenBalance:i,otcAddress:L,tokenAllowance:v,musdAllowance:S}=n,A=.05,{trade:C}=de(),h=ce({isAuth:!1,btnLoading:!1}),K=G(()=>u.remain<d.number),e=G(()=>u.remain>10?`1-${W(u.remain-10)}`:u.remain),a=G(()=>{if(I=="buy")return 1;if(I=="sell")return 2}),r=()=>{k("update:show",!1)},y=async()=>{h.btnLoading=!0;let b;if(a.value===1?b=await Y(g).approve(L):b=await Y(B).approve(L),!b.success)return h.btnLoading=!1;h.isAuth=!0,k("approve"),h.btnLoading=!1,T()},T=async()=>{if(!F&&!h.isAuth)return y();const b=u.remain;if(a.value===1){if(b>v&&b<=i)return y()}else if(b>S&&b<=_)return y();h.btnLoading=!0;try{(await C(u.id,+d.number)).success&&k("success")}finally{h.btnLoading=!1}},d=ce({number:""}),N=()=>{a.value===1?d.number=+i<+u.remain?i:u.remain:d.number=+_/u.price<+u.remain?+_/u.price:u.remain};return(b,P)=>{const J=V("VanField"),X=V("VanButton");return m(),U(be,{show:n.show,"onUpdate:show":P[1]||(P[1]=Z=>Q($)?$.value=Z:null),title:n.type=="sell"?b.$t("otc.buyIn"):b.$t("otc.sellOut"),onClose:r,overlay:!1},{default:O(()=>[t("div",gt,[t("div",bt,[t("span",ht,o(b.$t("mall.price")),1),t("span",_t,o(s(W)(n.orderInfo.price||0,4))+" MUSD",1)]),t("div",wt,[t("span",vt,o(b.$t("ecology.total")),1),t("span",xt,o(s(W)(n.orderInfo.remain||0,4))+" MAI",1)]),t("div",kt,[t("span",$t,o(n.type=="sell"?b.$t("ecology.buyquantity"):b.$t("ecology.sellquantity")),1),t("span",At,o(n.type=="sell"?"MUSD":"MAI")+o(b.$t("assets.balance"))+o(n.type=="sell"?n.musdBalance:n.tokenBalance),1)]),t("div",It,[M(J,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:s(d).number,"onUpdate:modelValue":P[0]||(P[0]=Z=>s(d).number=Z),type:"number",placeholder:"0"},null,8,["modelValue"]),t("div",{class:"px-1.5 py-1 border-[1px] rounded border-[#FBA923] border-solid text-xs text-[#FBA923] font-medium",onClick:N},"MAX ")]),t("div",Ot,[n.isAuth||s(h).isAuth?(m(),U(X,{key:0,loading:s(h).btnLoading,disabled:!s(d).number||+s(d).number<=0||s(K),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",onClick:T},{default:O(()=>[E(o(b.$t("common.submit")),1)]),_:1},8,["loading","disabled"])):(m(),U(X,{key:1,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",disabled:!s(d).number||+s(d).number<=0||s(K),loading:s(h).btnLoading,onClick:y},{default:O(()=>[E(o(b.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading"])),t("div",Mt,o(b.$t("ecology.tips",{Currency:n.type=="sell"?"MAI":"MUSD",num:s(e)})),1),t("div",Bt,[E("*"+o(b.$t("ecology.Estimatedconsumption"))+" ",1),t("span",Ct,o(s(a)===1?s(W)(+s(d).number*A):s(W)(+s(d).number*n.orderInfo.price*A)),1),E(" "+o(n.type=="sell"?"MUSD":"MAI"),1)])])])]),_:1},8,["show","title"])}}}),Ft=se(St,[["__scopeId","data-v-67dbb134"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperateDetail.vue"]]);const Lt={class:"mt-4"},Tt={class:"text-sm text-[#2E2008] font-medium"},Ut={class:"text-white flex flex-col justify-center items-center mt-5 font-semibold text-sm"},Pt=ne({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0},price:{type:Number,required:!0},token:{type:String,required:!0},musd:{type:String,required:!0}},emits:["update:show","success"],setup(n,{emit:k}){const{show:$,type:I,price:g,token:B,musd:F}=n,u=fe(),{getMarketIds:_,getOrderInfo:i,batchTrade:L,MIN_AMOUNT:v}=de(),S=oe.otc,[A,C]=re(!1),h=z([]),K=f=>{h.value=f},e=ce({orderInfo:{},amountShow:!1,list:[],btnLoading:!1,tokenAllowance:"",tokenBalance:"",musdAllowance:"",musdBalance:""}),a=G(()=>+e.tokenAllowance>0),r=G(()=>+e.musdAllowance>0),y=G(()=>{const f={title:u.t("ecology.buy"),btnText:u.t("ecology.buyin"),batchBtnText:u.t("ecology.Bulkbuy"),btnClass:"btn-green"};return I=="buy"&&(f.title=u.t("ecology.Sell"),f.btnText=u.t("ecology.sellout"),f.batchBtnText=u.t("ecology.sellinbulk"),f.btnClass="btn-pink"),f}),T=G(()=>{if(I=="buy")return 1;if(I=="sell")return 2}),d=()=>{k("update:show",!1)},N=async()=>{const f=await Y(F).allowance(oe.otc);e.musdAllowance=f.result,e.musdBalance=String(W(await Y(F).balanceOf()));const c=await Y(B).allowance(oe.otc);e.tokenAllowance=c.result,e.tokenBalance=String(W(await Y(B).balanceOf()))},b=async()=>{const f=await _(T.value,ae(g)),c=[];for(let p=0;p<f.result.length;p++){const w=await i(f.result[p]);c.push({id:f.result[p],price:g,remain:le(w.result.remain.toString())})}e.list=c},P=async()=>{e.btnLoading=!0;let f;if(T.value===1?f=await Y(B).approve(oe.otc):f=await Y(F).approve(oe.otc),!f.success)return e.btnLoading=!1;await N(),J()},J=async()=>{const f=e.list.reduce((c,p)=>h.value.find(w=>w==p.id)?c+p.remain:c,0);if(T.value===1){if(f>e.tokenAllowance&&f<=e.tokenBalance)return P()}else if(f>e.musdAllowance&&f<=e.musdBalance)return P();e.btnLoading=!0;try{(await L(h.value)).success&&k("success")}finally{e.btnLoading=!1}},X=f=>{e.orderInfo=f,C(!0)},Z=()=>{C(!1),k("success")};return me(async()=>{e.btnLoading=!0,await N(),await b(),e.btnLoading=!1}),(f,c)=>{const p=V("van-checkbox"),w=V("VanButton"),l=V("van-checkbox-group");return m(),H(ue,null,[M(be,{show:n.show,"onUpdate:show":c[1]||(c[1]=x=>Q($)?$.value=x:null),title:`${n.price}${s(y).title}`,onClose:d,"close-on-click-overlay":!s(A)},{default:O(()=>[t("div",Lt,[M(l,{modelValue:h.value,"onUpdate:modelValue":c[0]||(c[0]=x=>h.value=x),onChange:K},{default:O(()=>[(m(!0),H(ue,null,ge(s(e).list,x=>(m(),H("div",{class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg p-2.5 mt-2.5",key:x.id},[M(p,{name:x.id,"icon-size":"1rem","checked-color":"#14D8A9"},{default:O(()=>[t("span",Tt,o(s(W)(x.remain||0,4))+" MAI",1)]),_:2},1032,["name"]),M(w,{class:te(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":n.type=="buy"}]),onClick:q=>X(x)},{default:O(()=>[E(o(s(y).btnText),1)]),_:2},1032,["class","onClick"])]))),128))]),_:1},8,["modelValue"]),t("div",Ut,[R(" \u6388\u6743 "),s(T)==1&&!s(a)||s(T)==2&&!s(r)?(m(),U(w,{key:0,disabled:!h.value.length,loading:s(e).btnLoading,class:te(["py-3 flex-1 w-40",s(y).btnClass]),onClick:P},{default:O(()=>[E(o(f.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading","class"])):(m(),H(ue,{key:1},[R(" \u6279\u91CF\u8D2D\u4E70 "),M(w,{disabled:!h.value.length,loading:s(e).btnLoading,class:te(["py-3 flex-1 w-40",s(y).btnClass]),onClick:J},{default:O(()=>[E(o(s(y).batchBtnText),1)]),_:1},8,["disabled","loading","class"])],2112))])])]),_:1},8,["show","title","close-on-click-overlay"]),s(A)?(m(),U(Ft,{key:0,type:n.type,show:s(A),"onUpdate:show":c[2]||(c[2]=x=>Q(A)?A.value=x:null),token:n.token,musd:n.musd,isAuth:n.type=="sell"?s(r):s(a),isMusdtAuth:s(r),orderInfo:s(e).orderInfo,musdBalance:s(e).musdBalance,tokenBalance:s(e).tokenBalance,otcAddress:s(S),tokenAllowance:s(e).tokenAllowance,musdAllowance:s(e).musdAllowance,onApprove:N,onSuccess:Z},null,8,["type","show","token","musd","isAuth","isMusdtAuth","orderInfo","musdBalance","tokenBalance","otcAddress","tokenAllowance","musdAllowance"])):R("v-if",!0)],64)}}}),Vt=se(Pt,[["__scopeId","data-v-176626b2"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/OperatePopup.vue"]]),Nt=""+new URL("../images/Rectangle_L_O-1a09b3b3.svg",import.meta.url).href,qt=""+new URL("../images/Rectangle_L_W-bf92913e.svg",import.meta.url).href,Dt=""+new URL("../images/Rectangle_R_O-b6604591.svg",import.meta.url).href,Rt=""+new URL("../images/Rectangle_R_W-ed1e7ed6.svg",import.meta.url).href;const Et={class:"w-[21rem] bg-[#FFFDF8] text-xs text-[#2E2008]"},jt={class:"container"},zt={class:"flex justify-between items-center font-semibold text-base py-4 px-5"},Ht={class:"h-10 flex relative"},Wt=["src"],Gt=["src"],Xt={class:"h-10 z-10 flex items-center w-[21rem] text-base font-medium"},Kt={class:"p-2.5 maxH overflow-auto"},Yt={class:"flex justify-between header pb-2.5"},Zt={class:"text-xl font-bold"},Jt={class:"flex justify-between mt-2.5 text-sm"},Qt={class:"opacity-80"},es={class:"font-semibold"},ts={class:"flex justify-between mt-2.5 text-sm"},ss={class:"opacity-80"},ns={class:"font-semibold"},os={class:"flex justify-between mt-2.5 text-sm"},as={class:"opacity-80"},ls={class:"font-semibold"},rs=ne({props:{show:{type:Boolean,required:!0},type:{type:String,required:!0}},emits:["update:show"],setup(n,{emit:k}){const{show:$,type:I}=n,{getPendingIds:g,cancel:B,getOrderInfo:F}=de(),u=()=>{k("update:show",!1)},_=G(()=>i.value==="buy"?C.value.filter(e=>e.direct===1):C.value.filter(e=>e.direct===2)),i=z("buy"),L=e=>{i.value!=e&&(i.value=e)},v=G(()=>i.value=="buy"?qt:Nt),S=G(()=>i.value=="sell"?Rt:Dt),A=z([]),C=z([]),h=async()=>{const e=await g();console.log(e,"\u8BA2\u5355id"),e.success&&(A.value=e.result,A.value.forEach(async a=>{const r=await F(a);C.value.push({direct:+r.result.direct,price:W(ye(r.result.price)),total:W(ye(r.result.total)),remain:W(ye(r.result.remain)),token:r.result.token,sender:r.result.sender,status:+r.result.status,id:a})}))},K=async e=>{!(await B(e)).success||u()};return me(()=>{i.value=I,h()}),(e,a)=>{const r=V("van-icon"),y=V("VanButton"),T=V("van-popup");return m(),U(T,ve(e.$attrs,{show:n.show,"onUpdate:show":a[2]||(a[2]=d=>Q($)?$.value=d:null),style:{height:"80vh"},round:"","overlay-class":"",onClose:u}),{default:O(()=>[t("div",Et,[t("div",jt,[t("div",zt,[t("span",null,o(e.$t("ecology.mypendingorder")),1),M(r,{name:"cross",class:"font-semibold text-xl",onClick:u})]),t("div",Ht,[t("img",{class:te(["h-10 absolute left-0 bottom-[-1px]",{"z-10":i.value=="buy"}]),src:s(v),alt:""},null,10,Wt),t("img",{class:te(["h-10 absolute right-0 bottom-[-1px]",{"z-10":i.value=="sell"}]),src:s(S),alt:""},null,10,Gt),t("div",Xt,[t("span",{class:te(["text-[#2E2008] flex-1 text-center",{"text-[#FEA021]":i.value=="buy"}]),onClick:a[0]||(a[0]=d=>L("buy"))},o(e.$t("ecology.mybill")),3),t("span",{class:te(["text-[#2E2008] opacity-60 flex-1 text-center",{"text-[#FEA021]":i.value=="sell"}]),onClick:a[1]||(a[1]=d=>L("sell"))},o(e.$t("ecology.mysellorder")),3)])])]),t("div",Kt,[R(" \u8BA2\u5355\u9879 "),(m(!0),H(ue,null,ge(s(_),(d,N)=>(m(),H("div",{class:"bg-[#FFF1D9]/[0.4] rounded p-2.5 mt-2.5 order-box",key:N},[t("div",Yt,[t("span",Zt,o(d.price||0),1),R(" \u64A4\u9500 "),d.status==1?(m(),U(y,{key:0,class:"btn-border px-3.5 h-[28px] rounded-2xl text-xs text-[#FBA923] font-medium min-w-[65px] text-center"},{default:O(()=>[E(o(e.$t("ecology.completed")),1)]),_:1})):R("v-if",!0),d.status==0?(m(),U(y,{key:1,onClick:b=>K(d.id),class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:O(()=>[E(o(e.$t("ecology.revoke")),1)]),_:2},1032,["onClick"])):R("v-if",!0),d.status===2?(m(),U(y,{key:2,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:O(()=>[E(o(e.$t("ecology.canceled")),1)]),_:1})):R("v-if",!0)]),t("div",Jt,[t("span",Qt,o(e.$t("ecology.Totalendingorders")),1),t("span",es,o(d.total||0)+" MAI",1)]),t("div",ts,[t("span",ss,o(e.$t("ecology.transactionquantity")),1),t("span",ns,o(d.total-d.remain||0)+" MAI",1)]),t("div",os,[t("span",as,o(e.$t("ecology.remainingquantity")),1),t("span",ls,o(d.remain||0)+" MAI",1)])]))),128))])])]),_:1},16,["show"])}}}),cs=se(rs,[["__scopeId","data-v-0ab69f7b"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/components/MyOtcOrder.vue"]]);const $e=n=>(xe("data-v-5b5e4784"),n=n(),ke(),n),is={class:"bg-[#FFFDF8] rounded-xl p-2.5 pt-5 pb-3.5"},us={class:"flex-center flex-col text-[#F36B07] rounded-xl bg-[#FFF1D9]/[0.6] py-5 font-normal text-sm"},ds={class:"text-3xl font-bold"},ps=$e(()=>t("span",{class:"ml-2"},"MUSD",-1)),ms={class:"text-[#2E2008] font-medium opacity-60"},ys={class:"pt-2.5 pb-1 flex justify-between text-white font-semibold text-sm"},fs=$e(()=>t("div",{class:"w-5"},null,-1)),gs=ne({setup(n){const{loadingToggle:k}=Se(),{lastPrice:$,getMarketPrices:I,getMarketIds:g,maiAddress:B,musdAddress:F,getOrderInfo:u}=de(),{reloadStore:_}=Ce(),i=1,L=2,v=ce({token:"",musd:"",sellOrderList:[],buyOrderList:[],lastPrice:0,selectPrice:0,minAmount:0,maxAmount:0}),S=z(),A=z(""),C=z(""),[h,K]=re(!1),[e,a]=re(!1),[r,y]=re(!1),T=c=>{A.value=c,K(!0)},d=(c,p)=>{S.value=p.price,C.value=c,a(!0)},N=c=>{C.value=c,y(!0)},b=async()=>{const c=await $();v.lastPrice=c.result},P=async()=>{const c=await B(),p=await F();v.token=c.result,v.musd=p.result},J=async()=>{const c=await I(L),p=[];for(let w=0;w<c.result.length;w++){const l=await g(L,c.result[w]);let x=0;for(let q=0;q<l.result.length;q++){const ee=await u(l.result[q]);x+=le(ee.result.remain.toString())}p.push({price:le(c.result[w].toString()),amount:W(x)}),v.sellOrderList=p.filter(q=>q.amount!==0),v.sellOrderList=v.sellOrderList.sort((q,ee)=>q.price-ee.price)}},X=async()=>{const c=await I(i),p=[];for(let w=0;w<c.result.length;w++){const l=await g(i,c.result[w]);let x=0;for(let q=0;q<l.result.length;q++){const ee=await u(l.result[q]);x+=le(ee.result.remain.toString())}p.push({price:le(c.result[w].toString()),amount:W(x)})}v.buyOrderList=p.filter(w=>w.amount!==0),v.buyOrderList=v.buyOrderList.sort((w,l)=>l.price-w.price)},Z=async()=>{_.reload(),X(),J(),b(),a(!1)},f=async()=>{k(!0),await Promise.all([P(),b(),J(),X()]),k(!1)};return me(async()=>{await f()}),(c,p)=>{const w=V("VanButton");return m(),H("div",is,[t("div",us,[t("div",null,[t("span",ds,o(s(v).lastPrice),1),ps]),t("div",ms,o(c.$t("ecology.Latesttransactionprice")),1)]),t("div",ys,[M(w,{class:"flex-1 h-10 px-4 btn-green",onClick:p[0]||(p[0]=l=>T("buy"))},{default:O(()=>[E(o(c.$t("ecology.Pendingpurchase")),1)]),_:1}),fs,M(w,{class:"flex-1 h-10 px-4 btn-pink",onClick:p[1]||(p[1]=l=>T("sell"))},{default:O(()=>[E(o(c.$t("ecology.Hangforsale")),1)]),_:1})]),M(we,{type:"sell",onOnClick:d,onOnCheckMyOrder:N,list:s(v).sellOrderList},null,8,["list"]),M(we,{type:"buy",onOnClick:d,onOnCheckMyOrder:N,list:s(v).buyOrderList},null,8,["list"]),R(" \u53D1\u5E03\u7684\u5F39\u7A97 "),s(h)?(m(),U(ft,{key:0,show:s(h),"onUpdate:show":p[2]||(p[2]=l=>Q(h)?h.value=l:null),onSuccess:Z,type:A.value,lastPrice:s(v).lastPrice},null,8,["show","type","lastPrice"])):R("v-if",!0),R(" \u4E70\u5165\u5356\u51FA\u64CD\u4F5C\u5F39\u7A97 "),s(e)?(m(),U(Vt,{key:1,show:s(e),"onUpdate:show":p[3]||(p[3]=l=>Q(e)?e.value=l:null),type:C.value,price:S.value,token:s(v).token,musd:s(v).musd,onSuccess:Z},null,8,["show","type","price","token","musd"])):R("v-if",!0),R(" \u6211\u7684\u8BA2\u5355\u5F39\u7A97 "),s(r)?(m(),U(cs,{key:2,show:s(r),"onUpdate:show":p[4]||(p[4]=l=>Q(r)?r.value=l:null),type:C.value},null,8,["show","type"])):R("v-if",!0)])}}}),bs=se(gs,[["__scopeId","data-v-5b5e4784"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/OtcIndex.vue"]]);const hs=n=>(xe("data-v-4ef4f14a"),n=n(),ke(),n),_s={class:"h-full relative"},ws={class:"px-2.5 flex justify-between items-center py-5 relative header-bg"},vs=hs(()=>t("img",{src:Fe,alt:"",class:"absolute w-[125px] right-0 z-0"},null,-1)),xs=ne({setup(n){const k=ce({userInfo:{address:""}});return($,I)=>(m(),H("div",_s,[t("div",ws,[M(Te,{class:"z-50",info:s(k).userInfo},null,8,["info"]),M(Pe,{class:"mr-auto ml-[5px]"}),M(Ue,{tokens:["MCOIN","MUSD","MAI"],onHandleTo:I[0]||(I[0]=g=>$.$router.push(g)),class:"z-50 asset-max-width"}),vs]),M(Le,{icon:"svg/ecology/otc.svg",text:$.$t("ecology.otc")},{default:O(()=>[M(bs)]),_:1},8,["text"])]))}}),Cs=se(xs,[["__scopeId","data-v-4ef4f14a"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/OtcTransaction.vue"]]);export{Cs as default};
