import{_ as R,d as W,A as J,u as K,m as Q,C as Y,D as k,w as F,a as Z,o as ee,E as A,e as m,g as t,G as c,h as s,H as D,q as T,P as f,W as i,b as u,j as se,t as o,L as _,k as B,a9 as I,F as ae,s as te,p as oe,l as ne,aa as le,X as d,T as ce}from"./index-c3baa0c4.js";import{_ as ie}from"./Vector-light-ecef907e.js";import{_ as ue}from"./exchange-1-427770c5.js";import{_ as re}from"./exchange2-3cce7f16.js";import{U as de,a as me,C as pe}from"./ChangeLang-c45253c9.js";import{B as ge}from"./BgBox-02f4b2ac.js";import{u as fe}from"./lendingPoolContract-9c80f8ae.js";import"./avatarRing-8eae2442.js";import"./level-93a6fb73.js";import"./TokenBalance-456d0fed.js";const y=p=>(oe("data-v-cbacc2e6"),p=p(),ne(),p),_e={class:"h-full relative"},he={class:"px-2.5 flex justify-between items-center py-5 relative header-bg"},be=y(()=>t("img",{src:ie,alt:"",class:"absolute w-[125px] right-0 z-0"},null,-1)),ve={class:"bg-[#FFFDF8] rounded-2xl shadow-inset-2 px-2 py-4"},xe={class:"flex-center-bw"},we={class:"flex-start gap-2.5"},ke=["src"],Ae={class:"font-semibold"},De={class:"opacity-80 flex-center"},ye={key:1},Se={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},Ue={class:"flex justify-end items-center gap-2 mt-2"},Ce=["onClick"],Le=y(()=>t("img",{src:ue,class:"w-20 block",alt:""},null,-1)),Me=[Le],Ve={class:"flex-center-bw"},Fe={class:"flex-start gap-2.5"},Te=["src"],Be={class:"font-semibold"},Ie={class:"opacity-80 flex-center"},$e={key:1},Ee={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},Ne={class:"opacity-70 text-center mt-2"},ze={class:"flex-center gap-4 mt-5 text-white font-semibold"},Oe={class:"flex-center gap-1"},Pe=y(()=>t("img",{src:re,class:"w-4",alt:""},null,-1)),je=W({setup(p){const{usdtAddress:h,musdAddress:b,deposit:$,withdraw:E}=fe(),{t:N}=J();K();const e=Q({userInfo:{address:""},percents:[{name:"25%",value:.25},{name:"50%",value:.5},{name:"75%",value:.75},{name:"MAX",value:1}],token0:"USDT",token1:"MUSD",balance0:0,balance1:0,resouceAmount:null,toAmount:null,authLoading:!1,isAuth:!1,exchangeLoading:!1,allowanceAmount:0,resouceDisabled:!0,toDisabled:!0}),[S,U]=Y(!1),r=k(()=>({name:e.token0,icon:T(`images/tokens/${e.token0}.png`),token:f[`${e.token0}`]})),v=k(()=>({name:e.token1,icon:T(`images/tokens/${e.token1}.png`),token:f[`${e.token1}`]})),z=()=>{e.resouceDisabled=!1,e.toDisabled=!0},O=()=>{e.resouceDisabled=!0,e.toDisabled=!1};F(()=>e.resouceAmount,(a,n)=>{e.resouceDisabled||(e.toAmount=i(a*g.value),e.isAuth=+e.allowanceAmount>=+a&&e.allowanceAmount>0)},{immediate:!0,deep:!0}),F(()=>e.toAmount,(a,n)=>{e.toDisabled||(e.resouceAmount=i(a/g.value))});const P=a=>{e.resouceDisabled=!1,e.resouceAmount=i(+le(e.balance0).times(a.value))},g=k(()=>({MUSDUSDT:1,USDTMUSD:1})[e.token0+e.token1]),j=()=>{e.token0==="MUSD"?(e.token0="USDT",e.token1="MUSD"):(e.token0="MUSD",e.token1="USDT"),e.resouceAmount=0,w()},x=Z(""),H=async()=>{const a=r.value.name==="MUSD"?await b():await h();x.value=a},C=async()=>{console.log("\u5224\u65AD\u5F53\u524D\u4EE3\u5E01\u662F\u5426\u6388\u6743");const a=await(await d(x.value)).allowance(f.lendingPool);e.isAuth=+a.result>0,e.allowanceAmount=a.result||0},X=async()=>{e.authLoading=!0;const{approve:a}=d(x.value),n=await a(f.lendingPool);e.authLoading=!1,n.success&&C()},q=async()=>{U(!0),e.balance0=r.value.name==="MUSD"?+await d(await b()).balanceOf():+await d(await h()).balanceOf(),e.balance1=v.value.name==="MUSD"?+await d(await b()).balanceOf():+await d(await h()).balanceOf(),U(!1)},G=async()=>{if(!e.resouceAmount||e.resouceAmount===0)return ce(N("assets.pleaseInput"));e.exchangeLoading=!0;let a;r.value.name==="MUSD"?a=await E(i(e.resouceAmount)):a=await $(i(e.resouceAmount)),e.exchangeLoading=!1,a.success&&(e.resouceAmount=0,w())},w=async()=>{await C(),q(),e.authLoading=!1,e.exchangeLoading=!1};return ee(async()=>{await H(),w()}),(a,n)=>{const L=A("van-loading"),M=A("VanField"),V=A("VanButton");return u(),m("div",_e,[t("div",he,[c(de,{class:"z-50",info:s(e).userInfo},null,8,["info"]),c(pe,{class:"mr-auto ml-[5px]"}),c(me,{tokens:["MCOIN","MUSD","MAI"],onHandleTo:n[0]||(n[0]=l=>a.$router.push(l)),class:"z-50 asset-max-width"}),be]),c(ge,{icon:"svg/ecology/two-way-exchange.svg",text:a.$t("ecology.exchange")},{default:D(()=>[se(" MUSD \u53CC\u5411\u5151\u6362 USDT "),t("div",ve,[t("section",null,[t("div",xe,[t("div",we,[t("img",{src:s(r).icon,alt:"",class:"w-6 h-6"},null,8,ke),t("span",Ae,o(s(r).name),1)]),t("div",De,[_(o(a.$t("assets.balance"))+" ",1),s(S)?(u(),B(L,{key:0,size:"18px"})):(u(),m("span",ye,o(s(I)(s(i)(s(e).balance0||0))),1))])]),t("div",Se,[c(M,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",modelValue:s(e).resouceAmount,"onUpdate:modelValue":n[1]||(n[1]=l=>s(e).resouceAmount=l),onFocus:z,type:"number",placeholder:"0"},null,8,["modelValue"]),t("div",Ue,[(u(!0),m(ae,null,te(s(e).percents,l=>(u(),m("div",{class:"text-xs text-oriange1 border border-solid border-oriange1 rounded-md px-1 py-[2px] hover:bg-[#ffcd89]",key:l.value,onClick:He=>P(l)},o(l.name),9,Ce))),128))])])]),t("div",{class:"flex-center mt-3"},[t("div",{class:"w-20",onClick:j},Me)]),t("section",null,[t("div",Ve,[t("div",Fe,[t("img",{src:s(v).icon,alt:"",class:"w-6 h-6"},null,8,Te),t("span",Be,o(s(v).name),1)]),t("div",Ie,[_(o(a.$t("assets.balance"))+" ",1),s(S)?(u(),B(L,{key:0,size:"18px"})):(u(),m("span",$e,o(s(I)(s(i)(s(e).balance1||0))),1))])]),t("div",Ee,[c(M,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",disabled:!0,modelValue:s(e).resouceAmount,"onUpdate:modelValue":n[2]||(n[2]=l=>s(e).resouceAmount=l),onFocus:O,type:"number",placeholder:"0"},null,8,["modelValue"])])]),t("div",Ne,"1 "+o(s(e).token0)+" = "+o(s(g)?s(i)(s(g),6).toString():"-")+" "+o(s(e).token1),1),t("div",ze,[c(V,{class:"btn h-[35px] min-w-[100px] px-4",disabled:s(e).isAuth,loading:s(e).authLoading,onClick:X},{default:D(()=>[_(o(a.$t("assets.auth"))+o(s(r).name),1)]),_:1},8,["disabled","loading"]),c(V,{class:"btn h-[35px] min-w-[100px] px-4",loading:s(e).exchangeLoading,disabled:!s(e).isAuth||s(e).authLoading,onClick:G},{default:D(()=>[t("div",Oe,[Pe,_(" "+o(a.$t("assets.change")),1)])]),_:1},8,["loading","disabled"])])])]),_:1},8,["text"])])}}}),es=R(je,[["__scopeId","data-v-cbacc2e6"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/Exchange.vue"]]);export{es as default};
