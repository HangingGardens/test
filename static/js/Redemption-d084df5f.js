import{_ as se,d as ae,A as te,u as oe,m as ne,C as y,D as F,w as P,a as U,o as le,E as k,e as u,g as a,G as c,h as s,H as A,q as $,P as i,W as d,b as l,k as x,t as o,j as ce,a9 as B,L as p,p as ie,l as de,X as m,T as re}from"./index-85d13ebb.js";import{_ as ue}from"./Vector-light-ecef907e.js";import{_ as me}from"./exchange-1-427770c5.js";import{U as pe,a as fe,C as _e}from"./ChangeLang-b6db5305.js";import{B as ge}from"./BgBox-ac4ae5a4.js";import{u as he}from"./lendingPoolContract-577d6bf0.js";import{e as be}from"./exchangeContract-26039b0c.js";import"./avatarRing-8eae2442.js";import"./level-93a6fb73.js";import"./TokenBalance-9332a244.js";const E=f=>(ie("data-v-2fb3abd6"),f=f(),de(),f),xe={class:"h-full relative"},we={class:"px-2.5 flex justify-between items-center py-5 relative header-bg"},ve=E(()=>a("img",{src:ue,alt:"",class:"absolute w-[125px] right-0 z-0"},null,-1)),ye={class:"bg-[#FFFDF8] rounded-2xl shadow-inset-2 px-2 py-4"},ke={class:"text-center mt-2 flex-center font-semibold gap-1"},Ae=["src"],Be=p(" 1 MAI = "),De=["src"],Le={key:1},Me={class:"flex-center mt-4 mb-3.5"},Ce={class:"text-center px-2"},Se={class:"opacity-80 mb-1"},Ve={class:"font-semibold text-2xl"},Ie={key:1},Fe={class:"flex-center-bw"},Pe={class:"flex-start gap-2.5"},Ue=["src"],$e={class:"font-semibold"},Ee={class:"opacity-80 flex-center"},Te={key:1},ze={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},Ne=E(()=>a("div",{class:"flex-center mt-3"},[a("img",{src:me,class:"w-20 block",alt:""})],-1)),Oe={class:"flex-center-bw"},Re={class:"flex-start gap-2.5"},je=["src"],He={class:"font-semibold"},qe={class:"opacity-80 flex-center"},Ge={key:1},Ke={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},We={class:"flex-center gap-4 mt-5 text-white font-semibold"},Xe=ae({setup(f){he();const{mai:T,lastPrice:z,withdraw:N,getTokenList:O}=be(),{t:R}=te();oe();const e=ne({userInfo:{address:""},token0:"MAI",token1:"MUSD",musdBalance:0,resouceAmount:null,toAmount:null,authLoading:!1,isAuth:!1,exchangeLoading:!1,maiBalanece:0,poolBalanece:0,maiPrice:0,resouceDisabled:!0,toDisabled:!0,allowanceAmount:0}),[D,_]=y(!1),[j,L]=y(!1),[w,M]=y(!0),g=F(()=>({name:e.token0,icon:$(`images/tokens/${e.token0}.png`),token:i[`${e.token0}`]})),v=F(()=>({name:e.token1,icon:$(`images/tokens/${e.token1}.png`),token:i[`${e.token1}`]})),H=()=>{e.resouceDisabled=!1,e.toDisabled=!0},q=()=>{e.resouceDisabled=!0,e.toDisabled=!1};P(()=>e.resouceAmount,(t,n)=>{e.resouceDisabled||(e.toAmount=d(t*e.maiPrice),e.isAuth=+e.allowanceAmount>=parseFloat(t||0)&&e.allowanceAmount>0)},{immediate:!0,deep:!0}),P(()=>e.toAmount,(t,n)=>{e.toDisabled||(e.resouceAmount=d(t/e.maiPrice))});const h=U(""),G=async()=>{const t=await T();h.value=t},C=async()=>{const t=await await m(h.value).allowance(i.maiExchange);!t.success||(e.allowanceAmount=t.result||0,e.isAuth=+t.result>0)},K=async()=>{e.authLoading=!0;const{approve:t}=m(h.value),n=await t(i.maiExchange);e.authLoading=!1,n.success&&C()},W=async()=>{_(!0),e.musdBalance=+await m(i.MUSD).balanceOf(),_(!1)},X=async()=>{_(!0),e.maiBalanece=+await m(h.value).balanceOf(),_(!1)},J=async()=>{M(!0),e.maiPrice=+await z(),M(!1)},Q=async()=>{L(!0),e.poolBalanece=+await m(i.MUSD).balanceOf(i.maiExchange),L(!1)},Y=U(""),Z=async()=>{const t=await O();if(!!t.success)return Y.value=t.result[0],t.result[0]},ee=async()=>{if(!e.resouceAmount)return re(R("assets.pleaseInput"));e.exchangeLoading=!0;const t=await N(i.MUSD,d(e.resouceAmount));e.exchangeLoading=!1,t.success&&(e.resouceAmount=0,S())},S=async()=>{await C(),Z(),W(),X(),Q(),J(),e.authLoading=!1,e.exchangeLoading=!1};return le(async()=>{await G(),S()}),(t,n)=>{const b=k("van-loading"),V=k("VanField"),I=k("VanButton");return l(),u("div",xe,[a("div",we,[c(pe,{class:"z-50",info:s(e).userInfo},null,8,["info"]),c(_e,{class:"mr-auto ml-[5px]"}),c(fe,{tokens:["MCOIN","MUSD","MAI"],onHandleTo:n[0]||(n[0]=r=>t.$router.push(r)),class:"z-50 asset-max-width"}),ve]),c(ge,{icon:"svg/ecology/redemption.svg",text:t.$t("ecology.withdraw")},{default:A(()=>[a("div",ye,[a("div",ke,[a("img",{src:s(g).icon,alt:"",class:"w-6 h-6"},null,8,Ae),Be,a("img",{src:s(v).icon,alt:"",class:"w-6 h-6"},null,8,De),s(w)?(l(),x(b,{key:0,size:"18px"})):(l(),u("span",Le,o(s(d)(s(e).maiPrice,6))+" MUSD",1))]),ce(" \u53D1\u884C\u603B\u91CF\u548C\u6C60\u5B50\u4F59\u989D "),a("div",Me,[a("div",Ce,[a("div",Se,o(t.$t("ecology.balance")),1),a("div",Ve,[s(j)?(l(),x(b,{key:0,size:"18px"})):(l(),u("span",Ie,o(s(B)(s(d)(s(e).poolBalanece)))+"MUSD",1))])])]),a("section",null,[a("div",Fe,[a("div",Pe,[a("img",{src:s(g).icon,alt:"",class:"w-6 h-6"},null,8,Ue),a("span",$e,o(s(g).name),1)]),a("div",Ee,[p(o(t.$t("assets.balance"))+" ",1),s(D)?(l(),x(b,{key:0,size:"18px"})):(l(),u("span",Te,o(s(B)(s(d)(s(e).maiBalanece||0))),1))])]),a("div",ze,[c(V,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",disabled:s(w),modelValue:s(e).resouceAmount,"onUpdate:modelValue":n[1]||(n[1]=r=>s(e).resouceAmount=r),onFocus:H,type:"number",placeholder:"0"},null,8,["disabled","modelValue"])])]),Ne,a("section",null,[a("div",Oe,[a("div",Re,[a("img",{src:s(v).icon,alt:"",class:"w-6 h-6"},null,8,je),a("span",He,o(s(v).name),1)]),a("div",qe,[p(o(t.$t("assets.balance"))+" ",1),s(D)?(l(),x(b,{key:0,size:"18px"})):(l(),u("span",Ge,o(s(B)(s(d)(s(e).musdBalance||0))),1))])]),a("div",Ke,[c(V,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",modelValue:s(e).toAmount,"onUpdate:modelValue":n[2]||(n[2]=r=>s(e).toAmount=r),disabled:s(w),onFocus:q,type:"number",placeholder:"0"},null,8,["modelValue","disabled"])])]),a("div",We,[c(I,{class:"btn h-[35px] min-w-[100px] px-4",disabled:s(e).isAuth,loading:s(e).authLoading,onClick:K},{default:A(()=>[p(o(t.$t("assets.auth"))+o(s(g).name),1)]),_:1},8,["disabled","loading"]),c(I,{class:"btn h-[35px] min-w-[100px] px-4",loading:s(e).exchangeLoading,disabled:!s(e).isAuth||s(e).authLoading,onClick:ee},{default:A(()=>[p(o(t.$t("ecology.redeem")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["text"])])}}}),ls=se(Xe,[["__scopeId","data-v-2fb3abd6"],["__file","/Users/wangkeai/work/xueyan/mai/flashmall-dapp/src/view/ecology/Redemption.vue"]]);export{ls as default};
